<!DOCTYPE html><html lang="zh" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="央央的笔记本">
      
      
      
        <link rel="canonical" href="https://melody12020831.github.io/Notebook/Computer_Science/CN/Chapter4/">
      
      
        <link rel="prev" href="../Chapter3/">
      
      
        <link rel="next" href="../Chapter5/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/icon.jpg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Chapter 4 | 网络层 - 央央's Notebook</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=LXGW+WenKai+Screen+GB+Screen:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"LXGW WenKai Screen GB Screen";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    
      <link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css">
    
      <link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css">
    
      <link rel="stylesheet" href="../../../css/custom.css">
    
      <link rel="stylesheet" href="../../../css/card.css">
    
      <link rel="stylesheet" href="../../../css/tasklist.css">
    
      <link rel="stylesheet" href="../../../css/flink.css">
    
      <link rel="stylesheet" href="../../../css/more_changelog.css">
    
      <link rel="stylesheet" href="../../../css/neoteroi-mkdocs.css">
    
      <link rel="stylesheet" href="../../../css/fold_toc.css">
    
      <link rel="stylesheet" href="../../../css/sidebar.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-002T22X4FB"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-002T22X4FB",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-002T22X4FB",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-4" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="央央's Notebook" class="md-header__button md-logo" aria-label="央央's Notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4zM3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7zm2-2v2h2V5zm0 14h2v-2H5zm0-6h2v-2H5z"></path></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            央央's Notebook
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 4 | 网络层
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="light-blue" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-purple" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Melody12020831/Notebook/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    Melody
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  Computer Science

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Math/" class="md-tabs__link">
          
  
  
    
  
  Math

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Miscellaneous/" class="md-tabs__link">
          
  
  
    
  
  Misccelleanous

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="央央's Notebook" class="md-nav__button md-logo" aria-label="央央's Notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4zM3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7zm2-2v2h2V5zm0 14h2v-2H5zm0-6h2v-2H5z"></path></svg>

    </a>
    央央's Notebook
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Melody12020831/Notebook/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    Melody
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Home
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Computer Science
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Computer Science
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../ADS/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    ADS
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    ADS
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ADS/Homework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Homework
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ADS/organisedproblems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Organisedproblems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../CO/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    CO
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    CO
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CO/Chapter%201/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CO/Chapter%202/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CO/Chapter%203/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CO/Chapter%204/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CO/Chapter%205/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    chapter 5
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CO/Chapter%206/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CO/COhomework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CO homework
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CO/PPT_download/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PPT
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../DB/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    DB
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    DB
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1 | Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2 | Introduction to the Relational Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3 | Introduction to SQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4 | Intermediate SQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5 | Advanced SQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6 | Entity-Relationship Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7 | Relational Database Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8 | Complex Data Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 12 | Physical Storage Systems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 13 | Data Storage Structures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 14 | Indexing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 15 | Query Processing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 16 | Query Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 17 | Transactions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 18 | Concurrency Control
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/Chapter19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 19 | Recovery System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/homework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Homework
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DB/sql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQL learning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../OOP/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    OOP
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    OOP
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1 | introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2 | A tour of cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3 | STL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4 | Memory Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5 | Class
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6 | Ctor/Dtor &amp;&amp; Composition &amp; Inheritance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7 | Polymorphism
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8 | Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9 | Copy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 10 | Operator Overloading &amp;&amp; Streams
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 11 | templates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 12 | Iterators
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 13 | Exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 14 | Smart Pointers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/Chapter15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 15 | Miscellaneous Topics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/homework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Homework
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/test_from_wk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WK's 课前小测
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OOP/105_STL_Algorithmsin_Less_Than_an_Hour/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    105 STL Algorithmsin Less Than an Hour
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../CA/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    CA
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    CA
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CA/Chapter1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ch1 | Fundamentals of Computer Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CA/Chapter2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ch2 | Memory Hierarchy Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CA/homework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Homework
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CA/CA_review/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CA review
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../TOC/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    TOC
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    TOC
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../TOC/Chapter1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../TOC/Chapter2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2 | Simple Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../TOC/Chapter3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3 | Context-free Language and Pushdown Automata
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../TOC/Chapter4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4 | Turing Machine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../TOC/Chapter5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5 | Undecidability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../OS/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    OS
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    OS
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Chapter1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1 | Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Chapter2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2 | Operating-System Structures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Chapter3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3 | Processes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Chapter4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4 | Threads
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Chapter5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5 | CPU Scheduling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Chapter6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6 | Process Synchronization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Chapter7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7 | Deadlocks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Chapter8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8 | Main Memory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Chapter9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9 | Virtual Memory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Chapter10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 10 | File-System Interface
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Chapter11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 11 | File System Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OS/Chapter12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 12 | Mass-Storage Systems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    CN
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    CN
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1 | 概述
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2 | 物理层
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3 数据链路层
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4 | 网络层
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4 | 网络层
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        网络层概述
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络层概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        分组转发和路由选择
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        网络层向其上层提供的两种服务
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络层向其上层提供的两种服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        面向连接的虚电路服务
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        无连接的数据报服务
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ip" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际协议（IP）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网际协议（IP）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        异构网络互连
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="异构网络互连">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ip_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际协议IP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        异构网络互连
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址及其编址方法
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv4地址及其编址方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv4_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址概述
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址的表示方法
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址的分类编址方法
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv4地址的分类编址方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a" class="md-nav__link">
    <span class="md-ellipsis">
      
        A类地址
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b" class="md-nav__link">
    <span class="md-ellipsis">
      
        B类地址
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    <span class="md-ellipsis">
      
        C类地址
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址的划分子网编址方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址的无分类编址方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址的应用规划
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv4地址的应用规划">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用定长子网掩码划分子网
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用变长子网掩码划分子网
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4mac" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址与MAC地址
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv4地址与MAC地址">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv4mac_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址与MAC地址的封装位置
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4mac_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        数据报传送过程中IPv4地址与MAC地址的变化情况
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4mac_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址与MAC地址的关系
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        地址解析协议
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        IP数据报的发送和转发流程
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IP数据报的发送和转发流程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        第一阶段：源主机的判断与发送（出发）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        第二阶段：路由器的处理与查表（中转）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        第三阶段：转发与隔离（到达与防护）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4数据报的首部格式
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv4数据报的首部格式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv4-fragmentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4 数据报的分片（Fragmentation）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态路由配置
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="静态路由配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        特定主机路由
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        因特网的路由选择协议
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="因特网的路由选择协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        路由选择分类
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        因特网采用分层次的路由选择协议
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        路由信息协议
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="路由信息协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rip" class="md-nav__link">
    <span class="md-ellipsis">
      
        路由信息协议RIP的相关基本概念
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rip_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        RIP的基本工作过程
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rip_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        RIP的距离向量算法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rip_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        RIP存在的问题
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rip_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        RIP版本和相关报文的封装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rip_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        RIP的优缺点
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      
        开放最短路径优先协议
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="开放最短路径优先协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ospf" class="md-nav__link">
    <span class="md-ellipsis">
      
        开放最短路径优先OSPF的相关基本概念
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ospf_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        OSPF的五种分组类型
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ospf_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        OSPF的基本工作过程
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ospf_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        多点接入网络中的OSPF路由器
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ospf_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        OSPF划分区域
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      
        边界网关协议
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="边界网关协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bgp" class="md-nav__link">
    <span class="md-ellipsis">
      
        边界网关协议BGP的相关基本概念
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bgp-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        BGP-4的四种报文
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      
        路由器的基本工作原理
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际控制报文协议
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网际控制报文协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际控制报文协议概述
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#icmp" class="md-nav__link">
    <span class="md-ellipsis">
      
        ICMP报文类型
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ICMP报文类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      
        差错报告报文
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      
        询问报文
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#icmp_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        ICMP的典型应用
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ICMP的典型应用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ping" class="md-nav__link">
    <span class="md-ellipsis">
      
        分组网间探测PING
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      
        跟踪路由
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      
        虚拟专用网和网络地址转换
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="虚拟专用网和网络地址转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      
        虚拟专用网
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      
        网络地址转换
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络地址转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nat" class="md-nav__link">
    <span class="md-ellipsis">
      
        最基本的NAT方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      
        网络地址与端口号转换方法
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ip_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        IP多播
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IP多播">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ip_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        IP多播技术的相关基本概念
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        IP多播地址和多播组
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      
        在局域网上进行硬件多播
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        在因特网上进行IP多播需要的两种协议
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际组管理协议
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网际组管理协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#igmp" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际组管理协议IGMP的三种报文类型
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#igmp_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际组管理协议IGMP的基本工作原理
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      
        多播路由选择协议
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="多播路由选择协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      
        多播路由选择协议
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      
        因特网的路由选择协议
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ip_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        移动IP技术
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="移动IP技术">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ip_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        移动IP技术的相关基本概念
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        移动IP技术的基本工作原理
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ipv6" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6数据报
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv6数据报">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6引进的主要变化
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv6引进的主要变化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6的诞生背景
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv6_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6引进的主要变化
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv6_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6数据报的基本首部
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv6_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6数据报的扩展首部
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ipv6_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6地址
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv6地址">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6地址空间大小
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv6地址空间大小">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6地址的表示方法
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv6_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6地址的分类
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4ipv6" class="md-nav__link">
    <span class="md-ellipsis">
      
        从IPv4向IPv6过渡
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="从IPv4向IPv6过渡">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用双协议栈
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用隧道技术
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#icmpv6" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际控制报文协议ICMPv6
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网际控制报文协议ICMPv6">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#icmpv6_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        ICMPv6报文的封装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#icmpv6_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        ICMPv6报文的分类
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      
        网络层的数据层面和控制层面
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络层的数据层面和控制层面">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      
        网络层的数据层面和控制层面
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5 | 运输层
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6 | 应用层
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7 | 网络安全
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    quiz
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10">
        
          
          <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Visualization
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Visualization
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Visualization/note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    数据可视化笔记
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11">
        
          
          <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    编程语言
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    编程语言
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Programming_Language/python/CS50P_python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Programming_Language/python/python100days/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python-100-Days
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_12">
        
          
          <label class="md-nav__link" for="__nav_2_12" id="__nav_2_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tools/Git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Git
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tools/reveal-md/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    使用 reveal-md 制作 PPT
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../Math/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Math
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Math
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    概率论与数理统计
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    概率论与数理统计
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/Chapter1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1 概率论的基本概念
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/Chapter2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2 随机变量及其分布
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/Chapter3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3 多元随机变量及其分布
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/Chapter4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4 随机变量的数字特征
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/Chapter5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5 大数定律和中心极限定理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/Chapter6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6 数理统计的基本概念
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/Chapter7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7 参数估计
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/Chapter8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8 假设检验
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/PPT_download/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PPT
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_11">
        
          
          <label class="md-nav__link" for="__nav_3_2_11" id="__nav_3_2_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Homework
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Homework
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/Homework_index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Homework
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/HW1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HW1(习题一)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/HW2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HW2(习题一)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/HW3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HW3(习题一、二)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/HW4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HW4(习题二)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/HW5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HW5(习题二、三)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/HW6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HW6(习题三)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/HW7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HW7(习题三)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/HW8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HW8(习题四)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/HW9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HW9(习题四、五)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/HW10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HW10(习题五、六)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/HW11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HW11(习题六、七(只计算矩估计))
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/HW12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HW12(习题七)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/HW13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HW13(习题七)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Probability_Theory_and_Mathematical_Statistics/HW/HW14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HW14(习题八)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../Miscellaneous/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Misccelleanous
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Misccelleanous
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Miscellaneous/prompt/prompt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prompt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Miscellaneous/mermaid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mermaid
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4">
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    UBC
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    UBC
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Miscellaneous/UBC/block%20chain%20DAY%201/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    block chain DAY 1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Miscellaneous/UBC/block%20chain%20DAY%202/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    block chain DAY 2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Miscellaneous/UBC/block%20chain%20DAY%203/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    block chain DAY 3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Miscellaneous/UBC/block%20chain%20DAY%204/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    block chain DAY 4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Miscellaneous/UBC/block%20chain%20DAY%205/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    block chain DAY 5
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Miscellaneous/UBC/block%20chain%20DAY%206/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    block chain DAY 6
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Miscellaneous/UBC/block%20chain%20DAY%207/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    block chain DAY 7
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Miscellaneous/UBC/block%20chain%20DAY%208/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    block chain DAY 8
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Miscellaneous/cs231n/cs231n_note.md.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    None
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        网络层概述
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络层概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        分组转发和路由选择
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        网络层向其上层提供的两种服务
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络层向其上层提供的两种服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        面向连接的虚电路服务
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        无连接的数据报服务
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ip" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际协议（IP）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网际协议（IP）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        异构网络互连
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="异构网络互连">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ip_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际协议IP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        异构网络互连
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址及其编址方法
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv4地址及其编址方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv4_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址概述
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址的表示方法
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址的分类编址方法
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv4地址的分类编址方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a" class="md-nav__link">
    <span class="md-ellipsis">
      
        A类地址
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b" class="md-nav__link">
    <span class="md-ellipsis">
      
        B类地址
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    <span class="md-ellipsis">
      
        C类地址
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址的划分子网编址方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址的无分类编址方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址的应用规划
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv4地址的应用规划">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用定长子网掩码划分子网
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用变长子网掩码划分子网
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4mac" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址与MAC地址
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv4地址与MAC地址">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv4mac_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址与MAC地址的封装位置
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4mac_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        数据报传送过程中IPv4地址与MAC地址的变化情况
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4mac_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4地址与MAC地址的关系
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        地址解析协议
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        IP数据报的发送和转发流程
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IP数据报的发送和转发流程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        第一阶段：源主机的判断与发送（出发）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        第二阶段：路由器的处理与查表（中转）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        第三阶段：转发与隔离（到达与防护）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4数据报的首部格式
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv4数据报的首部格式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv4-fragmentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv4 数据报的分片（Fragmentation）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态路由配置
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="静态路由配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        特定主机路由
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        因特网的路由选择协议
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="因特网的路由选择协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        路由选择分类
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        因特网采用分层次的路由选择协议
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        路由信息协议
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="路由信息协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rip" class="md-nav__link">
    <span class="md-ellipsis">
      
        路由信息协议RIP的相关基本概念
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rip_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        RIP的基本工作过程
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rip_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        RIP的距离向量算法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rip_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        RIP存在的问题
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rip_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        RIP版本和相关报文的封装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rip_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        RIP的优缺点
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      
        开放最短路径优先协议
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="开放最短路径优先协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ospf" class="md-nav__link">
    <span class="md-ellipsis">
      
        开放最短路径优先OSPF的相关基本概念
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ospf_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        OSPF的五种分组类型
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ospf_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        OSPF的基本工作过程
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ospf_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        多点接入网络中的OSPF路由器
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ospf_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        OSPF划分区域
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      
        边界网关协议
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="边界网关协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bgp" class="md-nav__link">
    <span class="md-ellipsis">
      
        边界网关协议BGP的相关基本概念
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bgp-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        BGP-4的四种报文
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      
        路由器的基本工作原理
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际控制报文协议
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网际控制报文协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际控制报文协议概述
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#icmp" class="md-nav__link">
    <span class="md-ellipsis">
      
        ICMP报文类型
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ICMP报文类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      
        差错报告报文
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      
        询问报文
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#icmp_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        ICMP的典型应用
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ICMP的典型应用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ping" class="md-nav__link">
    <span class="md-ellipsis">
      
        分组网间探测PING
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      
        跟踪路由
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      
        虚拟专用网和网络地址转换
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="虚拟专用网和网络地址转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      
        虚拟专用网
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      
        网络地址转换
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络地址转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nat" class="md-nav__link">
    <span class="md-ellipsis">
      
        最基本的NAT方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      
        网络地址与端口号转换方法
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ip_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        IP多播
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IP多播">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ip_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        IP多播技术的相关基本概念
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        IP多播地址和多播组
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      
        在局域网上进行硬件多播
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        在因特网上进行IP多播需要的两种协议
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际组管理协议
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网际组管理协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#igmp" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际组管理协议IGMP的三种报文类型
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#igmp_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际组管理协议IGMP的基本工作原理
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      
        多播路由选择协议
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="多播路由选择协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      
        多播路由选择协议
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      
        因特网的路由选择协议
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ip_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        移动IP技术
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="移动IP技术">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ip_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        移动IP技术的相关基本概念
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        移动IP技术的基本工作原理
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ipv6" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6数据报
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv6数据报">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6引进的主要变化
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv6引进的主要变化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6的诞生背景
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv6_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6引进的主要变化
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv6_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6数据报的基本首部
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv6_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6数据报的扩展首部
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ipv6_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6地址
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv6地址">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6地址空间大小
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IPv6地址空间大小">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6地址的表示方法
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv6_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        IPv6地址的分类
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4ipv6" class="md-nav__link">
    <span class="md-ellipsis">
      
        从IPv4向IPv6过渡
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="从IPv4向IPv6过渡">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用双协议栈
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用隧道技术
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#icmpv6" class="md-nav__link">
    <span class="md-ellipsis">
      
        网际控制报文协议ICMPv6
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网际控制报文协议ICMPv6">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#icmpv6_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        ICMPv6报文的封装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#icmpv6_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        ICMPv6报文的分类
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      
        网络层的数据层面和控制层面
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络层的数据层面和控制层面">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      
        网络层的数据层面和控制层面
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                




  <nav class="md-path" aria-label="导航栏">
    <ol class="md-path__list">
      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../../" class="md-path__link">
          
  <span class="md-ellipsis">
    Computer Science
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../" class="md-path__link">
          
  <span class="md-ellipsis">
    CN
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="chapter-4">Chapter 4 | 网络层<a class="headerlink" href="#chapter-4" title="Permanent link">¶</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"></path></svg></span> 约 37794 个字 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"></path></svg></span> 130 张图片 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"></path></svg></span> 预计阅读时间 189 分钟</p>
</div>
<h2 id="_1">网络层概述<a class="headerlink" href="#_1" title="Permanent link">¶</a></h2>
<h3 id="_2">分组转发和路由选择<a class="headerlink" href="#_2" title="Permanent link">¶</a></h3>
<p>网络层的主要任务就是将分组<strong>从源主机经过多个网络和多段链路传输到目的主机</strong>，可以将该任务划分为<strong>分组转发</strong>和<strong>路由选择</strong>两种重要的功能。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-1.png" data-desc-position="bottom"><img alt="img" src="../assets/4-1.png"></a></p>
<blockquote>
<p>R1如何知道应从自己的哪个接口转发分组？</p>
<p>R1通过查阅自己的<strong>转发表</strong>来决定分组的转发接口。转发表中列出了到达各个目的地的路径信息，包括目的地地址前缀、下一跳路由器地址以及应使用的接口等。</p>
<p>转发表如何得来？</p>
<p>路由器通过<strong>路由选择算法</strong>来动态地构建和维护路由表。路由选择算法根据网络拓扑结构、链路状态和其他因素，计算出到达各个目的地的最佳路径，并将这些路径信息存储在路由表中。转发表则是路由表的一部分，专门用于指导分组的转发。</p>
<p>路由表又如何得来？</p>
<p>路由表可以通过<strong>静态配置</strong>或<strong>动态路由协议</strong>来获得。静态配置是由网络管理员手动设置的，而动态路由协议（如RIP、OSPF、BGP等）则允许路由器自动交换路由信息，动态更新路由表。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-2.png" data-desc-position="bottom"><img alt="img" src="../assets/4-2.png"></a></p>
<p>转发表是地图，路由选择算法是导航系统，路由表是导航系统中的路线数据库。</p>
<p>总的来说，路由表是根据路由选择算法得出的，而转发表是从路由表得出的。转发表的结构应使查找过程最优化，路由表则需要最优化网络拓扑变化的计算。在讨论路由选择的原理时，往往不区分转发表和路由表，而笼统地使用路由表一词。</p>
</blockquote>
<details class="note">
<summary>中继系统分类</summary>
<ol>
<li>
<p>物理层中继系统:转发器，集线器</p>
</li>
<li>
<p>数据链路层中继系统:网桥或交换机。</p>
</li>
<li>
<p>网络层中继系统:路由器。</p>
</li>
<li>
<p>网络层以上的中继系统:网关。</p>
</li>
</ol>
</details>
<details class="example" open="open">
<summary>Example</summary>
<p>在路由器互连的多个局域网的结构中，要求每个局域网( )。</p>
<p>A.物理层协议可以不同，而数据链路层及其以上的高层协议必须相同</p>
<p>B.物理层、数据链路层协议可以不同，而数据链路层以上的高层协议必须相同</p>
<p>C.物理层、数据链路层、网络层协议可以不同，而网络层以上的高层协议必须相同</p>
<p>D.物理层、数据链路层、网络层及高层协议都可以不同</p>
</details>
<details class="note">
<summary>answer</summary>
<p>C</p>
<p>路由器是第三层设备，向传输层及以上层隐藏下层的具体实现，所以物理层、数据链路层、网络层协议可以不同。而网络层之上的协议数据是路由器所不能处理的，因此网络层以上的高层协议必须相同。本题容易误选 B，主要原因是在目前的互联网中广泛使用的是 TCP/IP 族，在网络层用的多是IPv4,所以误认为网络层协议必须相同。实际上，使用特定的路由器连接 IPv4 与 PPv6网络，就是典型的网络层协议不同而实现互连的例子。</p>
</details>
<hr>
<h3 id="_3">网络层向其上层提供的两种服务<a class="headerlink" href="#_3" title="Permanent link">¶</a></h3>
<ul>
<li>面向连接的虚电路服务</li>
<li>无连接的数据报服务</li>
</ul>
<hr>
<h4 id="_4">面向连接的虚电路服务<a class="headerlink" href="#_4" title="Permanent link">¶</a></h4>
<p>核心思想是“<strong>可靠通信应由网络自身来保证</strong>”。</p>
<p>必须首先建立<strong>网络层连接</strong>—— <strong>虚电路</strong>（Virtual Circuit，VC），以保证通信双方所需的一切网络资源。</p>
<p>通信双方<strong>沿着已建立的虚电路发送分组</strong>。</p>
<ul>
<li>虚电路表示这是一条逻辑上的连接，分组沿着这条逻辑连接按照存储转发方式传送，而不是真正建立了一条物理连接。</li>
<li>而采用电路交换的电话通信，则是先建立一条真正的物理连接。因此，分组交换的虚连接与电路交换的连接只是类似，但并不完全一样。</li>
<li>分组的首部仅在连接建立阶段使用完整的目的主机地址，之后每个分组的首部只需要携带一条虚电路编号即可。</li>
</ul>
<p>通信结束后，需要<strong>释放</strong>之前所建立的虚电路。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-3.png" data-desc-position="bottom"><img alt="img" src="../assets/4-3.png"></a></p>
<p>这种通信方式如果再使用<strong>可靠传输的网络协议</strong>，就可使所发送的分组最终正确（无差错按序到达、不丢失、不重复）到达接收方。</p>
<p>很多广域分组交换网都使用面向连接的虚电路服务。例如，曾经的X.25和逐渐过时的帧中继（Frame Relay，FR）、异步传输模式（Asynchronnous Transfer Mode，ATM）。</p>
<p>然而，因特网的先驱者并没有采用这种设计思想，而是采用了无连接的数据报服务。</p>
<hr>
<h4 id="_5">无连接的数据报服务<a class="headerlink" href="#_5" title="Permanent link">¶</a></h4>
<p>核心思想是“<strong>可靠通信应由用户主机来保证</strong>”。</p>
<p><strong>不需要建立网络层连接。</strong></p>
<p><strong>每个分组可走不同的路径。</strong>因此，每个分组的首部都必须携带目的主机的完整地址。</p>
<p>通信结束后，<strong>没有需要释放的连接</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-4.png" data-desc-position="bottom"><img alt="img" src="../assets/4-4.png"></a></p>
<p>这种通信方式所传送的分组可能<strong>误码、丢失、重复和失序</strong>。</p>
<p>所以:</p>
<ul>
<li>将复杂的网络处理功能置于因特网的边缘（即用户主机和其内部的运输层）</li>
<li>将相对简单的尽最大努力（即不可靠）的分组交付功能置于因特网核心。</li>
</ul>
<p>由于网络自身不提供端到端的可靠传输服务，这就使得网络中的路由器可以做得比较简单，大大降低了网络造价。</p>
<p>另外，这种设计思想的运行方式灵活、能够适应多种应用。因特网能够发展到今日的规模，充分证明了当初采取这种设计思想的正确性。</p>
<p>那么对于 TCP/IP体系结构来说，网际层可以提供简单灵活的、无连接的不可靠的数据报服务。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-5.png" data-desc-position="bottom"><img alt="img" src="../assets/4-5.png"></a></p>
<details class="example" open="open">
<summary>Example</summary>
<p>路由器在能够开始向输出链路传输分组的第一位之前，必须先接收到整个分组，这种机制称为()。</p>
<p>A.存储转发机制  B.直通交换机制  C.分组交换机制   D.分组检测机制</p>
</details>
<details class="note">
<summary>answer</summary>
<p>A</p>
<p>路由器转发一个分组的过程如下:先接收整个分组，然后对分组进行错误检查，若出错，则丢弃错误的分组:否则存储这个正确的分组。最后根据路由选择协议，将正确的分组转发到合适的端口，这种机制称为存储转发机制。</p>
<p>分组交换机制：泛指网络层采用分组方式进行数据交换，不特指分组的转发方式。</p>
</details>
<details class="example" open="open">
<summary>Example</summary>
<p>下列关于虚电路和数据报的叙述中，正确的是()。</p>
<p>A.虚电路是一种分组交换技术，但不能按照存储转发的方式工作</p>
<p>B.虚电路的连接是临时性连接，当会话结束时就释放这种连接</p>
<p>C.数据报服务不提供可靠传输，但可以保证分组的有序到达</p>
<p>D.数据报服务中，每个分组都必须携带源地址和目的地址</p>
</details>
<details class="note">
<summary>answer</summary>
<p>D</p>
<p>虚电路是一种分组交换技术，它可以采用存储转发的方式工作，选项A错误。虚电路不只是临时性的，它提供的服务包括永久性虚电路(PVC)和交换型虚电路(SVC)，其中前者是一种提前定义好的、基本上不需要任何建立时间的端点之间的连接,而后者是端点之间的一种临时性连接,这些连接只持续所需的时间，且在会话结束时就取消这种连接，选项B错误。数据报服务是无连接的，既不提供可靠性保障，又不保证分组的有序到达，选项C错误。在数据报服务中，每个分组都必须携带源地址和目的地址;而虚电路服务中，建立连接后，分组只需携带虚电路标识。</p>
</details>
<hr>
<h2 id="ip">网际协议（IP）<a class="headerlink" href="#ip" title="Permanent link">¶</a></h2>
<h3 id="_6">异构网络互连<a class="headerlink" href="#_6" title="Permanent link">¶</a></h3>
<h4 id="ip_1">网际协议IP<a class="headerlink" href="#ip_1" title="Permanent link">¶</a></h4>
<p>网际协议（Internet Protocol，IP）是TCP/IP体系结构<strong>网际层中的核心协议</strong>。</p>
<p>网际协议IP、传输控制协议TCP、TCP/IP体系结构是由“因特网之父” Robert Kalm 和 Vint Cerf 二人共同研发的，1974年5月发布了TCP/IP的第一个版本。</p>
<hr>
<h4 id="_7">异构网络互连<a class="headerlink" href="#_7" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-6.png" data-desc-position="bottom"><img alt="img" src="../assets/4-6.png"></a></p>
<p>要将众多的异构型网络都互连起来，并且能够互相通信，则会面临许多需要解决的问题。不同的网络接入机制、不同的差错恢复方法、不同的路由选择技术、不同的寻址方案、不同的最大分组长度、不同的服务（面向连接服务和无连接服务）。</p>
<p>这些网络的拓扑、性能以及所使用的网络协议都不尽相同，这是由用户需求的多样性造成的，<strong>没有一种单一的网络</strong>能够适应所有用户的需求。</p>
<p>当IP网上的主机进行通信时，就好像在一个单个网络上通信一样，它们看不见互连的各网络的具体异构细节。</p>
<hr>
<h3 id="ipv4">IPv4地址及其编址方法<a class="headerlink" href="#ipv4" title="Permanent link">¶</a></h3>
<h4 id="ipv4_1">IPv4地址概述<a class="headerlink" href="#ipv4_1" title="Permanent link">¶</a></h4>
<p>IPv4地址是给因特网（Internet）上的<strong>每一个主机（或路由器）的每一个接口</strong>分配的一个在全世界范围内<strong>唯一的32比特的标识符</strong>。</p>
<details class="note">
<summary>something about 唯一(MAC &amp; IPv4)</summary>
<p>MAC地址唯一：MAC地址是网卡的物理地址，用于局域网内设备识别。唯一性保证同一网络内不会有地址冲突，数据能准确送达目标设备。</p>
<p>IPv4地址唯一：IPv4地址是网络层的逻辑地址，用于全球范围内设备通信。唯一性保证因特网中每个主机都能被正确定位和访问。</p>
<p>还有什么是<strong>唯一</strong>的？</p>
<ul>
<li>
<p>端口号（在同一主机上）：用于区分同一IP下不同应用进程。</p>
</li>
<li>
<p>域名（全球唯一）：用于人类友好访问网站，DNS系统保证唯一。</p>
</li>
<li>
<p>UUID（通用唯一标识符）：用于软件、数据库等场景唯一标识对象。</p>
</li>
<li>
<p>设备序列号：硬件厂商分配，用于唯一标识设备。</p>
</li>
</ul>
</details>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-7.png" data-desc-position="bottom"><img alt="img" src="../assets/4-7.png"></a></p>
<p>IPv4地址由<strong>因特网名字和数字分配机构</strong>（Internet Corporation for Assigned Names and Numbers，ICANN）进行分配。</p>
<ul>
<li>我国用户可向<strong>亚太网络信息中心</strong>（Asia Pacific Network Information Center，APNIC）申请IP地址，需要缴纳相应的费用，一般不接受个人申请。</li>
<li>2011年2月3日，因特网号码分配管理局（Internet Assigned Numbers Authority，IANA）（由ICANN行使职能）宣布，IPv4地址已经分配完毕。</li>
<li>我国在2014至2015年也逐步停止了向新用户和应用分配IPv4地址，同时全面开展商用部署IPv6。</li>
</ul>
<p>IPv4地址的编址方法经历了三个历史阶段：</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-8.png" data-desc-position="bottom"><img alt="img" src="../assets/4-8.png"></a></p>
<details class="note">
<summary>具体解释</summary>
<ol>
<li>分类编址（Classful Addressing）</li>
</ol>
<p>最早的IPv4地址分配方法，将IP地址分为A、B、C、D、E五类（主要用A/B/C）。</p>
<p>类地址有固定的网络号和主机号长度。例如：</p>
<ul>
<li>
<p>A类：网络号8位，主机号24位，适合大型网络</p>
</li>
<li>
<p>B类：网络号16位，主机号16位</p>
</li>
<li>
<p>C类：网络号24位，主机号8位，适合小型网络</p>
</li>
</ul>
<p>优点：简单，易于实现。</p>
<p>缺点：地址利用率低，容易造成浪费。例如一个单位可能只需要几十个主机，却被分配了一个C类地址（最多支持254主机）。</p>
<ol start="2">
<li>划分子网（Subnetting）</li>
</ol>
<p>为了提高地址利用率，引入了子网划分的概念。</p>
<p>在原有的网络号和主机号之间，增加了“子网号”字段。</p>
<p>网络管理员可以根据实际需求，把一个网络进一步划分为多个子网，每个子网有自己的主机号范围。</p>
<p>优点：灵活分配地址，便于网络管理和扩展。</p>
<p>缺点：依然受限于分类编址的结构，不能彻底解决地址浪费问题。</p>
<ol start="3">
<li>无分类编址（Classless Addressing，CIDR）</li>
</ol>
<p>1993年提出无分类域间路由（CIDR），彻底消除了分类编址和子网划分的概念。</p>
<p>IP地址不再固定分为A/B/C类，而是用“前缀长度”来表示网络部分和主机部分（如192.168.1.0/24）。</p>
<p>地址分配更加灵活，可以根据实际需要分配任意数量的地址块。</p>
<p>优点：极大提高了地址利用率、支持更高效的路由聚合（路由表更小）、适应互联网规模快速增长。</p>
<p>CIDR成为现代IPv4地址分配和路由的标准方法。</p>
</details>
<hr>
<h4 id="ipv4_2">IPv4地址的表示方法<a class="headerlink" href="#ipv4_2" title="Permanent link">¶</a></h4>
<p>由于IPv4地址由32比特构成，不方便阅读、记录以及输入等，因此IPv4地址采用<strong>点分十进制</strong>表示方法以方便用户使用。</p>
<ul>
<li>把32位二进制数每8位分为一组，共4组。每组称为一个“字节”（octet）。</li>
<li>每组8位二进制数转换为十进制数。四个十进制数之间用“.”分隔。</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-9.png" data-desc-position="bottom"><img alt="img" src="../assets/4-9.png"></a></p>
<details class="note">
<summary>PPT 上的练习</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-10.png" data-desc-position="bottom"><img alt="img" src="../assets/4-10.png"></a></p>
</details>
<details class="note">
<summary>转换方式</summary>
<p><strong>8位无符号二进制整数转十进制数</strong></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-11.png" data-desc-position="bottom"><img alt="img" src="../assets/4-11.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-12.png" data-desc-position="bottom"><img alt="img" src="../assets/4-12.png"></a></p>
<p><strong>十进制正整数转8位无符号二进制数</strong></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-13.png" data-desc-position="bottom"><img alt="img" src="../assets/4-13.png"></a></p>
</details>
<hr>
<h3 id="ipv4_3">IPv4地址的分类编址方法<a class="headerlink" href="#ipv4_3" title="Permanent link">¶</a></h3>
<p><strong>网络号</strong>: </p>
<ul>
<li>标志主机（或路由器）的接口所连接到的<strong>网络</strong></li>
<li><strong>同一个网络中</strong>，<strong>不同</strong>主机（或路由器）的<strong>接口</strong>的IPv4地址的<strong>网络号必须相同</strong>，表示它们属于同一个网络。</li>
</ul>
<p><strong>主机号</strong>:</p>
<ul>
<li>标志主机（或路由器）的<strong>接口</strong></li>
<li><strong>同一个网络中</strong>，<strong>不同</strong>主机（或路由器）的<strong>接口</strong>的IPv4地址的<strong>主机号必须各不相同</strong>，以便区分各主机（或路由器）的接口。</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-14.png" data-desc-position="bottom"><img alt="img" src="../assets/4-14.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-15.png" data-desc-position="bottom"><img alt="img" src="../assets/4-15.png"></a></p>
<ul>
<li><strong>A类</strong>、<strong>B类</strong>和<strong>C类</strong>地址都是<strong>单播地址</strong>，只有单播地址可以<strong>分配给网络中的主机（或路由器）的各接口</strong>。</li>
<li><strong>主机号为“全0”</strong>的地址是<strong>网络地址</strong>，<strong>不能分配</strong>给主机（或路由器）的各接口。</li>
<li><strong>主机号为“全1”</strong>的地址是<strong>广播地址</strong>，<strong>不能分配</strong>给主机（或路由器）的各接口。</li>
</ul>
<hr>
<h4 id="a">A类地址<a class="headerlink" href="#a" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-16.png" data-desc-position="bottom"><img alt="img" src="../assets/4-16.png"></a></p>
<p>最小网络号为0，表示本网络，不能分配给实际网络使用。</p>
<p>最小可指派网络号为1，网络地址为 1.0.0.0。</p>
<p>最大网络号为127，作为本地环回测试地址，不能指派配给实际网络使用。</p>
<ul>
<li>最小的本地环回测试地址为127.0.0.1</li>
<li>最大的本地环回测试地址为127.255.255.254</li>
</ul>
<p>最大可指派的网络号为126，网络地址为 126.0.0.0。</p>
<p>可指派的 A 类网络数量为 <span class="arithmatex">\(2^{7}-2=126\)</span> 个。<strong>（减2是去掉最小网络号0和最大网络号127）</strong></p>
<p>每个 A 类网络中可分配的地址数量为 <span class="arithmatex">\(2^{24}-2=16,777,214\)</span> 个。<strong>（减2是去掉主机号为全0的网络地址和全1的广播地址）</strong></p>
<hr>
<h4 id="b">B类地址<a class="headerlink" href="#b" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-17.png" data-desc-position="bottom"><img alt="img" src="../assets/4-17.png"></a></p>
<p>最小可指派的网络号为128.0，网络地址为 128.0.0.0。</p>
<p>最大可指派的网络号为191.255，网络地址为 191.255.0.0。</p>
<p>可指派的 B 类网络数量为 <span class="arithmatex">\(2^{16-2}=16,384\)</span> 个。</p>
<p>每个 B 类网络中可分配的地址数量为 <span class="arithmatex">\(2^{16}-2=65,534\)</span> 个。</p>
<hr>
<h4 id="c">C类地址<a class="headerlink" href="#c" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-18.png" data-desc-position="bottom"><img alt="img" src="../assets/4-18.png"></a></p>
<p>最小可指派的网络号为192.0.0，网络地址为 192.0.0.0。</p>
<p>最大可指派的网络号为223.255.255，网络地址为 223.255.255.0。</p>
<p>可指派的 C 类网络数量为 <span class="arithmatex">\(2^{24-2}=2,097,152\)</span> 个。</p>
<p>每个 C 类网络中可分配的地址数量为 <span class="arithmatex">\(2^{8}-2=254\)</span> 个。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-19.png" data-desc-position="bottom"><img alt="img" src="../assets/4-19.png"></a></p>
<details class="note">
<summary>为什么 B 和 C 类地址没有本网络和本地环回测试地址？</summary>
<p>B类和C类的环回测试和本地网络功能都统一用A类的127和0来实现。这大概是历史遗留问题。</p>
</details>
<details class="note">
<summary>PPT 上的练习</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-20.png" data-desc-position="bottom"><img alt="img" src="../assets/4-20.png"></a></p>
</details>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-21.png" data-desc-position="bottom"><img alt="img" src="../assets/4-21.png"></a></p>
<details class="note">
<summary>PPT 上的练习</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-22.png" data-desc-position="bottom"><img alt="img" src="../assets/4-22.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-23.png" data-desc-position="bottom"><img alt="img" src="../assets/4-23.png"></a></p>
</details>
<hr>
<h3 id="ipv4_4">IPv4地址的划分子网编址方法<a class="headerlink" href="#ipv4_4" title="Permanent link">¶</a></h3>
<p>随着更多的中小网络加入因特网，<strong>IPv4分类编址方法不够灵活</strong>、<strong>容易造成大量IPv4地址资源浪费的缺点</strong>就暴露出来了。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-24.png" data-desc-position="bottom"><img alt="img" src="../assets/4-24.png"></a></p>
<p>还剩余大量地址：只能由该单位的同一个网络使用，而其他单位的网络不能使用。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-25.png" data-desc-position="bottom"><img alt="img" src="../assets/4-25.png"></a></p>
<p>申请新的网络号存在以下弊端：</p>
<ul>
<li>需要等待很长的时间，并且要花费更多的费用。</li>
<li>即便申请到了两个新的网络号，其他路由器的路由表还需要新增针对这两个新的网络的路由条目。</li>
<li>浪费原来已申请到的B类网络中剩余的大量地址。</li>
</ul>
<p>如果可以从IPv4地址的主机号部分借用一些比特作为子网号来区分不同的子网，就可以利用原有网络中剩余的大量IPv4地址，而不用申请新的网络地址了。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-26.png" data-desc-position="bottom"><img alt="img" src="../assets/4-26.png"></a></p>
<p>借用16比特主机号中的前8个比特作为子网号。</p>
<blockquote>
<p>如果未在图中标记子网号部分，那么我们或计算机又如何知道在分类地址中，主机号有多少比特被借用作为子网号了呢？</p>
</blockquote>
<p><strong>子网掩码</strong>可以表明分类IPv4地址的主机号部分被借用了几个比特作为子网号。</p>
<p>与IPv4地址类似，子网掩码也是由<strong>32比特</strong>构成的。</p>
<ul>
<li>用左起多个<strong>连续的比特1</strong>对应IPv4地址中的<strong>网络号</strong>和<strong>子网号</strong>；</li>
<li>之后的多个<strong>连续的比特0</strong>对应IPv4地址中的<strong>主机号</strong>。</li>
</ul>
<p>将划分子网的<strong>IPv4地址与相应的子网掩码</strong>进行逐比特的<strong>逻辑与运算</strong>，就可<strong>得到</strong>该IPv4地址所在<strong>子网的网络地址</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-27.png" data-desc-position="bottom"><img alt="img" src="../assets/4-27.png"></a></p>
<p><strong>只要给定了一个分类的IPv4地址及其相应的子网掩码，就可以得出子网划分的全部细节。</strong></p>
<p>已知某个网络的地址为 <code>218.75.230.0</code> ，使用子网掩码 <code>255.255.255.128</code> 对其进行子网划分，请给出划分细节。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-29.png" data-desc-position="bottom"><img alt="img" src="../assets/4-29.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-30.png" data-desc-position="bottom"><img alt="img" src="../assets/4-30.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-31.png" data-desc-position="bottom"><img alt="img" src="../assets/4-31.png"></a></p>
<details class="note">
<summary>PPT 上的练习</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-28.png" data-desc-position="bottom"><img alt="img" src="../assets/4-28.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-32.png" data-desc-position="bottom"><img alt="img" src="../assets/4-32.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-33.png" data-desc-position="bottom"><img alt="img" src="../assets/4-33.png"></a></p>
</details>
<p><strong>默认子网掩码</strong>是指在<strong>未划分子网的情况下使用的子网掩码</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-34.png" data-desc-position="bottom"><img alt="img" src="../assets/4-34.png"></a></p>
<hr>
<h3 id="ipv4_5">IPv4地址的无分类编址方法<a class="headerlink" href="#ipv4_5" title="Permanent link">¶</a></h3>
<p>IPv4地址的划分子网编址方法在一定程度上缓解了因特网在发展中遇到的困难，但是<strong>数量巨大的C类网</strong>(<span class="arithmatex">\(2^{24-3} =2097152\)</span>个)由于其每个网络所包含的地址数量太小(<span class="arithmatex">\(2^{8}-2=254\)</span>个)，因此<strong>并没有得到充分使用</strong>，而因特网的IPv4地址仍在加速消耗，<strong>整个IPv4地址空间面临全部耗尽的威胁</strong>。</p>
<p>为此，因特网工程任务组IETF又提出了采用<strong>无分类编址</strong>的方法，来解决IPv4地址资源紧张的问题，同时还专门成立IPv6工作组负责研究新版本的IP，以彻底解决IPv4地址耗尽问题。</p>
<p>1993年，因特网工程任务组IETF发布了<strong>无分类域间路由选择</strong>（Classless Inter-Domain Routing，<strong>CIDR</strong> ）的RFC文档[RFC1517~1519，RFC1520]。</p>
<ul>
<li><strong>CIDR消除了传统A类、B类和C类地址以及划分子网的概念。</strong></li>
<li><strong>CIDR可以更加有效地分配IPv4地址资源，并且可以在IPv6使用之前允许因特网的规模继续增长。</strong></li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-35.png" data-desc-position="bottom"><img alt="img" src="../assets/4-35.png"></a></p>
<p>无分类编址方法使用的<strong>地址掩码</strong>与划分子网使用的<strong>子网掩码</strong>类似，由32比特构成。</p>
<ul>
<li>用左起多个<strong>连续的比特1</strong>对应IPv4地址中的<strong>网络前缀</strong>；</li>
<li>之后的多个<strong>连续的比特0</strong>对应IPv4地址中的<strong>主机号</strong>。</li>
</ul>
<details class="note">
<summary>举例</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-36.png" data-desc-position="bottom"><img alt="img" src="../assets/4-36.png"></a></p>
<p>为了简便起见，可以不明确给出配套的地址掩码的点分十进制形式，而是在无分类编址的IPv4地址后面加上斜线“/”，在斜线之后写上网络前缀所占的比特数量（也就是地址掩码中左起连续比特1的数量），这种记法称为<strong>斜线记法</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-37.png" data-desc-position="bottom"><img alt="img" src="../assets/4-37.png"></a></p>
</details>
<p>实际上，无分类域间路由选择CIDR是将网络前缀都相同的、连续的多个无分类IPv4地址，组成一个<strong>CIDR地址块</strong>，只要知道CIDR地址块中的任何一个地址，就可以知道该地址块的以下全部细节：</p>
<ul>
<li>地址块中的<strong>最小地址</strong></li>
<li>地址块中的<strong>最大地址</strong></li>
<li>地址块中的<strong>地址数量</strong></li>
<li>地址块中<strong>聚合某类网络（A类、B类、C类）的数量</strong></li>
<li><strong>地址掩码</strong></li>
</ul>
<details class="note">
<summary>PPT 上的练习</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-38.png" data-desc-position="bottom"><img alt="img" src="../assets/4-38.png"></a></p>
<p>一个C类网络有256个地址（ <span class="arithmatex">\(2^{8}=256\)</span> ），即主机号8位。</p>
<p>该CIDR地址块的地址数量是 <span class="arithmatex">\(2^{32-20}=4096\)</span> （主机号12位）。</p>
<p>所以，该CIDR地址块<strong>聚合了16个C类网络</strong>（ <span class="arithmatex">\(4096/256=16\)</span> ）。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-39.png" data-desc-position="bottom"><img alt="img" src="../assets/4-39.png"></a></p>
</details>
<p>使用无分类编址方法，可以根据客户的需要<strong>分配适当大小的CIDR地址块</strong>，因此可以更加有效地分配IPv4的地址空间。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-40.png" data-desc-position="bottom"><img alt="img" src="../assets/4-40.png"></a></p>
<p>使用无分类编址方法的另一个好处是<strong>路由聚合</strong>（也称为<strong>构造超网</strong>）。</p>
<ul>
<li>网络前缀越长，地址块越小，路由越具体；</li>
<li>若路由器查表转发分组时发现有多条路由条目匹配，则选择网络前缀最长的那条路由条目，这称为<strong>最长前缀匹配</strong>，因为这样的路由更具体。</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-41.png" data-desc-position="bottom"><img alt="img" src="../assets/4-41.png"></a></p>
<details class="note">
<summary>PPT 上的练习</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-42.png" data-desc-position="bottom"><img alt="img" src="../assets/4-42.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-43.png" data-desc-position="bottom"><img alt="img" src="../assets/4-43.png"></a></p>
</details>
<hr>
<h3 id="ipv4_6">IPv4地址的应用规划<a class="headerlink" href="#ipv4_6" title="Permanent link">¶</a></h3>
<p>IPv4地址的应用规划是指将给定的IPv4地址块（或分类网络）划分成若干个更小的地址块（或子网），并将这些地址块（或子网）分配给互联网中的不同网络，进而可以给各网络中的主机和路由器的接口分配IPv4地址。</p>
<p><strong>定长的子网掩码</strong>（Fixed Length Subnet Mask，FLSM）</p>
<ul>
<li>所划分出的每一个子网<strong>都使用同一个子网掩码</strong>。</li>
<li>每个子网所分配的IP地址数量相同，容易造成<strong>地址资源的浪费</strong>。</li>
</ul>
<p><strong>变长的子网掩码</strong>（Variable Length Subnet Mask，VLSM）</p>
<ul>
<li>所划分出的每一个子网<strong>可以使用不同的子网掩码</strong>。</li>
<li>每个子网所分配的IP地址数量可以不同，尽可能<strong>减少对地址资源的浪费</strong>。</li>
</ul>
<hr>
<h4 id="_8">使用定长子网掩码划分子网<a class="headerlink" href="#_8" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-44.png" data-desc-position="bottom"><img alt="img" src="../assets/4-44.png"></a></p>
<p>应用需求：网络1需要IP地址数量为9，网络2需要IP地址数量为28，网络3需要IP地址数量为15，网络4需要IP地址数量为13，网络5需要IP地址数量为4。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-45.png" data-desc-position="bottom"><img alt="img" src="../assets/4-45.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-46.png" data-desc-position="bottom"><img alt="img" src="../assets/4-46.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-47.png" data-desc-position="bottom"><img alt="img" src="../assets/4-47.png"></a></p>
<hr>
<h4 id="_9">使用变长子网掩码划分子网<a class="headerlink" href="#_9" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-48.png" data-desc-position="bottom"><img alt="img" src="../assets/4-48.png"></a></p>
<p><strong>在地址块中选取子块的原则</strong>：每个子块的起点位置不能随便选取，只能选取主机号部分是块大小整数倍的地址作为起点。建议先为大的子块选取。</p>
<p>例如：“218.75.230.16 可作为块大小为4、8、16的子块的起点，因为这些块大小能被主机号16整除”。</p>
<p>它指的是当前考虑的起始 IP 地址 <code>218.75.230.16</code> 的最后一个八位组（Last Octet），即数字 <strong>16</strong>。</p>
<p>块大小（Block Size）是指一个子网包含的 IP 总数（包括网络号和广播号）。</p>
<ul>
<li><strong>/30</strong> 的块大小是 <span class="arithmatex">\(2^2 = 4\)</span></li>
<li><strong>/29</strong> 的块大小是 <span class="arithmatex">\(2^3 = 8\)</span></li>
<li><strong>/28</strong> 的块大小是 <span class="arithmatex">\(2^4 = 16\)</span></li>
<li><strong>/27</strong> 的块大小是 <span class="arithmatex">\(2^5 = 32\)</span></li>
</ul>
<p>我们要看起始位置 <strong>16</strong> 能否容纳不同大小的块：</p>
<ul>
<li><strong>对于大小为 4 的块 (/30)：</strong><span class="arithmatex">\(16 \div 4 = 4\)</span> (整数)。<strong>可以</strong>。这意味着你可以从 <code>.16</code> 开始分配一个 <code>/30</code> (范围是 <code>.16</code> ~ <code>.19</code>)。</li>
<li><strong>对于大小为 8 的块 (/29)：</strong><span class="arithmatex">\(16 \div 8 = 2\)</span> (整数)。<strong>可以</strong>。这意味着你可以从 <code>.16</code> 开始分配一个 <code>/29</code> (范围是 <code>.16</code> ~ <code>.23</code>)。</li>
<li><strong>对于大小为 16 的块 (/28)：</strong><span class="arithmatex">\(16 \div 16 = 1\)</span> (整数)。<strong>可以</strong>。这意味着你可以从 <code>.16</code> 开始分配一个 <code>/28</code> (范围是 <code>.16</code> ~ <code>.31</code>)。</li>
<li><strong>对于大小为 32 的块 (/27)：</strong><span class="arithmatex">\(16 \div 32 = 0.5\)</span> (不是整数)。<strong>不可以</strong>！你不能从 <code>.16</code> 开始分配一个 <code>/27</code> 的网络。因为 <code>/27</code> 的块大小是32，它只能从 <span class="arithmatex">\(0, 32, 64...\)</span> 开始。如果强行从 <code>.16</code> 写成 <code>/27</code>，其网络地址实际上会回落到 <code>.0</code>，导致与前面的地址冲突。</li>
</ul>
<p>这句话的意思是告诉你在规划子网时，<strong>起始地址不能随意选取</strong>。既然当前的空闲起始地址是 <code>.16</code>，那么你接下来的选择只能是大小为 4、8 或 16 的子网，而不能是一个大小为 32 的子网（因为 16 不能被 32 整除）。</p>
<details class="example" open="open">
<summary>Example</summary>
<p>若将101.200.16.0/20划分为5个子网，则可能的最小子网的可分配IP地址数是（      ）。</p>
<p>A. 126  B. 254  C. 510  D. 1022</p>
</details>
<details class="note">
<summary>answer</summary>
<p>B</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-49.png" data-desc-position="bottom"><img alt="img" src="../assets/4-49.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-50.png" data-desc-position="bottom"><img alt="img" src="../assets/4-50.png"></a></p>
</details>
<hr>
<h3 id="ipv4mac">IPv4地址与MAC地址<a class="headerlink" href="#ipv4mac" title="Permanent link">¶</a></h3>
<h4 id="ipv4mac_1">IPv4地址与MAC地址的封装位置<a class="headerlink" href="#ipv4mac_1" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-51.png" data-desc-position="bottom"><img alt="img" src="../assets/4-51.png"></a></p>
<hr>
<h4 id="ipv4mac_2">数据报传送过程中IPv4地址与MAC地址的变化情况<a class="headerlink" href="#ipv4mac_2" title="Permanent link">¶</a></h4>
<ul>
<li>在数据包的传送过程中，数据包的<strong>源IP地址和目的IP地址保持不变</strong>；</li>
<li>在数据包的传送过程中，数据包的<strong>源MAC地址</strong>和<strong>目的MAC地址</strong>逐链路（或逐网络）改变。</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-52.png" data-desc-position="bottom"><img alt="img" src="../assets/4-52.png"></a></p>
<p>如何通过IP地址找出其相应的MAC地址？</p>
<ul>
<li>地址解析协议ARP</li>
</ul>
<details class="note">
<summary>Note</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-130.png" data-desc-position="bottom"><img alt="img" src="../assets/4-130.png"></a></p>
</details>
<details class="example">
<summary>PPT 上的练习</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-53.png" data-desc-position="bottom"><img alt="img" src="../assets/4-53.png"></a></p>
</details>
<hr>
<h4 id="ipv4mac_3">IPv4地址与MAC地址的关系<a class="headerlink" href="#ipv4mac_3" title="Permanent link">¶</a></h4>
<p>如果仅使用MAC地址进行通信，则会出现以下主要问题：</p>
<ul>
<li>因特网中的每台路由器的<strong>路由表</strong>中就必须记录因特网上<strong>所有主机和路由器各接口的MAC地址</strong>。</li>
<li>手工给各路由器配置路由表几乎是不可能完成的任务，即使使用路由协议让路由器通过相互交换路由信息来自动构建路由表，也会因为<strong>路由信息需要包含海量的MAC地址信息而严重占用通信资源</strong>。</li>
<li><strong>包含海量MAC地址的路由信息需要路由器具备极大的存储空间</strong>，并且会给<strong>分组的查表转发</strong>带来非常大的<strong>时延</strong>。</li>
</ul>
<p>因特网的网际层<strong>使用IP地址进行寻址</strong>，就可使因特网中各<strong>路由器</strong>的路由表中的路由记录的数量大大减少，因为只需记录<strong>部分网络</strong>的网络地址，而不是记录每个网络中各通信设备的各接口的MAC地址。</p>
<ul>
<li>路由器收到IP数据报后，根据其首部中的目的IP地址的网络号部分，基于自己的路由表进行查表转发。</li>
</ul>
<p>查表转发的结果可以指明IP数据报的下一跳路由器的IP地址，但无法指明该IP地址所对应的MAC地址。因此，在数据链路层封装该IP数据报成为帧时，帧首部中的目的MAC地址字段就无法填写，该问题需要使用网际层中的<strong>地址解析协议ARP</strong>来解决。</p>
<details class="example" open="open">
<summary>question</summary>
<p>一台主机有两个IP地址，一个地址是192.168.11.25,另一个地址可能是()。</p>
<p>A.192.168.11.0 B.192.168.11.26 C.192.168.13.25 D.192.168.11.24</p>
</details>
<details class="note">
<summary>answer</summary>
<p>C</p>
<p>在网络中，允许一台主机有两个或两个以上的 IP 地址，若一台主机有两个或两个以上 IP 地址，则说明这台主机属于两个或两个以上的网络。地址 192.168.11.25属于 C 类地址，所以与 A、B 和 D 属于同一个网络;只有 C 的网络号不同，表明它属于不同的网络。</p>
</details>
<hr>
<h3 id="_10">地址解析协议<a class="headerlink" href="#_10" title="Permanent link">¶</a></h3>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-54.png" data-desc-position="bottom"><img alt="img" src="../assets/4-54.png"></a></p>
<ul>
<li>A知道B的IP地址</li>
<li>A不知道B的MAC地址</li>
<li>A的数据链路层封装MAC帧时，<strong>无法填写目的MAC地址</strong>！</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-55.png" data-desc-position="bottom"><img alt="img" src="../assets/4-55.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-56.png" data-desc-position="bottom"><img alt="img" src="../assets/4-56.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-57.png" data-desc-position="bottom"><img alt="img" src="../assets/4-57.png"></a></p>
<p>通过ARP自动获取，生命周期默认为两分钟。</p>
<p>手工配置，不同操作系统下的生命周期不同，例如系统重启后不存在或系统重启后依然有效。</p>
<ul>
<li>转发表中的MAC地址与交换机接口号的对应关系记录也要周期性删除，因为这种对应关系并不是永久不变的。</li>
<li>同理，ARP高速缓存表中的IP地址与MAC地址的对应关系也并不是永久不变的。例如，主机更换了一块新网卡。</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-58.png" data-desc-position="bottom"><img alt="img" src="../assets/4-58.png"></a></p>
<p>ARP协议的相关注意事项：</p>
<ul>
<li>由于ARP协议的主要用途是从网际层使用的IP地址解析出在数据链路层使用的MAC地址。因此，有的教材将ARP协议划归在<strong>网际层</strong>，而有的教材将ARP协议划归在<strong>数据链路层</strong>。这两种做法都是可以的。</li>
<li>除了本节课介绍的ARP请求报文和响应报文，<strong>ARP协议还有其他类型的报文</strong>，例如用于检查IP地址冲突的“无故ARP”（Gratuitous ARP）。</li>
<li>由于ARP协议很早就制定出来了（1982年11月），当时并没有考虑网络安全问题。因此，ARP协议没有安全验证机制，存在<strong>ARP欺骗和攻击</strong>等问题。</li>
</ul>
<details class="example" open="open">
<summary>question</summary>
<p>某网络拓扑如下图所示，H1与H2的默认网关和子网掩码都分别配置为192.168.3.1和255.255.255.0,H3和H4的默认网关和子网掩码都分别配置为192.168.3.254和255.255.255.128,初始时所有设备的ARP缓存均为空。则下列说法中错误的是()。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-102.png" data-desc-position="bottom"><img alt="img" src="../assets/4-102.png"></a></p>
<p>A.若H1向H3发送数据，则H2、H3、H4都能收到H1发来的ARP请求报文</p>
<p>B.若H3向H1发送数据，则H3能收到H1发来的ARP响应报文</p>
<p>C.若H1向H2发送数据，则H2、H3、H4都能收到H1发来的ARP请求报文</p>
<p>D.若H3向H4发送数据，则H3能收到H4发来的ARP响应报文</p>
</details>
<details class="note">
<summary>answer</summary>
<p>B</p>
<p>图中 H1, H2, H3, H4 以及路由器 R2 的接口 E1，通过交换机（Switch）和集线器（Hub）连接在一起。在物理链路层（Layer 2），它们都在同一个<strong>广播域</strong>中。这意味着，任何一台主机发送的 ARP 请求（广播帧），其他所有主机都能在物理上收到。</p>
<p>A. 若 H1 向 H3 发送数据，则 H2、H3、H4 都能收到 H1 发来的 ARP 请求报文</p>
<ol>
<li><strong>源主机判断：</strong> H1 (<code>192.168.3.2/24</code>) 想要找 H3 (<code>192.168.3.251</code>)。</li>
<li><strong>子网匹配：</strong> H1 用自己的掩码 (<code>/24</code>) 计算，发现 H3 的 IP <code>192.168.3.251</code> 和自己在同一个网段内（都属于 <code>192.168.3.X</code>）。</li>
<li><strong>行为：</strong> H1 认为 H3 是直连的，于是直接发送 <strong>ARP 请求</strong>，询问“谁是 192.168.3.251？”。</li>
<li><strong>传播：</strong> ARP 请求是<strong>广播帧</strong>。</li>
</ol>
<ul>
<li>交换机收到后，转发给 H2 和 Hub。</li>
<li>Hub 收到后，转发给 H3 和 H4。</li>
</ul>
<ol start="5">
<li><strong>结论：</strong> H2、H3、H4 确实都能收到这个广播报文。</li>
</ol>
<p>B. 若 H3 向 H1 发送数据，则 H3 能收到 H1 发来的 ARP 响应报文</p>
<ol>
<li><strong>源主机判断：</strong> H3 (<code>192.168.3.251/25</code>) 想要找 H1 (<code>192.168.3.2</code>)。</li>
<li><strong>子网匹配：</strong> H3 用自己的掩码 (<code>255.255.255.128</code>) 计算：</li>
</ol>
<ul>
<li>H3 的网络号是 <code>192.168.3.128</code>。</li>
<li>H1 的 IP <code>192.168.3.2</code> 显然不在 <code>129~254</code> 这个范围内。</li>
</ul>
<ol start="3">
<li><strong>行为：</strong> <strong>H3 判定 H1 在“局域网外部”</strong>。因此，H3 <strong>不会</strong>直接去请求 H1 的 MAC 地址。</li>
<li><strong>实际操作：</strong> H3 会去请求<strong>默认网关</strong>的 MAC 地址。H3 的网关是 <code>192.168.3.254</code>（R2 的 E1 接口）。</li>
</ol>
<ul>
<li>H3 发送 ARP 请求：“谁是 192.168.3.254？”</li>
<li>R2 回复 ARP 响应。</li>
</ul>
<ol start="5">
<li><strong>数据发送：</strong> H3 将发往 H1 的 IP 数据报封装在 MAC 帧中，目的 MAC 地址写的是<strong>网关 R2 的地址</strong>，而不是 H1 的地址。</li>
<li><strong>结论：</strong> H3 根本就没有向 H1 发送 ARP 请求，H1 自然也不会给 H3 发送 ARP 响应。H3 得到的是网关 R2 的 ARP 响应。</li>
</ol>
<p>C. 若 H1 向 H2 发送数据，则 H2、H3、H4 都能收到 H1 发来的 ARP 请求报文</p>
<ol>
<li><strong>源主机判断：</strong> H1 (<code>192.168.3.2/24</code>) 找 H2 (<code>192.168.3.3</code>)。</li>
<li><strong>子网匹配：</strong> 同一网段 (<code>/24</code>)。</li>
<li><strong>行为：</strong> H1 发送 ARP 广播请求：“谁是 192.168.3.3？”</li>
<li><strong>传播：</strong> 同样因为是广播帧，交换机和 Hub 会将其洪泛到整个网络。</li>
<li><strong>结论：</strong> H2、H3、H4 都会在物理层收到这个信号（虽然 H3 和 H4 解析后发现不是找自己的，会丢弃，但确实“收到”了）。</li>
</ol>
<p>D. 若 H3 向 H4 发送数据，则 H3 能收到 H4 发来的 ARP 响应报文</p>
<ol>
<li><strong>源主机判断：</strong> H3 (<code>192.168.3.251/25</code>) 找 H4 (<code>192.168.3.252</code>)。</li>
<li><strong>子网匹配：</strong> H4 的 IP 在 H3 的子网范围 <code>192.168.3.128/25</code> 内。</li>
<li><strong>行为：</strong> H3 判定 H4 是局域网邻居，直接发送 ARP 请求：“谁是 192.168.3.252？”</li>
<li><strong>传播与响应：</strong></li>
</ol>
<ul>
<li>Hub 将请求发给 H4。</li>
<li>H4 收到请求，发现是找自己的，于是发送 <strong>ARP 响应报文</strong>（单播）给 H3。</li>
</ul>
<ol start="5">
<li><strong>结论：</strong> H3 能够收到 H4 的响应，并完成通信。</li>
</ol>
</details>
<hr>
<h3 id="ip_2">IP数据报的发送和转发流程<a class="headerlink" href="#ip_2" title="Permanent link">¶</a></h3>
<p>IP数据报的发送和转发过程包含以下两个过程：</p>
<ul>
<li><strong>主机</strong>发送IP数据报</li>
<li><strong>路由器</strong>转发IP数据报</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>为了将重点放在TCP/IP体系结构的网际层发送和转发IP数据报的过程上，在之后的举例中，将忽略以下过程：</p>
<ol>
<li>
<p>使用ARP协议来获取目的主机或路由器接口的MAC地址的过程。</p>
</li>
<li>
<p>以太网交换机自学习和转发帧的过程。</p>
</li>
</ol>
</div>
<hr>
<h4 id="_11">第一阶段：源主机的判断与发送（出发）<a class="headerlink" href="#_11" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-59.png" data-desc-position="bottom"><img alt="img" src="../assets/4-59.png"></a></p>
<p>当源主机（例如图中的 <strong>主机 C：192.168.0.3</strong>）想要发送数据给目的主机（例如图中的 <strong>主机 F：192.168.0.131</strong>）时，它不会盲目发送，而是先进行一次内部计算。</p>
<ol>
<li><strong>判断是否在同一个网络（直接交付 vs 间接交付）：</strong></li>
</ol>
<p>源主机 C 知道目的主机 F 的 IP 地址。</p>
<p>源主机 C 取出 F 的 IP 地址与 <strong>C 自己的子网掩码（/25）</strong> 进行“与运算（AND）”。</p>
<p>源主机 C 比较这个结果与 <strong>自己的网络地址（192.168.0.0）</strong>。</p>
<ul>
<li><strong>结论：</strong> 结果<strong>不相同</strong>（<code>192.168.0.128</code> ≠ <code>192.168.0.0</code>）。这意味着目的主机 F 在另一个网络，必须进行 <strong>间接交付</strong>。</li>
</ul>
<ol start="2">
<li><strong>寻找默认网关：</strong></li>
</ol>
<ul>
<li>既然需要间接交付，源主机 C 就需要找“帮手”。这个帮手就是配置在主机 C 里的 <strong>默认网关（Default Gateway）</strong>。</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-60.png" data-desc-position="bottom"><img alt="img" src="../assets/4-60.png"></a></p>
<ul>
<li>主机 C 的默认网关指向了路由器 R 的接口 0：<code>192.168.0.126</code>。</li>
<li>于是，主机 C 将数据报封装成帧，发送给路由器 R。</li>
</ul>
<hr>
<h4 id="_12">第二阶段：路由器的处理与查表（中转）<a class="headerlink" href="#_12" title="Permanent link">¶</a></h4>
<p>当路由器 R 从接口 0 收到这个 IP 数据报后，会执行一系列严谨的操作（以图中 <strong>主机 A -&gt; 主机 D</strong> 为例）：</p>
<ol>
<li><strong>检查数据报的有效性：</strong></li>
</ol>
<ul>
<li>路由器首先检查 IP 首部。</li>
<li><strong>生存时间（TTL）：</strong> 是否已经减为 0？如果结束则丢弃。</li>
<li><strong>首部校验和：</strong> 是否有误码？如果有错则丢弃。</li>
<li><em>注：如果丢弃，路由器会向源主机发送 ICMP 差错报告。</em></li>
</ul>
<ol start="2">
<li><strong>查路由表（核心步骤）：</strong></li>
</ol>
<ul>
<li>如果数据报有效，路由器提取出首部中的 <strong>目的 IP 地址</strong>（例如 <code>192.168.0.129</code>）。</li>
<li>路由器用这个目的 IP 与路由表中每一行的 <strong>子网掩码</strong> 进行“与运算”。</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-61.png" data-desc-position="bottom"><img alt="img" src="../assets/4-61.png"></a></p>
<p><strong>比对过程：</strong></p>
<ul>
<li>用 <code>192.168.0.129</code> AND <code>255.255.255.128</code> = <code>192.168.0.128</code>。</li>
<li>
<p>查看路由表，发现有一行记录：目的网络 <code>192.168.0.128</code>，下一跳为 <code>接口 1 直连</code>。</p>
</li>
<li>
<p><strong>匹配成功！</strong> 路由器知道了该数据包应该从 <strong>接口 1</strong> 转发出去。</p>
</li>
</ul>
<hr>
<h4 id="_13">第三阶段：转发与隔离（到达与防护）<a class="headerlink" href="#_13" title="Permanent link">¶</a></h4>
<ol>
<li><strong>转发给目的主机：</strong></li>
</ol>
<ul>
<li>路由器将数据包通过 <strong>接口 1</strong> 发送到右边的网络（交换式以太网 2）。</li>
<li>因为接口 1 与目的主机 D 在同一个网络（直连），路由器可以通过 ARP 协议找到主机 D 的 MAC 地址，直接将数据帧交付给主机 D。</li>
</ul>
<ol start="2">
<li><strong>特殊情况：广播隔离（Broadcast Isolation）：</strong></li>
</ol>
<ul>
<li>最后特别提到了一种情况：如果源主机发送的是 <strong>广播包</strong>（目的地址为本网段广播地址，如 <code>192.168.0.127</code>）。</li>
<li>该广播包会传遍左边的网络（主机 A、B、C 都能收到）。</li>
<li>但是，<strong>路由器不会转发广播包</strong>。路由器就像一道防火墙，将广播限制在左边的网络内，防止了“广播风暴”波及到右边的网络。这就是<strong>路由器隔离广播域</strong>的作用。</li>
</ul>
<details class="example">
<summary>PPT 上的练习</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-62.png" data-desc-position="bottom"><img alt="img" src="../assets/4-62.png"></a></p>
<p>(1) 设备1、设备2和设备3分别应选择什么类型网络设备？</p>
<p><strong>答案：</strong></p>
<ul>
<li>
<p><strong>设备1：路由器 (Router)</strong></p>
</li>
<li>
<p><strong>设备2：以太网交换机 (Ethernet Switch)</strong></p>
</li>
<li>
<p><strong>设备3：以太网交换机 (Ethernet Switch)</strong></p>
</li>
</ul>
<p>连接在设备2上的主机 H1 和 H2 的 IP 地址分别为 <code>192.168.1.2/26</code> 和 <code>192.168.1.3/26</code>。它们的子网掩码都是 <code>/26</code>（即 <code>255.255.255.192</code>）。计算可知，H1 和 H2 处于同一个子网（网络号均为 <code>192.168.1.0</code>）。在同一个子网内的主机通信，通常只需要二层设备互联即可。此外，它们的默认网关都是 <code>192.168.1.1</code>，指向了上级设备。因此，设备2起到了汇聚同一网段主机的作用，应选择 <strong>以太网交换机</strong>。</p>
<p>同理，主机 H3 (<code>192.168.1.66/26</code>) 和 H4 (<code>192.168.1.67/26</code>) 的网络号均为 <code>192.168.1.64</code>。它们也处于同一个子网，且网关相同 (<code>192.168.1.65</code>)。因此，设备3也应选择 <strong>以太网交换机</strong>。</p>
<p>设备1连接了三个不同的部分：</p>
<ul>
<li>
<p>接口 IF1 连接路由器 R（子网 <code>192.168.1.252/30</code>）。</p>
</li>
<li>
<p>接口 IF2 连接左侧子网（<code>192.168.1.0/26</code>）。</p>
</li>
<li>
<p>接口 IF3 连接右侧子网（<code>192.168.1.64/26</code>）。</p>
</li>
</ul>
<p>因为设备1需要连接三个<strong>不同</strong>的逻辑网段（子网），并实现这些不同网段之间的数据转发，这正是路由器的功能（隔离广播域、三层转发）。交换机无法隔离广播域，也无法连接不同网段（除非是三层交换机，但题目选项明确给了“路由器”和“交换机”两类，且语境为基础网络互联），因此设备1必须是 <strong>路由器</strong>。</p>
<p>(2) 设备1、设备2和设备3中，哪几个设备的接口需要配置IP地址？并为对应的接口配置正确的IP地址。</p>
<p><strong>答案：</strong></p>
<ul>
<li>
<p>需要配置IP地址的设备是：<strong>设备1</strong>。</p>
</li>
<li>
<p>设备2和设备3是二层交换机，其接口无需配置IP地址。</p>
</li>
</ul>
<p><strong>设备1的接口IP配置如下：</strong></p>
<ul>
<li>
<p><strong>IF1:</strong> <code>192.168.1.254</code> (掩码 <code>255.255.255.252</code> 或 <code>/30</code>)</p>
</li>
<li>
<p><strong>IF2:</strong> <code>192.168.1.1</code> (掩码 <code>255.255.255.192</code> 或 <code>/26</code>)</p>
</li>
<li>
<p><strong>IF3:</strong> <code>192.168.1.65</code> (掩码 <code>255.255.255.192</code> 或 <code>/26</code>)</p>
</li>
</ul>
<ol>
<li>
<p><strong>确定 IF2 的地址（面向 H1/H2）：</strong>查看主机 H1 和 H2 的配置，它们的<strong>默认网关</strong>是 <code>192.168.1.1</code>。默认网关就是路由器（设备1）连接该子网的接口地址。因此，设备1的 IF2 接口地址为 <code>192.168.1.1</code>。</p>
</li>
<li>
<p><strong>确定 IF3 的地址（面向 H3/H4）：</strong>查看主机 H3 和 H4 的配置，它们的<strong>默认网关</strong>是 <code>192.168.1.65</code>。同理，设备1的 IF3 接口地址为 <code>192.168.1.65</code>。</p>
</li>
<li>
<p><strong>确定 IF1 的地址（面向 路由器R）：</strong>设备1的 IF1 与路由器 R 的接口相连。路由器 R 的接口地址是 <code>192.168.1.253/30</code>。<code>/30</code> 子网只有 2 个可用主机地址。</p>
</li>
</ol>
<p>计算该子网范围：</p>
<ul>
<li>网络号：<code>192.168.1.252</code></li>
<li>第一个可用IP：<code>192.168.1.253</code>（已被 R 占用）</li>
<li>第二个可用IP：<code>192.168.1.254</code></li>
<li>广播地址：<code>192.168.1.255</code></li>
</ul>
<p>因此，设备1的 IF1 必须使用剩下的那个有效IP，即 <code>192.168.1.254</code>。</p>
<p>(3) 若主机H3发送一个目的地址为192.168.1.127的IP数据报，网络中哪几个主机会收到该数据报？</p>
<p><strong>答案：</strong><strong>主机 H4</strong> 会收到该数据报。</p>
<p>源主机 H3 的 IP 是 <code>192.168.1.66/26</code>，属于子网 <code>192.168.1.64/26</code>。</p>
<p>该子网的地址范围计算如下：</p>
<ul>
<li>
<p>块大小 = <span class="arithmatex">\(2^{(32-26)} = 2^6 = 64\)</span>。</p>
</li>
<li>
<p>子网起始：<code>192.168.1.64</code></p>
</li>
<li>
<p>子网结束：<code>192.168.1.64 + 63 = 192.168.1.127</code></p>
</li>
</ul>
<p>由此可见，目的地址 <code>192.168.1.127</code> 是 H3 所在子网的 <strong>广播地址 (Directed Broadcast Address)</strong>。</p>
<p>H3 发出的是一个广播帧。</p>
<p><strong>设备3（交换机）：</strong> 收到广播帧后，会向除了接收端口以外的所有端口泛洪（转发）。因此，连接在设备3上的 <strong>主机 H4</strong> 会收到这个数据报。</p>
<p><strong>设备1（路由器）：</strong> 也会在接口 IF3 收到这个广播报文。但是，路由器的重要特性是 <strong>隔离广播域</strong>（Do not forward broadcasts）。默认情况下，路由器不会将广播报文转发到其他网络（如左边的设备2网络或上边的路由器R网络）。</p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>不考虑NAT,在Internet中，IP数据报从源节点到目的节点可能需要经过多个网络和路由器。在整个传输过程中，IP数据报首部中的()。</p>
<p>A.源地址和目的地址都不会发生变化</p>
<p>B.源地址有可能发生变化而目的地址不会发生变化</p>
<p>C.源地址不会发生变化而目的地址有可能发生变化</p>
<p>D.源地址和目的地址都有可能发生变化</p>
</details>
<details class="note">
<summary>answer</summary>
<p>A</p>
<p>在 Intermet 中，IP 数据报从源节点到目的节点可能需要经过多个网络和路由器。当一个路由器接收到一个数据报时，路由器根据 IP 数据报首部的目的 IP 地址进行路由选择，并不改变源地址的取值。即使数据报被分片时，原 IP 数据报的源地址和目的地址也将复制到每个分片的首部，因此在整个传输过程中，IP 数据报首部的源 IP 地址和目的 IP 地址都不发生变化。</p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>当下列IP地址作为IP数据报的目的地址时，互联网上的路由器不会正常转发的是()。</p>
<p>A.192.172.56.23 B.172.15.34.128 C.192.168.32.17 D.172.128.45.34</p>
</details>
<details class="note">
<summary>answer</summary>
<p>C</p>
<p>互联网的路由器对目的地址是私有地址的 IP 数据报一律不进行转发。有3个私有地址段:</p>
<ul>
<li>
<p>10.0.0.0/8，即 10.0.0.0~10.255.255.255，相当于1个 A 类网络。</p>
</li>
<li>
<p>172.16.0.0/12，即 172.16.0.0~172.31.255.255，相当于 16 个连续的 B 类网络</p>
</li>
<li>
<p>192.168.0.0/16，即 192.168.0.0~192.168.255.255，相当于 256 个连续的 C 类网络</p>
</li>
</ul>
<p>所以只有选项C是内部地址，不允许出现在互联网(公网)上。</p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>现将一个IP网络划分为4个子网，若其中一个子网是192.168.1.130/26,则下列网络中不可能是另外3个子网之一的是()。</p>
<p>A.192.168.1.0/25 B.192.168.1.64/26 C.192.168.1.96/27 D.192.168.1.224/27</p>
</details>
<details class="note">
<summary>answer</summary>
<p>C</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-73.png" data-desc-position="bottom"><img alt="img" src="../assets/4-73.png"></a></p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>某网络拓扑如下图所示，路由器R1只有到达子网192.168.1.0/24的路由。为使R1可以将IP分组正确地路由到图中的所有子网，在R1中需要增加的一条路由(目的网络，子网掩码，下一跳)是</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-103.png" data-desc-position="bottom"><img alt="img" src="../assets/4-103.png"></a> </p>
<p>A.192.168.2.0  255.255.255.128  192.168.1.1</p>
<p>B.192.168.2.0  255.255.255.0  192.168.1.1</p>
<p>C.192.168.2.0  255.255.255.128  192.168.1.2</p>
<p>D.192.168.2.0  255.255.255.0  192.168.1.2</p>
</details>
<details class="note">
<summary>answer</summary>
<p>D</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-104.png" data-desc-position="bottom"><img alt="img" src="../assets/4-104.png"></a></p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>如下图所示，假设H1与H2的默认网关和子网掩码均分别配置为192.168.3.1和255.255.255.128,H3和H4的默认网关和子网掩码均分别配置为192.168.3.254和255.255.255.128,则下列现象中可能发生的是()。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-105.png" data-desc-position="bottom"><img alt="img" src="../assets/4-105.png"></a></p>
<p>A.H1不能与H2进行正常IP通信</p>
<p>B.H2与H4均不能访问Internet</p>
<p>C.H1不能与H3进行正常IP通信</p>
<p>D.H3不能与H4进行正常IP通信</p>
</details>
<details class="note">
<summary>answer</summary>
<p>C</p>
<p>从子网掩码可知 H1 和 H2 处于同一网络，H3 和 H4 处于同一网络，因此 H1 和 H2、H3 和H3 和 H4 处于不同的网络，因此需要通过路由器才H4 分别可以进行正常的 IP 通信。H1 和 H2分组时，H1 用目的 IP 地址、子网掩码逐位“与”H1能进行正常的 IP 通信，当 H1 向 H3 发送 I禹于不同的网络，需要将该 IP 分组发送到默认网关,自身的网络前缀不同，于是判定H3与H1而 H1 配置的默认网关为 192.168.3.1，但 R的 E1 接口的 IP 地址为 192.168.3.254，因此 H1 不能与 H3 进行正常的 IP 通信。注意，即使 H1的默认网关配置正确，但因为路由器不会从分组入进行转发，所以 H1 和 H3 也无法进行正常IP 通信。H2 的默认网关为 192.168.3.1，因此 H2 也不能访问 Internet;H4 的默认网关为 192.168.3.254，因此 H4 可以正常访问 Internet。</p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>在上题的图中，假设连接R1、R2和R3之间的点对点链路使用地址201.1.3.x/30,当H3访问Web服务器S时，R2转发出去的封装HTTP请求报文的IP分组是源IP地址和目的IP地址，它们分别是()。</p>
<p>A.192.168.3.251,130.18.10.1</p>
<p>B.192.168.3.251,201.1.3.9</p>
<p>C.201.1.3.8,130.18.10.1</p>
<p>D.201.1.3.10,130.18.10.1</p>
</details>
<details class="note">
<summary>answer</summary>
<p>D</p>
<p>当内网用户向公网发送 IP 分组时，NAT路由器会更改 IP 分组的源地址，因此下一步就是求 R1 的公网 IP 地址。连接 R1、R2 和 R3 之司的点对点链路使用 201.1.3.x/30 地址，可知该地址块的 IP 地址的后两位为主机号，而主机号全0和全1的 IP 地址不能分配，因此若已知路由器之间上，就可求出另一路由器接口的 IP 地址。在 R1 和 R2的点对点链路中的一个路由器接口的 IP 地相连的链路中，已知 R1端接口的 IP 地址头201.1.3.9/30，将其后8位展开成二进制为 0000 1001 .所以可分配给 R2 的 L0 接口的 IP 地址为 201.1.3.10。同理，也可求出 R2 的L1 接口的 IP 地址为的接口 L0 或 L1 转发，所以经过 R2 转发后，IP 分组 201.1.3.2。访问 Web 服务器，只能通过 R2的源地址可能为 201.1.3.10 或 201.1.3.2，目的地址为 Web 服务器的 IP 地址 130.18.10.1。</p>
</details>
<hr>
<h3 id="ipv4_7">IPv4数据报的首部格式<a class="headerlink" href="#ipv4_7" title="Permanent link">¶</a></h3>
<p>IPv4数据报的首部格式及其内容是<strong>实现IPv4协议各种功能的基础</strong>。</p>
<p>在TCP/IP标准中，各种数据格式常常以<strong>32比特（即4字节）</strong>为单位来描述。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-63.png" data-desc-position="bottom"><img alt="img" src="../assets/4-63.png"></a></p>
<p><strong>固定部分</strong>是指每个IPv4数据报都必须要包含的部分。</p>
<p>某些IPv4数据报的首部，除了包含20字节的固定部分，还包含一些可选的字段来<strong>增加IPv4数据报的功能</strong>。</p>
<p>IPv4数据报首部中的各字段或某些字段的组合，用来表达IPv4协议的相关功能。</p>
<ul>
<li>版本</li>
</ul>
<p>长度为4个比特，用来表示IP协议的版本。</p>
<p><strong>通信双方使用的IP协议的版本必须一致。目前广泛使用的IP协议的版本号为4（即IPv4）</strong>。</p>
<ul>
<li>首部长度</li>
</ul>
<p>长度为4个比特，该字段的取值<strong>以4字节为单位</strong>，用来表示IPv4数据报的首部长度。</p>
<p><strong>最小取值</strong>为二进制的0101，即十进制的5，再乘以4字节单位，<strong>表示IPv4数据报首部只有20字节固定部分</strong>。</p>
<p><strong>最大取值</strong>为二进制的1111，即十进制的15，再乘以4字节单位，<strong>表示IPv4数据报首部包含20字节固定部分和最大40字节可变部分</strong>。</p>
<ul>
<li>可选字段</li>
</ul>
<p>长度从1字节到40字节不等，用来支持排错、测量以及安全措施等功能。</p>
<p>虽然可选字段增加了IPv4数据报的功能，但这同时也使得IPv4数据报的首部长度成为可变的，这就增加了因特网中每一个路由器处理IPv4数据报的开销。</p>
<p>实际上，可选字段很少被使用。</p>
<ul>
<li>填充</li>
</ul>
<p><strong>用来确保IPv4数据报的首部长度是4字节的整数倍</strong>，使用全0进行填充。</p>
<ul>
<li>区分服务</li>
</ul>
<p>长度为8个比特，用来获得更好的服务。</p>
<p>该字段在旧标准中叫作服务类型，但实际上一直没有被使用过。</p>
<p>1998年，因特网工程任务组IETF把这个字段改名为区分服务。利用该字段的不同取值可提供不同等级的服务质量。只有在使用区分服务时该字段才起作用，一般情况下都不使用该字段。</p>
<ul>
<li>总长度（重要）</li>
</ul>
<p>长度为16个比特，该字段的取值<strong>以字节为单位</strong>，用来表示<strong>IPv4数据报的长度</strong>（<strong>首部长度+数据载荷长度</strong>）。</p>
<p>最大取值为二进制的16个比特1，即十进制的65535（很少传输这么长的IPv4数据报）。</p>
<details class="example" open="open">
<summary>question</summary>
<p>下列关于IP分组的首部检验和字段的说法中，正确的是()。</p>
<p>A.检验和字段检查的范围是整个IP分组</p>
<p>B.计算检验和的方法是对首部的每个16比特按反码运算求和再取反码</p>
<p>C.若网络层发现检验和错误，则丢弃该IP分组并发送ICMP差错报文</p>
<p>D.IP分组的检验和的计算需要加入一个伪首部</p>
</details>
<details class="note">
<summary>answer</summary>
<p>B</p>
<p>计算检验和的方法是:检验和字段只检查 IP 数据报的首部，不包括数据部分，选项A错误。</p>
<p>先把 IP 数据报的首部划分为许多 16 比特的列，用反码算术运算把所有 16 比特相加后，将得到IP 并不要求源主机重传有差错的IP 数据报，保证无的和的反码写入检验和字段，选项 B正确。</p>
<p>差错传输是由 TCP 完成的。另一方面，首音检验和只能检验 I 数据报的首部是否出错，但不知出现差错，则将差错报文传送到错误的地址是没有任道首部中的源地址字段是否出错，若源地址出错后，就丢弃该数据报，但不会发送差错报文，选何意义的，因此接收方的网络层发现检验和选项 C 错误。</p>
<p>数据报的检验和的计算不需要加入伪首部，伪首部用于计算 UDP 或 TCP 检验和:选项 D 错误。</p>
</details>
<hr>
<h4 id="ipv4-fragmentation">IPv4 数据报的分片（Fragmentation）<a class="headerlink" href="#ipv4-fragmentation" title="Permanent link">¶</a></h4>
<p>为什么需要分片？根本原因在于链路层的 <strong>MTU（最大传送单元）</strong> 限制。</p>
<ul>
<li><strong>MTU 的限制：</strong> 不同的数据链路层协议（如以太网、Wi-Fi等）对数据帧的数据载荷都有一个最大长度限制，这个限制被称为 <strong>MTU (Maximum Transmission Unit)</strong>。<em>例如：常用以太网的 MTU 值为 <span class="arithmatex">\(1500\)</span> 字节。</em></li>
<li><strong>分片的必要性：</strong> 当一个 IPv4 数据报的总长度（首部 + 数据）超过了链路层的 MTU 时，无法直接封装成一个帧进行发送。</li>
<li><strong>处理方法：</strong> IP 协议必须将这个原始的长数据报切割成若干个更小的 IPv4 数据报，这些小数据报被称为 <strong>分片 (Fragments)</strong>。</li>
</ul>
<ol>
<li>标识 (Identification)</li>
</ol>
<p>长度为16个比特，属于同一个IPv4数据报的各分片数据报应该具有相同的标识。</p>
<p>IP软件会维持一个计数器，每产生一个IPv4数据报，计数器值就加1，并将此值赋给标识字段。</p>
<ul>
<li><strong>关键点：</strong> 当一个数据报被分片时，<strong>所有分片都必须复制原始数据报的标识字段</strong>。这样，接收端（目的主机）在收到一堆乱序的分片时，查看“标识”字段，只要数值相同，就知道它们属于同一个原始数据报，从而将它们重新组装。</li>
</ul>
<ol start="2">
<li>标志 (Flags)</li>
</ol>
<p><strong>最低位 —— MF (More Fragments)：</strong></p>
<ul>
<li><span class="arithmatex">\(MF = 1\)</span>：表示后面 <strong>还有分片</strong>（即这不是最后一个分片）。</li>
<li><span class="arithmatex">\(MF = 0\)</span>：表示这是 <strong>最后一个分片</strong>。</li>
</ul>
<p><strong>中间位 —— DF (Don't Fragment)：</strong></p>
<ul>
<li><span class="arithmatex">\(DF = 1\)</span>：表示 <strong>不允许分片</strong>。如果数据报长度超过 MTU 且 <span class="arithmatex">\(DF=1\)</span>，路由器会丢弃该包并向源主机发送 ICMP 差错报告。</li>
<li><span class="arithmatex">\(DF = 0\)</span>：表示 <strong>允许分片</strong>。</li>
</ul>
<ol start="3">
<li>片偏移 (Fragment Offset)</li>
</ol>
<p>长度为13个比特，该字段的取值<strong>以8字节为单位</strong>，用来指出分片IPv4数据报的数据载荷偏移其在原IPv4数据报的位置有多远。</p>
<ul>
<li>这意味着，片偏移字段的数值 <span class="arithmatex">\(= \text{实际字节偏移量} / 8\)</span>。</li>
<li><em>解释：因为片偏移字段只有 <span class="arithmatex">\(13\)</span> 位，而 IP 数据报总长度可达 <span class="arithmatex">\(2^{16} - 1\)</span> 字节。为了能用 <span class="arithmatex">\(13\)</span> 位表示更大的范围，设计者规定该值的单位是 <span class="arithmatex">\(8\)</span> 字节。</em></li>
<li>这也隐含了一个约束：<strong>除了最后一个分片外，其他每个分片的数据载荷长度必须是 <span class="arithmatex">\(8\)</span> 的整数倍。</strong></li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-66.png" data-desc-position="bottom"><img alt="img" src="../assets/4-66.png"></a></p>
<details class="example">
<summary>PPT 上的练习</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-64.png" data-desc-position="bottom"><img alt="img" src="../assets/4-64.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-65.png" data-desc-position="bottom"><img alt="img" src="../assets/4-65.png"></a></p>
</details>
<hr>
<ul>
<li>生存时间（Time To Live，TTL）</li>
</ul>
<p>长度为8个比特，最大取值为二进制的11111111，即十进制的255。该字段的取值最初以秒为单位。因此，IPv4数据报的最大生存时间最初为255秒。路由器转发IPv4数据报时，将其首部中该字段的值减去该数据报在路由器上所耗费的时间，若结果不为0就转发，否则就丢弃。</p>
<p>生存时间字段后来改为以“<strong>跳数</strong>”为单位，<strong>路由器收到待转发的IPv4数据报时，将其首部中的该字段的值减1，若结果不为0就转发，否则就丢弃</strong>。</p>
<p>生存时间TTL字段的<strong>作用</strong> —— 防止被错误路由的IPv4数据报无限制地在因特网中兜圈。</p>
<ul>
<li>协议</li>
</ul>
<p>长度为8个比特，用来指明IPv4数据报的<strong>数据载荷是何种协议数据单元PDU</strong>。</p>
<p>常用的一些协议和相应的协议字段值</p>
<table>
<thead>
<tr>
<th style="text-align: center;">协议名称</th>
<th style="text-align: center;">协议字段值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">ICMP</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">IGMP</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: center;">TCP</td>
<td style="text-align: center;">6</td>
</tr>
<tr>
<td style="text-align: center;">UDP</td>
<td style="text-align: center;">17</td>
</tr>
<tr>
<td style="text-align: center;">IPv6</td>
<td style="text-align: center;">41</td>
</tr>
<tr>
<td style="text-align: center;">OSPF</td>
<td style="text-align: center;">89</td>
</tr>
</tbody>
</table>
<ul>
<li>首部检验和</li>
</ul>
<p>长度为16个比特，用于检测IPv4数据报在传输过程中其<strong>首部是否出现了差错</strong>。</p>
<p>IPv4数据报每经过一个路由器，其首部中的某些字段的值（例如生存时间TTL、标志以及片偏移等）都可能发生变化，因此<strong>路由器都要重新计算一下首部检验和</strong>。</p>
<ol>
<li>核心算法基础：二进制反码求和</li>
</ol>
<p><strong>基本单位：</strong> 将数据划分为若干个 <strong>16位（16-bit）</strong> 的字序列。</p>
<p><strong>运算规则（反码算术运算）：</strong></p>
<ul>
<li><strong>普通加法：</strong> <span class="arithmatex">\(0+0=0, 0+1=1, 1+1=0\)</span> (进位)。</li>
<li><strong>循环进位（核心点）：</strong> 如果最高位（第16位）相加后产生了进位（Overflow），<strong>不能丢弃这个进位，而是要将这个进位加到结果的最低位（加1）</strong>。</li>
<li>这就是所谓的“反码算术运算求和”。</li>
</ul>
<ol start="2">
<li>发送端的计算流程（生成检验和）</li>
</ol>
<p>发送方负责生成检验和，流程如下：</p>
<ol>
<li><strong>置零：</strong> 首先将 IP 首部中的“首部检验和”字段 <strong>置为全 0</strong>。</li>
<li><strong>分段：</strong> 将整个 IP 首部（包括刚才置为 0 的检验和字段）看作是一串由 <strong>16位</strong> 数据组成的序列（字1, 字2, ..., 字n）。</li>
<li><strong>求和：</strong> 对这些 16 位的二进制数进行 <strong>二进制反码算术运算求和</strong>。</li>
<li><strong>取反：</strong> 将计算出来的结果进行 <strong>取反码</strong> 运算（即 0 变 1，1 变 0）。</li>
<li>
<p><strong>填入：</strong> 将取反后的结果写入 IP 首部的“首部检验和”字段中。</p>
</li>
<li>
<p>接收端的验证流程（检查错误）</p>
</li>
</ol>
<p>接收方（包括路由器和目的主机）收到数据报后，需要检查首部是否出错，流程如下（对应图片1）：</p>
<ol>
<li><strong>分段：</strong> 将收到的整个 IP 首部（此时检验和字段里已经是发送方填好的数值了）划分为 16 位的序列。</li>
<li><strong>求和：</strong> 对所有 16 位的字进行 <strong>二进制反码算术运算求和</strong>。</li>
<li><strong>取反：</strong> 对求和结果进行 <strong>取反码</strong>。</li>
<li><strong>判断：</strong></li>
</ol>
<ul>
<li><strong>结果为 0：</strong> 表示首部 <strong>没有差错</strong>，保留数据报，进行后续处理。</li>
<li><strong>结果不为 0：</strong> 表示首部 <strong>出现差错</strong>，路由器或主机将 <strong>直接丢弃</strong> 该数据报（IP 协议不负责重传，那是 TCP 的事）。</li>
</ul>
<p><strong>为什么要这样设计？</strong></p>
<ul>
<li>假设发送方计算的原始和是 <span class="arithmatex">\(S\)</span>，那么发送的检验和就是 <span class="arithmatex">\(\sim S\)</span>（<span class="arithmatex">\(S\)</span> 的反码）。</li>
<li>接收方在计算时，实际上是将首部所有数据（和为 <span class="arithmatex">\(S\)</span>）与检验和字段（<span class="arithmatex">\(\sim S\)</span>）相加。</li>
<li>在二进制反码运算中，一个数和它的反码相加，<span class="arithmatex">\(A + (\sim A) = 111...1\)</span>（全 1，在反码算术中代表 -0）。</li>
<li>最后接收方再对结果取反：<span class="arithmatex">\(\sim (111...1) = 000...0\)</span>。</li>
<li>所以，如果结果是 0，证明传输过程中没有比特发生翻转。</li>
</ul>
<p>上述检验和的计算方法不仅用于IP协议，还用于运输层的用户数据报协议UDP和传输控制协议TCP，常被称为<strong>因特网检验和</strong>（Internet Checksum）。这种检验和的检错性能虽然不如CRC，但更易用软件实现。</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>由于网际层并不向其高层提供可靠传输的服务，并且计算首部检验和是一项耗时的操作，因此在IPv6中，路由器不再计算首部检验和，从而更快转发IP数据报。</p>
</div>
<ul>
<li>源IP地址</li>
</ul>
<p>长度为32个比特，用来填写发送IPv4数据报的源主机的IPv4地址。</p>
<ul>
<li>目的IP地址</li>
</ul>
<p>长度为32个比特，用来填写接收IPv4数据报的目的主机的IPv4地址。</p>
<details class="example">
<summary>Example</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-126.png" data-desc-position="bottom"><img alt="img" src="../assets/4-126.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-127.png" data-desc-position="bottom"><img alt="img" src="../assets/4-127.png"></a></p>
</details>
<hr>
<h2 id="_14">静态路由配置<a class="headerlink" href="#_14" title="Permanent link">¶</a></h2>
<p>静态路由配置是指用户或网络运维人员使用路由器的相关命令给路由器<strong>人工配置路由表</strong>。</p>
<p>人工配置方式<strong>简单、开销小</strong>、但<strong>不能及时适应网络状态（流量、拓扑等）的变化</strong>，一般只在小规模网络中采用。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-67.png" data-desc-position="bottom"><img alt="img" src="../assets/4-67.png"></a></p>
<p>使用一条默认路由条目，替代了去往因特网中众多网络的海量路由条目。</p>
<p>默认路由条目中的目的网络0.0.0.0/0，其中0.0.0.0表示任意网络，而网络前缀“/0”（相应的地址掩码为0.0.0.0）是最短的网络前缀。</p>
<p>路由器在查找转发表转发IP数据报时，遵循“最长前缀匹配”的原则，因此默认路由条目的<strong>匹配优先级最低</strong>。</p>
<hr>
<h3 id="_15"><strong>特定主机路由</strong><a class="headerlink" href="#_15" title="Permanent link">¶</a></h3>
<p>出于某种安全问题的考虑，同时为了使网络运维人员更方便地控制网络和测试网络，特别是在对网络的连接或路由表进行排错时，指明到某一台主机的特定主机路由是十分有用的。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-68.png" data-desc-position="bottom"><img alt="img" src="../assets/4-68.png"></a></p>
<p>特定主机路由条目中的目的网络192.168.2.1/32，其中192.168.2.1是特定主机的IP地址，而网络前缀“/32”（相应地址掩码为255.255.255.255）是最长的网络前缀。</p>
<p>路由器在查找转发表转发IP数据报时，遵循“最长前缀匹配”的原则，因此特定主机路由条目的<strong>匹配优先级最高</strong>。</p>
<p>在查表转发去往192.168.2.1这台特定主机的IP数据报时，这两个路由条目都可以匹配，遵循“<strong>最长前缀匹配</strong>”的原则，按照<strong>匹配优先级最高</strong>的特定主机路由条目进行转发。</p>
<hr>
<p>进行静态路由配置需要认真考虑和谨慎操作，否则可能出现以下问题：</p>
<ul>
<li>路由条目<strong>配置错误</strong>，甚至导致出现<strong>路由环路</strong>。</li>
<li>聚合路由条目时可能<strong>引入不存在的网络</strong>。</li>
</ul>
<hr>
<h2 id="_16">因特网的路由选择协议<a class="headerlink" href="#_16" title="Permanent link">¶</a></h2>
<h3 id="_17">路由选择分类<a class="headerlink" href="#_17" title="Permanent link">¶</a></h3>
<p><strong>静态路由选择</strong></p>
<ul>
<li>采用<strong>人工配置</strong>的方式给路由器添加网络路由、默认路由和特定主机路由等路由条目。</li>
<li>静态路由选择<strong>简单、开销小</strong>，但<strong>不能及时适应网络状态</strong>（流量、拓扑等）的变化。</li>
<li>静态路由选择一般只在<strong>小规模网络</strong>中采用。</li>
</ul>
<p><strong>动态路由选择</strong></p>
<ul>
<li>路由器通过<strong>路由选择协议</strong>自动获取路由信息。</li>
<li>动态路由选择<strong>比较复杂、开销比较大</strong>，但能<strong>较好地适应</strong>网络状态的变化。</li>
<li>动态路由选择适用于<strong>大规模网络</strong>。</li>
</ul>
<hr>
<h3 id="_18">因特网采用分层次的路由选择协议<a class="headerlink" href="#_18" title="Permanent link">¶</a></h3>
<p>因特网是全球最大的互联网，它所采取的路由选择协议具有以下三个主要特点：</p>
<ol>
<li>自适应</li>
</ol>
<p>因特网采用<strong>动态路由</strong>选择，能较好地适应网络状态的变化。</p>
<ol start="2">
<li>分布式</li>
</ol>
<p>因特网中的<strong>各路由器</strong>通过相互间的信息交互，<strong>共同完成路由信息的获取和更新</strong>。</p>
<ol start="3">
<li>分层次</li>
</ol>
<p>将整个因特网划分为许多较小的<strong>自治系统</strong>（Autonomous System，AS）。</p>
<p>在自治系统内部和外部采用不同类别的路由选择协议，分别进行路由选择。</p>
<details class="example" open="open">
<summary>question</summary>
<p>在计算机网络中，路由选择协议的功能不包括()。</p>
<p>A.交换网络状态或通路信息</p>
<p>B.选择到达目的地的最佳路径</p>
<p>C.更新路由表</p>
<p>D.发现下一跳的物理地址</p>
</details>
<details class="note">
<summary>answer</summary>
<p>D</p>
<p>路由选择协议的功能通常包括:获取网络拓扑信息、构建路由表、在网络中更新路由信息、选择到达每个目的网络的最优路径、识别一个网络的无环通路等。发现下一跳的物理地址一般是通过其他方式(如 ARP)来实现的，不属于路由选择协议的功能。</p>
</details>
<hr>
<h3 id="_19">路由信息协议<a class="headerlink" href="#_19" title="Permanent link">¶</a></h3>
<h4 id="rip">路由信息协议RIP的相关基本概念<a class="headerlink" href="#rip" title="Permanent link">¶</a></h4>
<p>路由信息协议（Routing Information Protocol，RIP）是内部网关协议中最先得到广泛使用的协议之一，其相关标准文档为[RFC 1058]。</p>
<p>RIP要求自治系统AS内的每一个路由器，都要维护从它自己到AS内其他每一个网络的距离记录。这是一组距离，称为<strong>距离向量</strong>（Distance-Vector，D-V）。</p>
<p>RIP使用<strong>跳数</strong>（Hop Count）作为度量（Metric）来衡量到达目的网络的<strong>距离</strong>。</p>
<ul>
<li>RIP将路由器到<strong>直连网络</strong>的距离定义为1。</li>
<li>RIP将路由器到<strong>非直连网络</strong>的距离定义为所经过的<strong>路由器数加1</strong>。</li>
<li>RIP允许一条路径最多只能包含15个路由器，<strong>距离等于16时相当于不可达</strong>。因此<strong>RIP只适用于小型互联网</strong>。</li>
</ul>
<p>RIP认为<strong>好的路由</strong>就是“距离短”的路由，也就是所<strong>通过路由器数量最少</strong>的路由。</p>
<p>当到达同一目的网络有多条RIP距离相等的路由时，可以进行<strong>等价负载均衡</strong>，也就是将通信量均衡地分布到多条等价的路径上。</p>
<p>RIP具有以下三个重要特点：</p>
<ul>
<li>和谁交换信息：仅和<strong>相邻路由器</strong>交换信息。</li>
<li>交换什么信息：路由器自己的<strong>路由表</strong>。即本路由器到所在自治系统AS中各网络的最短RIP距离，以及到各网络应经过的下一跳路由器。</li>
<li>何时交换信息：<strong>周期性交换</strong>（例如，每个约30秒）。为了加快RIP的收敛速度，当网络拓扑发生变化时，路由器要及时向相邻路由器通告拓扑变化后的路由信息，这称为<strong>触发更新</strong>。</li>
</ul>
<hr>
<h4 id="rip_1">RIP的基本工作过程<a class="headerlink" href="#rip_1" title="Permanent link">¶</a></h4>
<ol>
<li>路由器刚开始工作时，<strong>只知道自己到直连网络的RIP距离为1</strong>。</li>
<li>每个路由器<strong>仅和相邻路由器周期性地交换并更新路由信息</strong>。</li>
<li>若干次交换和更新后，每个路由器都知道到达本自治系统AS内各网络的最短距离和下一跳路由器，称为<strong>收敛</strong>。</li>
</ol>
<hr>
<h4 id="rip_2">RIP的距离向量算法<a class="headerlink" href="#rip_2" title="Permanent link">¶</a></h4>
<p>当路由器 D 收到邻居 C 发来的路由表时，D 不能直接用，必须先对这张表进行“修改”。因为数据包要先从 D 走到 C（经过 1 跳），才能利用 C 的路由信息。</p>
<p><strong>修改规则：</strong></p>
<ol>
<li><strong>所有距离 +1：</strong> 把 C 发来的所有目的网络的距离都加 <span class="arithmatex">\(1\)</span>（代表 D 到 C 的这一跳距离）。</li>
<li><strong>下一跳改为 C：</strong> 因为 D 是通过 C 获得这些信息的，所以对于 D 来说，这些网络的下一跳自然就是 C。</li>
</ol>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-69.png" data-desc-position="bottom"><img alt="img" src="../assets/4-69.png"></a></p>
<p>D 将“修改后的 C 表”（以下简称<strong>新表</strong>）与自己原本的路由表（以下简称<strong>旧表</strong>）逐条进行对比。这里涉及 <strong>5 种不同的更新逻辑</strong>：</p>
<ol>
<li>相同的下一跳，必须更新（哪怕距离变远）</li>
</ol>
<p>虽然新距离 (<span class="arithmatex">\(5\)</span>) 比旧距离 (<span class="arithmatex">\(2\)</span>) 变大了，看起来是“坏消息”，但因为旧路由的下一跳<strong>就是 C</strong>。这说明 D 之前就是依靠 C 去往 N2 的。现在 C 告诉你路变远了（可能是网络拓扑发生了变化），D 别无选择，必须听信 C 的最新消息。</p>
<ol start="2">
<li>发现了新的网络，添加路由</li>
</ol>
<p>这是一个 D 之前不知道的目的地。既然 C 能到达，D 就可以通过 C 到达。</p>
<ol start="3">
<li>不同的下一跳，新路由更短，更新（择优）</li>
</ol>
<p>D 原本走 F 去 N6 需要 <span class="arithmatex">\(8\)</span> 跳，现在发现走 C 去 N6 只需要 <span class="arithmatex">\(5\)</span> 跳。显然 <span class="arithmatex">\(5 &lt; 8\)</span>，走 C 更快。</p>
<ol start="4">
<li>不同的下一跳，距离相等，负载均衡</li>
</ol>
<p>走 E 需要 <span class="arithmatex">\(4\)</span> 跳，走 C 也需要 <span class="arithmatex">\(4\)</span> 跳。两条路一样近。所以<strong>不替换，但可添加</strong>。通常 RIP 协议支持等价负载均衡，即保留两条路径，让数据包交替走，以分担流量。</p>
<ol start="5">
<li>不同的下一跳，新路由更远，不更新（忽略）</li>
</ol>
<p>D 原本走 F 只需要 <span class="arithmatex">\(4\)</span> 跳，C 建议走它那边，但需要 <span class="arithmatex">\(6\)</span> 跳。既然下一跳不同（不是必须听信的情况），且新路更远，D 当然选择维持现状，不走冤枉路。所以<strong>不更新</strong>。保留原有的 N9 路由信息。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-70.png" data-desc-position="bottom"><img alt="img" src="../assets/4-70.png"></a></p>
<p>除了上述RIP路由条目更新规则，在RIP的距离向量算法中还包含以下一些<strong>时间参数</strong>：</p>
<ul>
<li>路由器每隔<strong>大约30秒</strong>向其所有相邻路由器发送路由更新报文。</li>
<li>若<strong>180秒</strong>（默认）没有收到某条路由条目的更新报文，则把该路由条目标记为无效（即把RIP距离设置为16，表示不可达），若再过一段时间（如120秒），还没有收到该路由条目的更新报文，则将该路由条目从路由表中删除。</li>
</ul>
<details class="example">
<summary>PPT 上的练习</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-71.png" data-desc-position="bottom"><img alt="img" src="../assets/4-71.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-72.png" data-desc-position="bottom"><img alt="img" src="../assets/4-72.png"></a></p>
</details>
<hr>
<h4 id="rip_3">RIP存在的问题<a class="headerlink" href="#rip_3" title="Permanent link">¶</a></h4>
<p>这个问题的核心在于：<strong>当网络出现故障时，错误的路由信息（谣言）可能会在路由器之间反复传递，导致网络在很长一段时间内无法稳定（收敛）。</strong></p>
<ol>
<li><strong>故障突发：</strong> 路由器 <strong>R1</strong> 直连的网络 <strong>N1</strong> 突然发生故障。</li>
<li><strong>R1 感知：</strong> R1 立刻检测到了故障，将到达 N1 的距离（跳数）修改为 <strong>16</strong>（在 RIP 协议中，16 代表不可达/无穷大）。</li>
<li><strong>关键的时间差：</strong> 按照正常逻辑，R1 应该告诉 R2 “N1 挂了”。但是，<strong>很不凑巧</strong>，在 R1 发送更新报文之前，<strong>R2 的周期性更新时间（30秒一次）先到了</strong>。</li>
<li><strong>过时的信息：</strong> R2 并不知道 N1 出事了，它按照自己旧的路由表，向 R1 发送了一条更新报文：“我有办法去 N1，距离是 2 跳（经过 R1）”。</li>
<li><strong>R1 收到更新：</strong> R1 收到了 R2 发来的“好消息”（其实是过时的谣言）。</li>
<li><strong>错误的计算：</strong> R1 心想：“我现在去不了 N1 了（直连断了），但邻居 R2 说它能去，而且距离只有 2。那我就通过 R2 去吧！”</li>
<li><strong>更新路由表：</strong> R1 按照 RIP 算法（下一跳距离+1），将自己去往 N1 的路由更新为：<strong>下一跳 R2，距离 3</strong> (<span class="arithmatex">\(2+1=3\)</span>)。</li>
</ol>
<ul>
<li><em>此时，路由环路形成了：R1 把数据发给 R2，R2 其实又要发回给 R1，因为 R2 的下一跳还是 R1。</em></li>
</ul>
<ol start="8">
<li><strong>R1 传播谣言：</strong> 又过了约 30 秒，轮到 R1 发送更新报文了。R1 告诉 R2：“我现在去 N1 的距离是 3”。</li>
<li><strong>R2 更新路由表：</strong> R2 收到后计算：“既然 R1 去 N1 是 3 跳，那我经过 R1 去 N1 就是 <span class="arithmatex">\(3+1=4\)</span> 跳”。</li>
<li><strong>结果：</strong> R2 将距离更新为 <strong>4</strong>，下一跳仍然是 R1。</li>
<li><strong>恶性循环：</strong></li>
</ol>
<ul>
<li>R2 告诉 R1：“我是 4”。 -&gt; R1 更新为 <strong>5</strong>。</li>
<li>R1 告诉 R2：“我是 5”。 -&gt; R2 更新为 <strong>6</strong>。</li>
<li>......</li>
</ul>
<ol start="12">
<li><strong>网络拥塞：</strong> 在这个过程中，如果有发往 N1 的数据包，会在 R1 和 R2 之间无限转圈（路由环路），浪费网络带宽。</li>
<li><strong>最终结局：</strong> 这样的循环会一直持续下去，直到距离数值增加到 <strong>16</strong>。</li>
<li><strong>收敛：</strong> 当距离变成 16 时，R1 和 R2 终于意识到 N1 是“不可达”的，停止更新。路由表终于恢复正确（虽然 N1 确实不可达了）。</li>
</ol>
<p>“坏消息传播得慢”的问题又被称为路由环路或<strong>RIP距离无穷计数问题</strong>。这是距离向量算法的一个固有问题。可以采取以下多种措施<strong>减少</strong>出现该问题的概率或减小该问题带来的危害：</p>
<ul>
<li>限制<strong>最大RIP距离为15</strong>（16表示不可达）。</li>
<li>当路由表发生变化时就立即发送路由更新报文（即“<strong>触发更新</strong>”），而不仅是周期性发送。</li>
<li>让路由器记录收到某个特定路由信息的接口，而不让同一路由信息再通过此接口向反方向传送（即“<strong>水平分割</strong>”）。</li>
</ul>
<details class="note">
<summary>什么是水平分割</summary>
<p>水平分割（Split Horizon） 就是路由器的一种自我约束机制：</p>
<ul>
<li>
<p>规则： 从接口 A 学到的路由，绝不再从接口 A 发回去。</p>
</li>
<li>
<p>目的： 阻止无用的路由信息回环，从根本上避免了两台路由器之间的“谣言”互传。</p>
</li>
</ul>
</details>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>使用上述措施仍无法彻底解决问题。因为在距离向量算法中，每个路由器都缺少到目的网络整个路径的完整信息，无法判断所选的路由是否出现了环路。</p>
</div>
<hr>
<h4 id="rip_4">RIP版本和相关报文的封装<a class="headerlink" href="#rip_4" title="Permanent link">¶</a></h4>
<p>现在较新的RIP版本是1998年11月公布的<strong>RIP2</strong>[RFC 2453]，已经成为因特网标准协议。与RIP1相比，RIP2可以支持<strong>变长子网掩码和CIDR</strong>。另外，RIP2还提供<strong>简单的鉴别</strong>过程并支持<strong>多播</strong>。</p>
<p>RIP相关报文使用运输层的用户数据报协议UDP进行封装，使用的<strong>UDP端口号为520</strong>。</p>
<ul>
<li>从<strong>RIP报文封装</strong>的角度看，RIP属于TCP/IP体系结构的<strong>应用层</strong>。</li>
<li>但RIP的核心功能是<strong>路由选择</strong>，这属于TCP/IP体系结构的<strong>网际层</strong>。</li>
</ul>
<hr>
<h4 id="rip_5">RIP的优缺点<a class="headerlink" href="#rip_5" title="Permanent link">¶</a></h4>
<p><strong>优点</strong></p>
<ul>
<li>实现<strong>简单</strong>，路由器开销小。</li>
<li>如果一个路由器发现了RIP距离更短的路由，那么这种更新信息就传播得很快，即“<strong>好消息传播得快</strong>”。</li>
</ul>
<p><strong>缺点</strong></p>
<ul>
<li>RIP限制了<strong>最大RIP距离为15</strong>，这就限制了使用RIP的自治系统AS的规模。</li>
<li>相邻路由器之间交换的路由信息是路由器中的<strong>完整路由表</strong>，因而随着网络规模的扩大，开销也随之增大。</li>
<li>“<strong>坏消息传播得慢</strong>”，使更新过程的收敛时间过长。因此，对于规模较大的自治系统AS，应当使用OSPF协议。</li>
</ul>
<details class="example" open="open">
<summary>question</summary>
<p>以下关于RIP的描述中，错误的是()。</p>
<p>A.RIP是基于距离-向量路由选择算法的</p>
<p>B.RIP要求内部路由器将它关于整个AS的路由信息发布出去</p>
<p>C.RIP要求内部路由器向整个AS的路由器发布路由信息</p>
<p>D.RIP要求内部路由器按照一定的时间间隔发布路由信息</p>
</details>
<details class="note">
<summary>answer</summary>
<p>C</p>
<p>RIP 规定一个路由器只向相邻路由器发布路由信息，而不像 OSPF 那样向整个域洪泛。</p>
</details>
<hr>
<h3 id="_20">开放最短路径优先协议<a class="headerlink" href="#_20" title="Permanent link">¶</a></h3>
<h4 id="ospf">开放最短路径优先OSPF的相关基本概念<a class="headerlink" href="#ospf" title="Permanent link">¶</a></h4>
<p>开放最短路径优先（Open Shortest Path First，OSPF）协议是为了<strong>克服路由信息协议RIP的缺点</strong>在1989年开发出来的。</p>
<ul>
<li>“<strong>开放</strong>”表明OSPF协议不是受某一厂商控制，而是<strong>公开发表</strong>的。</li>
<li>“<strong>最短路径优先</strong>”是因为使用了Dijkstra提出的<strong>最短路径算法</strong>（Shortest Path First，SPF）。</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>“开放最短路径优先”只是一个路由选择协议的名称，但这<strong>并不表示其他的路由选择协议不是“最短路径优先”</strong>。实际上，用于自治系统AS内部的各种路由选择协议（例如RIP），都要寻找一条“最短”的路径。</p>
</div>
<ul>
<li>OSPF是基于<strong>链路状态</strong>的，而不像RIP是基于距离向量的。</li>
<li>OSPF基于链路状态并采用最短路径算法计算路由，从算法上保证了<strong>不会产生路由环路</strong>。</li>
<li>OSPF<strong>不限制网络规模，更新效率高，收敛速度快</strong>。</li>
</ul>
<hr>
<h5 id="_21">链路状态<a class="headerlink" href="#_21" title="Permanent link">¶</a></h5>
<p>链路状态（Link State，LS）是指本路由器都和<strong>哪些路由器相邻</strong>，以及<strong>相应链路的“代价（cost）”</strong>。</p>
<ul>
<li>“<strong>代价</strong>”用来表示费用、距离、时延和带宽等，这些都由网络管理人员来决定。</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-74.png" data-desc-position="bottom"><img alt="img" src="../assets/4-74.png"></a></p>
<hr>
<h5 id="ospf_1">OSPF路由器邻居关系的建立和维护<a class="headerlink" href="#ospf_1" title="Permanent link">¶</a></h5>
<p>OSPF相邻路由器之间通过<strong>交互问候</strong>（Hello）分组来<strong>建立和维护邻居关系</strong>。</p>
<ul>
<li>问候（Hello）分组封装在<strong>IP数据报</strong>中，发往<strong>组播地址224.0.0.5</strong>。IP数据报首部中的<strong>协议号</strong>字段的取值为<strong>89</strong>，表明IP数据报的数据载荷为OSPF分组。</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>OSPF分组直接使用网际层的IP数据报进行封装，而不像RIP报文需要使用运输层用户数据报协议UDP封装。从数据包按网络体系结构逐层封装的角度看，OSPF属于网际层协议，而RIP属于应用层协议（但其核心功能是路由选择，属于网际层）。</p>
</div>
<ul>
<li>问候（Hello）分组的<strong>发送周期为10秒</strong>。</li>
<li>若<strong>40秒</strong>未收到来自邻居路由器的问候（Hello）分组，则认为邻居路由器不可达。</li>
<li>每个路由器都会建立一张<strong>邻居表</strong>。</li>
</ul>
<hr>
<h5 id="_22">链路状态通告<a class="headerlink" href="#_22" title="Permanent link">¶</a></h5>
<p>使用OSPF的每个路由器都会产生<strong>链路状态通告</strong>（Link State Advertisement，LSA）。</p>
<p>LSA中包含以下两类链路状态信息：</p>
<ul>
<li><strong>直连网络</strong>的链路状态信息</li>
<li><strong>邻居路由器</strong>的链路状态信息</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-75.png" data-desc-position="bottom"><img alt="img" src="../assets/4-75.png"></a></p>
<hr>
<h5 id="_23">链路状态更新分组<a class="headerlink" href="#_23" title="Permanent link">¶</a></h5>
<p>链路状态通告LSA被封装在<strong>链路状态更新</strong>（Link State Update，LSU）分组中，采用<strong>可靠的洪泛法</strong>（Flooding）进行发送。</p>
<ul>
<li>洪泛法的要点是路由器<strong>向自己所有的邻居路由器发送链路状态更新分组</strong>，收到该分组的各路由器又将该分组转发给自己所有的邻居路由器（但其上游路由器除外），以此类推。</li>
<li>可靠是指收到链路状态更新分组后要发送确认，<strong>收到重复的更新分组无需再次转发</strong>，但要发送一次确认。</li>
</ul>
<hr>
<h5 id="_24">链路状态数据库<a class="headerlink" href="#_24" title="Permanent link">¶</a></h5>
<p>使用OSPF的每一个路由器都有一个<strong>链路状态数据库</strong>（Link State Database，LSDB），用于<strong>存储链路状态通告LSA</strong>。</p>
<p><strong>通过各路由器洪泛发送封装有各自链路状态通告LSA的链路状态更新分组LSU，各路由器的链路状态数据库LSDB最终将达到一致。</strong></p>
<hr>
<h5 id="_25">基于链路状态数据库进行最短路径优先计算<a class="headerlink" href="#_25" title="Permanent link">¶</a></h5>
<p>使用OSPF的各路由器，<strong>基于链路状态数据库LSDB进行最短路径优先计算</strong>，构建出各自到达其他各路由器的最短路径，即<strong>构建各自的路由表</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-76.png" data-desc-position="bottom"><img alt="img" src="../assets/4-76.png"></a></p>
<hr>
<h4 id="ospf_2">OSPF的五种分组类型<a class="headerlink" href="#ospf_2" title="Permanent link">¶</a></h4>
<ol>
<li><strong>问候（Hello）</strong> : 用来发现和维护邻居路由器的可达性。</li>
<li><strong>数据库描述（Database Description，DBD）</strong> : 用来向邻居路由器给出自己的链路状态数据库中的所有链路状态项目的摘要信息。</li>
<li><strong>链路状态请求（Link State Request，LSR）</strong> : 用来向邻居路由器请求发送某些链路状态项目的详细信息。</li>
<li><strong>链路状态更新（Link State Update，LSU）</strong> : 路由器使用链路状态更新分组将其链路状态信息进行洪泛发送，即用洪泛法对整个系统更新链路状态。</li>
<li><strong>链路状态确认（Link State Acknowledgment，LSAck）</strong> : 对链路状态更新分组的确认分组。</li>
</ol>
<hr>
<h4 id="ospf_3">OSPF的基本工作过程<a class="headerlink" href="#ospf_3" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-77.png" data-desc-position="bottom"><img alt="img" src="../assets/4-77.png"></a></p>
<hr>
<h4 id="ospf_4">多点接入网络中的OSPF路由器<a class="headerlink" href="#ospf_4" title="Permanent link">¶</a></h4>
<p>在多点接入网络中OSPF路由器邻居关系的建立</p>
<p>为了<strong>减少洪泛发送问候分组和链路状态更新分组的数量</strong>，OSPF采用以下措施：</p>
<ul>
<li>选举<strong>指定路由器</strong>（Designated Router，DR）和<strong>备用的指定路由器</strong>（Backup Designated Router，BDR）</li>
<li><strong>所有的非DR/BDR只与DR/BDR建立邻居关系</strong></li>
<li><strong>非DR/BDR之间通过DR/BDR交换信息</strong></li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-78.png" data-desc-position="bottom"><img alt="img" src="../assets/4-78.png"></a></p>
<hr>
<h4 id="ospf_5">OSPF划分区域<a class="headerlink" href="#ospf_5" title="Permanent link">¶</a></h4>
<p>为了使OSPF协议能够用于<strong>规模很大的网络</strong>，OSPF<strong>把一个自治系统AS再划分为若干个更小的范围</strong>，称为<strong>区域</strong>（area）。</p>
<p>划分区域的好处就是把利用洪泛法交换链路状态信息的范围局限于每一个区域，而不是整个自治系统AS，这样就减少了整个网络上的通信量。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-79.png" data-desc-position="bottom"><img alt="img" src="../assets/4-79.png"></a></p>
<ul>
<li>自治系统边界路由器（AS Border Router，ASBR）：R6</li>
<li>主干路由器（Backbone Router，BBR）：R3、R4、R5、R6和R7</li>
<li>区域内路由器（Internal Router，IR）：区域1内的R1和R2，区域2内的R8，区域3内的R9</li>
<li>区域边界路由器（Area Border Router，ABR）：R3、R4和R7</li>
</ul>
<p>采用划分区域的方法，虽然使交换信息的种类增多了，同时也使OSPF协议更加复杂了，但这样做能使每一个区域内部交换路由信息的通信量大大减小，因而使OSPF协议能够用于规模更大的自治系统AS。</p>
<details class="example">
<summary>PPT 上的练习</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-80.png" data-desc-position="bottom"><img alt="img" src="../assets/4-80.png"></a></p>
</details>
<hr>
<h3 id="_26">边界网关协议<a class="headerlink" href="#_26" title="Permanent link">¶</a></h3>
<h4 id="bgp">边界网关协议BGP的相关基本概念<a class="headerlink" href="#bgp" title="Permanent link">¶</a></h4>
<p>边界网关协议（Border Gateway Protocol，<strong>BGP</strong>）属于外部网关协议EGP这个类别，用于<strong>自治系统AS之间的路由选择协议</strong>。</p>
<p>由于在不同AS内度量路由的“代价”（距离、带宽、费用等）可能不同，因此<strong>对于AS之间的路由选择</strong>，<strong>使用统一的“代价”作为度量来寻找最佳路由是不行的</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-81.png" data-desc-position="bottom"><img alt="img" src="../assets/4-81.png"></a></p>
<p>AS之间的路由选择还必须考虑<strong>相关策略</strong>（政治、经济、安全等）。</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>自治系统之间的路由选择协议应当允许使用多种路由选择策略。这些策略包括政治、经济、安全等，它们都是由网络管理人员对每一个路由器进行设置的。但这些策略并不是自治系统之间的路由选择协议本身。</p>
<p>BGP只能是力求寻找一条能够到达目的网络且比较好的路由（即不能兜圈子），而并非要寻找一条最佳路由。</p>
</div>
<p>在配置BGP时，每个AS的管理员要选择至少一个路由器作为该AS的“<strong>BGP发言人</strong>”。</p>
<p>一般来说，两个BGP发言人都是通过一个共享网络连接在一起的，而BGP发言人往往就是<strong>BGP边界路由器</strong>。</p>
<p>使用TCP连接交换路由信息的两个BGP发言人，彼此称为对方的<strong>邻站</strong>（neighbor）或<strong>对等站</strong>（peer）。</p>
<p>BGP发言人除了运行BGP协议外，还必须运行自己所在AS所使用的内部网关协议IGP，例如RIP或OSPF。</p>
<p>BGP发言人交换网络可达性的信息，也就是要<strong>到达某个网络所要经过的一系列自治系统</strong>。</p>
<p>当BGP发言人相互交换了网络可达性的信息后，各BGP发言人就<strong>根据</strong>所采用的<strong>策略</strong>，从收到的路由信息中<strong>找出到达各自治系统的较好的路由</strong>，也就是构造出树形结构且<strong>不存在环路的自治系统连通图</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-82.png" data-desc-position="bottom"><img alt="img" src="../assets/4-82.png"></a></p>
<p>BGP适用于多级结构的因特网。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-83.png" data-desc-position="bottom"><img alt="img" src="../assets/4-83.png"></a></p>
<hr>
<h4 id="bgp-4">BGP-4的四种报文<a class="headerlink" href="#bgp-4" title="Permanent link">¶</a></h4>
<p>BGP-4是目前使用得最多的版本，在[RFC 4271]中规定了BGP-4的四种报文：</p>
<ul>
<li><strong>打开（Open）</strong> : 用来与相邻的另一个BGP发言人建立关系，使通信初始化。</li>
<li><strong>更新（Update）</strong> : 用来通告某一条路由的信息，以及列出要撤销的多条路由。</li>
<li><strong>保活（Keepalive）</strong> : 用来周期性地证实邻站的连通性。</li>
<li><strong>通知（Notification）</strong> : 用来发送检测到的差错。</li>
</ul>
<details class="example">
<summary>PPT 上的练习</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-84.png" data-desc-position="bottom"><img alt="img" src="../assets/4-84.png"></a></p>
<p>从实现功能（路由选择）的角度看，这三个路由选择协议都属于网络层。</p>
<p>从数据包按网络体系结构逐层封装的角度看，RIP和BGP属于应用层，OSPF属于网络层。</p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>BGP交换的网络可达性信息是()。</p>
<p>A.到达某个网络所经过的路径</p>
<p>B.到达某个网络的下一跳路由器</p>
<p>C.到达某个网络的链路状态摘要信息</p>
<p>D.到达某个网络的最短距离及下一跳路由器</p>
</details>
<details class="note">
<summary>answer</summary>
<p>A</p>
<p>因为 BGP 仅力求寻找一条能够到达目的网络且较好的路由(不能兜圈子)，而并非寻找一条最佳路由，所以选项D错误。BGP 交换的路由信息是到达某个目的网络所要经过的各个自治系统序列而不仅仅是下一跳，因此选项A正确。</p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>从数据封装的角度看，下列()协议属于TCP/IP模型的应用层。</p>
<p>I.OSPF    II.RIP    Ⅲ.BGP    IV.ICMP</p>
<p>A.I、Ⅱ    B.Ⅱ、Ⅲ    C.I、IV    D.I、Ⅱ、Ⅲ、IV</p>
</details>
<details class="note">
<summary>answer</summary>
<p>B</p>
<p>RIP 和 BGP 属于应用层，OSPF 和 ICMP 属于网络层。</p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-128.png" data-desc-position="bottom"><img alt="img" src="../assets/4-128.png"></a></p>
</details>
<details class="note">
<summary>answer</summary>
<p>B</p>
<p>初始收敛时，R3 到网络(201.1.2.0/25)的距离为 1，R2 到网络的距离为2，R1 到网络的距离为 2。当 R3 检测到网络不可达时，因为 R3 存有其他邻居到网络的路由信息，所以它利用所有自己的距离向量，用 Bellman-Ford 公式更新自己的距离向量(易错点:误以为 R3 检测到网络不可达时，就把其到网络的距离设置为16)，R3 重新计算到网络的距离= min{16, R1 到网络的距离 +1，R2 到网络的距离 +1}=3。然后，R3 向其所有邻居发送更新报文,“告诉它到网络的距离为3”。R2(及 R1)收到 R3 发来的更新报文后，会利用它保存的所有邻居的距离向量,重新计算自己到网络的距离 =min{R1到网络的距离 + 1 ,R3 到网络的距离 +1 }={2 + 1.3 + 1} = 3，因此答案为3。与此同时，R1 也重新计算自己到网络的距离 =min{R2 到网络的距离 +1.R3 到网络的距离 +1}={ 2+1 , 3+1}=3。如此反复，直至重新收敛。因为 RIP 的特点“坏消息传得慢”，所以一旦网络出现故障，就要经过较长时间才能将故障消息传送到所有路由器。</p>
</details>
<hr>
<h3 id="_27">路由器的基本工作原理<a class="headerlink" href="#_27" title="Permanent link">¶</a></h3>
<p><strong>路由器</strong>是一种具有多个输入端口和输出端口的<strong>专用计算机</strong>，其任务是<strong>转发分组</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-85.png" data-desc-position="bottom"><img alt="img" src="../assets/4-85.png"></a></p>
<p>它的体系结构主要由四个部分组成：</p>
<ul>
<li><strong>输入端口（Input Ports）：</strong> 负责接收信号，进行物理层和链路层处理，并进行查找。</li>
<li><strong>输出端口（Output Ports）：</strong> 负责将分组存储并在链路层和物理层处理后发送出去。</li>
<li><strong>交换结构（Switching Fabric）：</strong> 连接输入与输出的核心组件，负责将分组从输入端口快速交换到合适的输出端口。</li>
<li><strong>路由选择处理机（Routing Processor）：</strong> 路由器的“大脑”，执行路由选择协议。</li>
</ul>
<p><strong>控制层面：路由表的生成 (Control Plane)</strong></p>
<p>在数据分组到达之前，路由器首先需要知道网络拓扑结构。这主要由<strong>路由选择处理机</strong>完成：</p>
<ol>
<li><strong>运行路由协议：</strong> 路由选择处理机运行各种路由选择协议（如OSPF, BGP等），与其他路由器交换<strong>路由报文</strong>（Routing Packets）。</li>
<li><strong>生成路由表：</strong> 路由表（Routing Table）包含从目的网络到下一跳（Next Hop）的映射。它需要根据网络拓扑的变化进行计算并保持最优。</li>
<li><strong>生成转发表：</strong> 路由表通常针对软件查找优化，而<strong>转发表</strong>（Forwarding Table）是从路由表得出的，其<strong>结构专门针对硬件查找速度进行了优化</strong>。转发表会被下发到<strong>交换结构</strong>或输入端口中，用于实际的数据转发。</li>
</ol>
<p><strong>数据层面：分组转发流程 (Data Plane)</strong></p>
<p>当一个普通的数据信号到达路由器时，会经历以下详细的“流水线”处理：</p>
<p><strong>第一阶段：输入端口处理 (Input Processing)</strong>:</p>
<p>这是数据进入路由器的第一站，包含物理层、链路层和网络层的处理：</p>
<ol>
<li><strong>物理层接收：</strong> 比特流（Bit stream）或信号作为脉冲波形进入物理层。</li>
<li><strong>链路层处理：</strong> 数据被还原为<strong>帧</strong>（Frame），进行解封装（去掉帧头/帧尾）。</li>
<li><strong>网络层处理与分类：</strong></li>
</ol>
<ul>
<li>如果是<strong>路由报文</strong>，它会被送往上层的路由选择处理机，用于更新路由表。</li>
</ul>
<details class="note">
<summary>路由报文接下来的处理</summary>
<p>解包与分析：处理器会解析报文内容。这些报文通常包含网络拓扑的变化信息（例如：“某条链路断开了”或“发现了一条通往网络X的新路径”）。</p>
<p>运行路由算法： 处理器运行具体的路由选择协议（如 OSPF, RIP, BGP 等）。根据报文中的新信息，结合已知的网络拓扑，重新运行路径算法（例如 Dijkstra 最短路径算法）。</p>
<p>更新路由表 (RIB Update)： 计算完成后，处理器会更新主路由表（Routing Information Base, RIB）。</p>
<p>生成转发表： 路由表（Routing Table）通常包含全面的网络信息，结构复杂，不适合硬件快速查找。处理器会从更新后的路由表中提取关键信息，生成结构更简单、经过优化的转发表（Forwarding Information Base, FIB）。</p>
<p>下发（Download）： 处理器将新的转发表复制/下发到每个输入端口的交换接口卡上。</p>
<p>虽然原来的路由报文已经被“消费”了，但流程往往还会继续影响外部网络：</p>
<ul>
<li>
<p>生成新的路由报文： 如果路由计算发现最佳路径发生了改变，或者网络拓扑确实变了，路由选择处理机会生成新的路由报文。</p>
</li>
<li>
<p>发送给邻居： 这些新报文会通过输出端口发送给相邻的路由器，告知它们网络结构的变化，从而触发整个网络的路由收敛。</p>
</li>
</ul>
</details>
<ul>
<li>如果是<strong>数据分组</strong>，则进入缓冲区等待转发。</li>
</ul>
<ol start="4">
<li><strong>查找与决策：</strong> 输入端口根据分组首部中的目的地址，查询<strong>转发表</strong>，决定该分组应当被发送到哪个输出端口。</li>
</ol>
<p><strong>第二阶段：通过交换结构 (Switching)</strong>:</p>
<p>这是路由器的核心性能<strong>瓶颈</strong>所在：</p>
<ul>
<li>分组通过<strong>交换结构</strong>从输入端口传输到指定的输出端口。</li>
<li><strong>三种交换方式：</strong> 为了提高速度，交换结构通常采用以下三种方式之一：</li>
</ul>
<ol>
<li><strong>通过存储器</strong> (Memory)</li>
<li><strong>通过总线</strong> (Bus)</li>
<li><strong>通过互连网络</strong> (Interconnection Network) - <em>这是高性能路由器常用的方式。</em></li>
</ol>
<ul>
<li>在此过程中，分组可能会在输入缓冲区排队（如果交换结构繁忙），或者在输出缓冲区排队（如果发送速率低于交换速率）。</li>
</ul>
<p><strong>第三阶段：输出端口处理 (Output Processing)</strong>:</p>
<p>当分组到达输出端口后，进行反向操作：</p>
<ol>
<li><strong>排队与缓存：</strong> 分组进入输出缓冲区。</li>
<li><strong>网络层操作：</strong> 此时会执行关键的数据修改操作，包括<strong>修改TTL（生存时间）值</strong>（通常减1）以及<strong>重新计算首部检验和</strong>。</li>
<li><strong>链路层封装：</strong> 将网络层分组重新封装成<strong>帧</strong>。</li>
<li><strong>物理层发送：</strong> 将帧转换为比特流/信号，传输到物理链路上，发往下一跳路由器或目标主机。</li>
</ol>
<details class="example" open="open">
<summary>question</summary>
<p>下列关于路由器和路由表的说法中，正确的是()。</p>
<p>A.路由器处理的信息量比交换机少，因而转发速度比交换机快</p>
<p>B.对于同一目标，路由器只提供延迟最小的最佳路由</p>
<p>C.当路由表中的所有表项都不匹配时，按照默认路由进行转发</p>
<p>D.路由器不但能够根据IP地址进行转发，而且可以根据物理地址进行转发</p>
</details>
<details class="note">
<summary>answer</summary>
<p>C</p>
<p>路由器是第三层设备，要处理的内容比第二层设备交换机更多，因而转发速度比交换机慢，选项 A 错误。虽然一些路由协议也将延迟等作为参数进行路由选择，但路由协议使用得最多的参数是传输距离，此外还有一些其他参数，选项B错误。默认路由的匹配优先级最低，只要目的网络不在转发表中，就一律选择默认路由转发，选项C正确。路由器只能根据IP地址进行转发，D错误。</p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>决定路由器的转发表中的内容的算法是()。</p>
<p>A.指数回退算法    B.分组调度算法    C.路由算法    D.拥塞控制算法</p>
</details>
<details class="note">
<summary>answer</summary>
<p>C</p>
<p>转发表是根据路由表生成的，路由表又是由路由算法得到的，因此路由算法决定了转发表中的内容。</p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>路由器中计算路由信息的是()。</p>
<p>A.输入队列    B.输出队列    C.交换结构    D.路由选择处理机</p>
</details>
<details class="note">
<summary>answer</summary>
<p>D</p>
<p>路由选择处理机的任务是根据所选定的路由选择协议构造路由表，同时经常或定期地与相邻路由器交换路由信息而不断地更新和维护路由表。</p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>路由表的分组转发部分由()组成。</p>
<p>A.交换结构    B.输入端口    C.输出端口    D.以上都是</p>
</details>
<details class="note">
<summary>answer</summary>
<p>D</p>
<p>分组转发部分包括3部分:交换结构，根据转发表对分组进行处理，将某个输入端口进入的分组从一个合适的输出端口转发出去。②输入端口，包括物理层、数据链路层和网络层的处理模块。③输出端口，负责从交换结构接收分组，再将其发送到路由器外面的线路上。</p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>路由器转发分组(在路由表中已找到匹配的条目)时，会根据路由表中的()字段来确定输出端口。</p>
<p>A.目的网络地址    B.下一跳地址    C.距离度量值    D.接口标识符</p>
</details>
<details class="note">
<summary>answer</summary>
<p>D</p>
<p>输出端口就是路由器的接口，每个接口都有一个标识符，如 G0/0 等。路由表中的每个条目都会指定一个接口标识符，路由器转发分组时，根据路由表中的接口标识符来确定输出端口。</p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>如下图所示，用7个相同的路由器与8台主机相连。链路带宽分为三种，最上层的最快，最下层的最慢，都是全双工方式，图中标注了各层链路带宽的数值。所有路由器的处理速度都很快，远超链路带宽。下列关于网络拥塞分析的说法中，正确的是()。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-129.png" data-desc-position="bottom"><img alt="img" src="../assets/4-129.png"></a></p>
<p>A.R1-R2链路和R2-R4链路都不可能发生拥塞</p>
<p>B.R1-R2链路可能发生拥塞，R2-R4链路不可能发生拥塞</p>
<p>C.R1-R2链路不可能发生拥塞，R2-R4链路可能发生拥塞</p>
<p>D.R1-R2链路和R2-R4链路都可能发生拥塞</p>
</details>
<details class="note">
<summary>answer</summary>
<p>C</p>
<p>R1-R2 链路上的数据率在任何时候都不可能超过 4Mb/s，因此不可能发生拥塞。对于 R2-R4链路，考虑这种情况:H5 和 H6 同时以 1Mbs 的速率向 H1 发送数据，H7 和 H8 同时以 1Mb/s的速率向 H2 发送数据。此时，R1右边的所有链路都正常工作，R1-R2链路也正常工作，都没有超过这些链路的带宽。但是，若这些数据全部都通过 R2 转发，再通过带宽为 2Mbs 的 R2-R4 链路分别发送给主机 H1和 H2，则显然是不可能的，于是在 R2 的输入缓存中，进来的数据比出去的要多，数据堆积得越来越多，发送不出去，产生拥。选项C正确。</p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>下列网络设备中，能够抑制广播风暴的是()。</p>
<p>I. 中继器    Ⅱ. 集线器    Ⅲ. 网桥    IV. 路由器</p>
<p>A.仅I和Ⅱ    B.仅Ⅲ    C.仅Ⅲ和IV    D.仅IV</p>
</details>
<details class="note">
<summary>answer</summary>
<p>D</p>
<p>中继器和集线器工作在物理层，既不隔离冲突域也不隔离广播域。为了解决冲突域的问题，人们利用网桥和交换机来分隔各个网段中的通信量，建立多个分离的冲突域，但当网桥和交换机接收到一个未知转发信息的数据帧时，为了保证该帧能被目的节点正确接收，将该帧从所有的端口广播出去，可以看出网桥和交换机的冲突域等于端口个数，广播域为 1。路由器可以隔离广播域和冲突域，要屏蔽数据链路层的广播帧，当然应该是网络层设备路由器。在此题的选项中，路由器是其中最高层的网络设备，其他设备能隔离的，路由器一定能隔离。</p>
</details>
<hr>
<h2 id="_28">网际控制报文协议<a class="headerlink" href="#_28" title="Permanent link">¶</a></h2>
<h3 id="_29">网际控制报文协议概述<a class="headerlink" href="#_29" title="Permanent link">¶</a></h3>
<p>为了更<strong>有效地转发IP数据报</strong>以及提高IP数据报交付成功的机会，TCP/IP体系结构的<strong>网际层</strong>使用了<strong>网际控制报文协议</strong>（Internet Control Message Protocol，ICMP）[RFC 792]。</p>
<p><strong>主机</strong>或<strong>路由器</strong>使用ICMP来发送<strong>差错报告报文</strong>和<strong>询问报文</strong>。</p>
<p><strong>ICMP报文被封装在IP数据报中发送</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-86.png" data-desc-position="bottom"><img alt="img" src="../assets/4-86.png"></a></p>
<hr>
<h3 id="icmp">ICMP报文类型<a class="headerlink" href="#icmp" title="Permanent link">¶</a></h3>
<p>ICMP报文分为以下两大类：</p>
<ol>
<li><strong>差错报告报文</strong>: 用来向主机或路由器报告差错情况。</li>
<li><strong>询问报文</strong>: 用来向主机或路由器询问情况。</li>
</ol>
<hr>
<h4 id="_30">差错报告报文<a class="headerlink" href="#_30" title="Permanent link">¶</a></h4>
<p>常见的ICMP差错报告报文有以下五种：</p>
<ol>
<li><strong>目的不可达（Destination Unreachable）</strong></li>
</ol>
<p><strong>当路由器或主机不能交付IP数据报时，就向源点发送重点不可达报文</strong>。具体可再根据ICMP的代码字段细分为目的网络不可达、目的主机不可达、目的协议不可达、目的端口不可达、目的网络未知、目的主机未知等13种。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-87.png" data-desc-position="bottom"><img alt="img" src="../assets/4-87.png"></a></p>
<ol start="2">
<li><strong>时间超过（Time Exceeded）</strong></li>
</ol>
<p>当路由器收到一个目的IP地址不是自己的IP数据报时，会将其<strong>首部中生存时间TTL字段的值减1</strong>。若结果不为0，则路由器将该数据报转发出去；<strong>若结果为0，路由器不但要丢弃该数据报，还要向发送该IP数据报的源点发送时间超过（超时）报文</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-89.png" data-desc-position="bottom"><img alt="img" src="../assets/4-89.png"></a></p>
<p>另外，<strong>当终点在预先规定的时间内未能收到一个数据报的全部数据报分片时，就把已收到的数据报片都丢弃，也会向源点发送时间超过（超时）报文</strong>。</p>
<ol start="3">
<li><strong>参数问题（Parameter Problem）</strong></li>
</ol>
<p>当路由器或目的主机收到IP数据报后，根据其首部中的检验和字段的值发现<strong>首部</strong>在传送过程中出现了<strong>误码</strong>，就<strong>丢弃该数据报</strong>，并<strong>向发送该数据报的源点发送参数问题报文</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-90.png" data-desc-position="bottom"><img alt="img" src="../assets/4-90.png"></a></p>
<ol start="4">
<li><strong>源点抑制（Source Quench）</strong></li>
</ol>
<p><strong>当路由器或主机由于拥塞而丢弃IP数据报时，就向发送该IP数据报的源点发送源点抑制报文</strong>，使源点知道应当把IP数据报的发送速率放慢。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-88.png" data-desc-position="bottom"><img alt="img" src="../assets/4-88.png"></a></p>
<ol start="5">
<li><strong>重定向（Redirect）</strong></li>
</ol>
<p>路由器把改变路由报文发送给主机，<strong>让主机知道下次应将IP数据报发送给另外的路由器</strong>，这样可以<strong>通过更好的路由到达目的主机</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-91.png" data-desc-position="bottom"><img alt="img" src="../assets/4-91.png"></a></p>
<p>以下情况<strong>不应发送ICMP差错报告报文</strong>：</p>
<ul>
<li>对ICMP差错报告报文不再发送ICMP差错报告报文。</li>
<li>对第一个分片的IP数据报片的所有后续数据报片都不发送ICMP差错报告报文。</li>
<li>对具有多播地址的IP数据报都不发送ICMP差错报告报文。</li>
<li>对具有特殊地址（例如127.0.0.0或0.0.0.0）的IP数据报不发送ICMP差错报告报文。</li>
</ul>
<hr>
<h4 id="_31">询问报文<a class="headerlink" href="#_31" title="Permanent link">¶</a></h4>
<p>常用的ICMP询问报文有以下两种：</p>
<ol>
<li><strong>回送请求和回答</strong>: 由主机或路由器向一个特定的目的主机或路由器发出。收到此报文的主机或路由器必须给发送该报文的源主机或路由器发送ICMP回送回答报文。这种询问报文用来测试<strong>目的站是否可达以及了解其有关状态</strong>。</li>
<li><strong>时间戳请求和回答</strong>: 用来请求某个主机或路由器回答当前的日期和时间。在ICMP时间戳回答报文中有一个32比特的字段，其中写入的整数代表从1900年1月1日起到当前时刻一共有多少秒。这种询问报文用来进行<strong>时钟同步和测量时间</strong>。</li>
</ol>
<hr>
<h3 id="icmp_1">ICMP的典型应用<a class="headerlink" href="#icmp_1" title="Permanent link">¶</a></h3>
<h4 id="ping">分组网间探测PING<a class="headerlink" href="#ping" title="Permanent link">¶</a></h4>
<p>分组网间探测PING用来<strong>测试主机或路由器之间的连通性</strong>。</p>
<ul>
<li>PING是TCP/IP体系结构的<strong>应用层直接使用网际层ICMP</strong>的一个例子，它并不使用运输层的TCP或UDP。</li>
<li>PING应用所<strong>使用的ICMP报文类型为回送请求和回答</strong>。</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>某些主机或服务器为了防止恶意攻击，并会不理睬外界发来的ICMP回送请求报文。</p>
</div>
<hr>
<h4 id="_32">跟踪路由<a class="headerlink" href="#_32" title="Permanent link">¶</a></h4>
<p>跟踪路由应用traceroute，用于<strong>探测IP数据报从源主机到达目的主机要经过哪些路由器</strong>。</p>
<p>在不同操作系统中，traceroute应用的命令和实现机制有所不同：</p>
<ul>
<li>在<strong>UNIX</strong>版本中，具体命令为“<strong>traceroute</strong>”，其在运输层使用<strong>UDP协议</strong>，在网络层使用<strong>ICMP报文类型只有差错报告报文</strong>。</li>
<li>在<strong>Windows</strong>版本中，具体命令为“<strong>tracert</strong>”，其<strong>应用层直接使用网际层的ICMP协议</strong>，所使用的<strong>ICMP报文类型有回送请求和回答报文以及差错报告报文</strong>。</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: center;">步骤</th>
<th style="text-align: center;">发送的 TTL 值</th>
<th style="text-align: left;">谁会丢弃包?</th>
<th style="text-align: center;">返回的报文类型</th>
<th style="text-align: center;">获知的信息</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>Round 1</strong></td>
<td style="text-align: center;"><span class="arithmatex">\(TTL=1\)</span></td>
<td style="text-align: left;">第 1 个路由器 (R1)</td>
<td style="text-align: center;">ICMP 差错报告 (超时)</td>
<td style="text-align: center;">第 1 跳路由器的 IP</td>
</tr>
<tr>
<td style="text-align: center;"><strong>Round 2</strong></td>
<td style="text-align: center;"><span class="arithmatex">\(TTL=2\)</span></td>
<td style="text-align: left;">第 2 个路由器 (R2)</td>
<td style="text-align: center;">ICMP 差错报告 (超时)</td>
<td style="text-align: center;">第 2 跳路由器的 IP</td>
</tr>
<tr>
<td style="text-align: center;">...</td>
<td style="text-align: center;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">...</td>
</tr>
<tr>
<td style="text-align: center;"><strong>Round N</strong></td>
<td style="text-align: center;"><span class="arithmatex">\(TTL=N\)</span></td>
<td style="text-align: left;">目的主机 (H2)</td>
<td style="text-align: center;"><strong>ICMP 回送回答 (Echo Reply)</strong></td>
<td style="text-align: center;">到达目的地，探测结束</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="_33">虚拟专用网和网络地址转换<a class="headerlink" href="#_33" title="Permanent link">¶</a></h2>
<h3 id="_34">虚拟专用网<a class="headerlink" href="#_34" title="Permanent link">¶</a></h3>
<p>虚拟专用网（Virtual Private Network，VPN）：<strong>利用公用的因特网</strong>作为本机构各专用网之间的通信载体，这样形成的网络又称为虚拟专用网。</p>
<p>出于安全考虑，<strong>专用网内的各主机并不应该直接“暴露”于公用的因特网上</strong>。因此，给专用网内各主机配置的IP地址应使各主机在专用网内可以相互通信，而不能直接与公用的因特网通信。</p>
<ul>
<li><strong>“虚拟” (Virtual)：</strong> 表示它并不是真正铺设了物理上的专用线缆，而是通过软件技术在公网中构建了一条逻辑上的“隧道”。</li>
<li><strong>“专用” (Private)：</strong> 表示通信是加密的、隔离的，效果上如同在专用网络中传输一样。</li>
</ul>
<p>在理解VPN原理前，必须先理解IP地址的限制：</p>
<p>给专用网内各主机配置的IP地址应该是该<strong>专用网所在机构可以自行分配的IP地址</strong>，这类IP地址仅在机构内部有效，称为<strong>专用地址</strong>（Private Address），不需要向因特网的管理机构申请。</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>[RFC 1918]规定了以下三个CIDR地址块中的地址作为专用地址：</p>
<ul>
<li>
<p><code>10.0.0.0 ~ 10.255.255.255</code> (CIDR 10/8)</p>
</li>
<li>
<p><code>172.16.0.0 ~ 172.31.255.255</code> (CIDR 172.16/12)</p>
</li>
<li>
<p><code>192.168.0.0 ~ 192.168.255.255</code> (CIDR 192.168/16)</p>
</li>
</ul>
</div>
<p><strong>传输限制：</strong> 在因特网中的所有路由器，对目的地址是专用地址的IP数据报一律不进行转发，这需要由因特网服务提供者ISP对其拥有的因特网路由器进行设置来实现。</p>
<p>IP隧道技术是VPN最关键的部分，以一个位于北京的部门A主机（H1）如何安全地向位于上海的部门B主机（H2）发送数据为例。</p>
<ul>
<li><strong>发送方 H1 (北京):</strong> 私有IP <code>10.1.0.3</code></li>
<li><strong>接收方 H2 (上海):</strong> 私有IP <code>10.2.0.3</code></li>
<li><strong>北京网关 R1:</strong> 公网IP <code>106.38.0.1</code></li>
<li><strong>上海网关 R2:</strong> 公网IP <code>101.80.0.1</code></li>
</ul>
<p><strong>1. 发起通信 (内部数据报)</strong></p>
<ul>
<li>H1 生成一个<strong>内部IP数据报</strong>。</li>
<li><strong>源地址：</strong> <code>10.1.0.3</code> (H1)</li>
<li><strong>目的地址：</strong> <code>10.2.0.3</code> (H2)</li>
<li>数据报发送到北京的网关路由器 R1。</li>
</ul>
<p><strong>2. 封装与加密 (IP隧道起点)</strong></p>
<ul>
<li>R1 收到数据报后，发现目的地址是专用地址，根据VPN配置，它进行<strong>封装</strong>。</li>
<li><strong>加密：</strong> 将整个内部IP数据报（载荷+首部）进行加密。</li>
<li><strong>添加外部首部：</strong> R1 给加密后的数据包加上一个新的<strong>外部IP首部</strong>。</li>
</ul>
<p>a. <strong>新源地址：</strong> <code>106.38.0.1</code> (R1的公网IP)
b. <strong>新目的地址：</strong> <code>101.80.0.1</code> (R2的公网IP)</p>
<p><strong>3. 公网传输 (隧道中)</strong></p>
<ul>
<li>这个“封装后”的数据报进入因特网。</li>
<li>因特网的路由器只看<strong>外部首部</strong>。因为 <code>101.80.0.1</code> 是合法的公网地址，所以路由器会正常转发该数据报，直到它到达上海的路由器 R2。</li>
<li><em>注意：</em> 对于因特网上的其他路人来说，他们只能看到这是 R1 发给 R2 的包，无法看到内部真正的原始数据（因为被加密了）。</li>
</ul>
<p><strong>4. 解封与转发 (IP隧道终点)</strong></p>
<ul>
<li>R2 收到数据报，剥去外部首部。</li>
<li><strong>解密：</strong> R2 对数据部分进行解密，还原出原始的<strong>内部IP数据报</strong>（源 <code>10.1.0.3</code> -&gt; 目 <code>10.2.0.3</code>）。</li>
<li>R2 根据内部数据报的目的地址，将其转发给局域网内的 H2。</li>
</ul>
<p><strong>VPN 的三种类型</strong></p>
<ol>
<li><strong>内联网 VPN (Intranet VPN):</strong>连接同一机构内不同部门的局域网（例如本例中的北京部门和上海部门）。</li>
<li><strong>外联网 VPN (Extranet VPN):</strong>扩展到外部机构，允许合作伙伴或供应商安全接入特定的内部网络资源。</li>
<li><strong>远程接入 VPN (Remote Access VPN):</strong>用于在外地工作的员工。员工在PC上运行VPN软件，通过因特网与公司主机建立隧道，访问公司内网。</li>
</ol>
<hr>
<h3 id="_35">网络地址转换<a class="headerlink" href="#_35" title="Permanent link">¶</a></h3>
<p>尽管因特网采用了无分类编址方法来减缓IPv4地址空间耗尽的速度，但由于<strong>因特网用户数量的急剧增长</strong>，特别是<strong>大量小型办公室</strong>和<strong>家庭网络</strong>接入因特网的需求不断增加，<strong>IPv4地址空间即将耗尽的危险然仍没有解除</strong>（实际上，因特网号码分配管理局IANN于2011年2月3日宣布，IPv4地址已经分配完毕）。</p>
<p><strong>网络地址转换</strong>（Network Address Translation，<strong>NAT</strong>）技术于1994年被提出，用来缓解IPv4地址空间即将耗尽的问题。</p>
<ul>
<li>NAT能<strong>使大量使用内部专用地址的专用网络用户共享少量外部全球地址来访问因特网上的主机和资源</strong>。</li>
<li>这种方法需要在专用网络连接到因特网的路由器上<strong>安装NAT软件</strong>。装有NAT软件的路由器称为<strong>NAT路由器</strong>，它<strong>至少要有一个有效的外部全球地址</strong> <span class="arithmatex">\(IP_G\)</span> 。这样，所有使用内部专用地址的主机在和外部因特网通信时，都要在<strong>NAT路由器上将其内部专用地址转换成<span class="arithmatex">\(IP_G\)</span></strong>。</li>
</ul>
<hr>
<h4 id="nat">最基本的NAT方法<a class="headerlink" href="#nat" title="Permanent link">¶</a></h4>
<ul>
<li><strong>主机 A (Host A)：</strong> 位于专用网（局域网）内，使用<strong>专用地址</strong> <span class="arithmatex">\(IP_A\)</span>。</li>
<li><strong>主机 B (Host B)：</strong> 位于因特网上，使用<strong>全球地址</strong> <span class="arithmatex">\(IP_B\)</span>。</li>
<li><strong>NAT 路由器：</strong> 连接专用网和因特网的网关。它至少拥有一个有效的<strong>外部全球地址</strong> <span class="arithmatex">\(IP_G\)</span>。</li>
<li><strong>NAT 转换表：</strong> 路由器内部维护着一张表，记录了内网 IP 和外网 IP 的映射关系（例如：<span class="arithmatex">\(IP_A \leftrightarrow IP_G\)</span>）。</li>
</ul>
<p>当主机 A 想要访问主机 B 时，数据包的处理流程如下：</p>
<p><strong>第一步：主机 A 发送数据</strong></p>
<ul>
<li>主机 A 生成一个 IP 数据报。</li>
<li><strong>源地址：</strong> <span class="arithmatex">\(IP_A\)</span> （内网私有地址）</li>
<li><strong>目的地址：</strong> <span class="arithmatex">\(IP_B\)</span> （外网全球地址）</li>
<li>数据报被发送给网关（NAT 路由器）。</li>
</ul>
<p><strong>第二步：NAT 路由器进行地址转换（源地址替换）</strong></p>
<ul>
<li>NAT 路由器收到数据报后，查找其 <strong>NAT 转换表</strong>。</li>
<li>它发现 <span class="arithmatex">\(IP_A\)</span> 对应的外网地址是 <span class="arithmatex">\(IP_G\)</span>。</li>
<li><strong>关键操作：</strong> 路由器将数据报首部中的<strong>源地址</strong>从 <span class="arithmatex">\(IP_A\)</span> 修改为 <span class="arithmatex">\(IP_G\)</span>。</li>
<li><em>此时数据报变为：源 <span class="arithmatex">\(IP_G\)</span> -&gt; 目 <span class="arithmatex">\(IP_B\)</span>。</em></li>
<li>数据报被转发到因特网上。</li>
</ul>
<p>当主机 B 收到数据并进行回复时，流程是反向的：</p>
<p><strong>第三步：主机 B 发送响应</strong></p>
<ul>
<li>主机 B 收到数据包时，它看到的发送者是 <span class="arithmatex">\(IP_G\)</span>（它并不知道 <span class="arithmatex">\(IP_A\)</span> 的存在）。</li>
<li>主机 B 生成响应数据报。</li>
<li><strong>源地址：</strong> <span class="arithmatex">\(IP_B\)</span></li>
<li><strong>目的地址：</strong> <span class="arithmatex">\(IP_G\)</span> （路由器的全球地址）</li>
<li>数据报通过因特网传回到 NAT 路由器。</li>
</ul>
<p><strong>第四步：NAT 路由器进行地址转换（目的地址替换）</strong></p>
<ul>
<li>NAT 路由器收到目的地址为 <span class="arithmatex">\(IP_G\)</span> 的数据报。</li>
<li>它再次查找 <strong>NAT 转换表</strong>，找到 <span class="arithmatex">\(IP_G\)</span> 对应的内网主机是 <span class="arithmatex">\(IP_A\)</span>。</li>
<li><strong>关键操作：</strong> 路由器将数据报首部中的<strong>目的地址</strong>从 <span class="arithmatex">\(IP_G\)</span> 修改为 <span class="arithmatex">\(IP_A\)</span>。</li>
<li><em>此时数据报变为：源 <span class="arithmatex">\(IP_B\)</span> -&gt; 目 <span class="arithmatex">\(IP_A\)</span>。</em></li>
<li>数据报被转发到专用网内，最终送达主机 A。</li>
</ul>
<p>如果NAT路由器拥有n（n比较小）个全球IP地址，那么专用网内<strong>最多可以同时</strong>有n台主机接入因特网。若专用网内的主机数量大于n，则需要轮流使用NAT路由器中数量较少的全球IP地址。</p>
<hr>
<h4 id="_36">网络地址与端口号转换方法<a class="headerlink" href="#_36" title="Permanent link">¶</a></h4>
<p>由于目前绝大多数基于TCP/IP协议栈的网络应用，都使用运输层的传输控制协议TCP或用户数据报协议UDP，为了<strong>更加有效地利用NAT路由器中的全球IP地址</strong>，现在常<strong>将NAT转换和运输层端口号结合使用</strong>。</p>
<ul>
<li>这样就可以使内部专用网中使用专用地址的<strong>大量主机</strong>，<strong>共用NAT路由器上的1个全球IP地址</strong>，因而可以同时与因特网中的不同主机进行通信。</li>
</ul>
<p>将NAT和运输层端口号结合使用，称为<strong>网络地址与端口号转换</strong>（Network Address and Port Translation，NAPT）</p>
<ul>
<li>现在很多家用路由器将家中各种智能设备（手机、平板、笔记本电脑、台式电脑、物联网设备等）接入因特网，这种路由器实际上就是一个<strong>NAPT路由器</strong>，但往往并不运行路由选择协议。</li>
</ul>
<p><strong>场景说明</strong>：</p>
<ul>
<li><strong>专用网内：</strong> 有两台主机，主机 A (<code>192.168.0.6</code>) 和主机 B (<code>192.168.0.9</code>)。</li>
<li><strong>网关（NAPT 路由器）：</strong> 只有一个全球 IP 地址 <code>113.218.175.235</code>。</li>
<li><strong>目的主机：</strong> 因特网上的服务器 C (<code>218.75.230.30</code>)。</li>
<li><strong>关键的“巧合”：</strong> 特别设计了主机 A 和主机 B 正好都在使用<strong>相同的源端口号</strong> <code>30000</code> 来发起连接。这在局域网中是很常见的，因为端口号是本地有效的。特意这样举例，就是为了能更好地说明NAPT路由器还会对源端口号重新动态分配。</li>
</ul>
<p>当主机 A 和主机 B 同时向服务器 C 发送数据时，NAPT 路由器会进行如下操作：</p>
<p>主机 A 的处理流程：</p>
<ol>
<li><strong>发送：</strong> 主机 A 发出数据报 <code>{源 IP: 192.168.0.6, 源端口: 30000}</code>。</li>
<li><strong>转换：</strong> 路由器接收后，查找或创建映射。它将源 IP 替换为路由器的全球 IP，并将源端口替换为一个<strong>新的、未被使用的端口号</strong>（例如 <code>50001</code>）。</li>
<li><strong>结果：</strong> 发往因特网的数据报变为 <code>{源 IP: 113.218.175.235, 源端口: 50001}</code>。</li>
<li><strong>记录：</strong> 路由器在 NAPT 转换表中记录：<code>192.168.0.6:30000 &lt;---&gt; 113.218.175.235:50001</code>。</li>
</ol>
<p>主机 B 的处理流程：</p>
<ol>
<li><strong>发送：</strong> 主机 B 发出数据报 <code>{源 IP: 192.168.0.9, 源端口: 30000}</code>。</li>
<li><strong>转换：</strong> 路由器发现端口 <code>30000</code> 在内网重复了，但这不重要。重要的是路由器必须为它分配一个<strong>不同的全球端口号</strong>（例如 <code>50002</code>）来区分身份。</li>
<li><strong>结果：</strong> 发往因特网的数据报变为 <code>{源 IP: 113.218.175.235, 源端口: 50002}</code>。</li>
<li><strong>记录：</strong> 路由器在表里新增一条：<code>192.168.0.9:30000 &lt;---&gt; 113.218.175.235:50002</code>。</li>
</ol>
<p>当服务器 C 回复数据时，它只能看到路由器的全球 IP 和端口号。路由器通过查看<strong>目的端口号</strong>来决定转发给谁。</p>
<p>服务器回复给 A 的数据：</p>
<ol>
<li><strong>到达：</strong> 数据报到达路由器，目的地址是 <code>{IP: 113.218.175.235, 端口: 50001}</code>。</li>
<li><strong>查表：</strong> 路由器查找 NAPT 表，找到外网端口 <code>50001</code> 对应的内网地址是 <code>192.168.0.6:30000</code>。</li>
<li><strong>转发：</strong> 路由器修改目的 IP 和端口，将数据准确发回给<strong>主机 A</strong>。</li>
</ol>
<p>服务器回复给 B 的数据</p>
<ol>
<li><strong>到达：</strong> 数据报到达路由器，目的地址是 <code>{IP: 113.218.175.235, 端口: 50002}</code>。</li>
<li><strong>查表：</strong> 路由器查找 NAPT 表，找到外网端口 <code>50002</code> 对应的内网地址是 <code>192.168.0.9:30000</code>。</li>
<li><strong>转发：</strong> 路由器修改目的 IP 和端口，将数据准确发回给<strong>主机 B</strong>。</li>
</ol>
<p>尽管NAT（和NAPT）的出现在很大程度上缓解了IPv4地址资源紧张的局面，但<strong>NAT（和NAPT）对网络应用并不完全透明</strong>，会对某些网络应用产生影响。</p>
<p>NAT（和NAPT）的一个重要特点就是<strong>通信必须由专用网内部发起</strong>，<strong>因此拥有内部专用地址的主机不能直接充当因特网中的服务器</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-92.png" data-desc-position="bottom"><img alt="img" src="../assets/4-92.png"></a></p>
<p>对于目前P2P这类需要外网主机主动与内网主机进行通信的网络应用，在通过NAT时会遇到问题，需要网络应用自身使用一些<strong>特殊的NAT穿透技术</strong>来解决。</p>
<hr>
<h2 id="ip_3">IP多播<a class="headerlink" href="#ip_3" title="Permanent link">¶</a></h2>
<h3 id="ip_4">IP多播技术的相关基本概念<a class="headerlink" href="#ip_4" title="Permanent link">¶</a></h3>
<p><strong>多播</strong>（Multicast，也称为组播）是一种实现“<strong>一对多</strong>”通信的技术，与传统单播“一对一”通信相比，多播可以极大地<strong>节省网络资源</strong>。</p>
<p>在<strong>因特网</strong>上进行的多播，称为<strong>IP多播</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-93.png" data-desc-position="bottom"><img alt="img" src="../assets/4-93.png"></a></p>
<p>当多播组的成员数量很大时，采用多播方式可以显著地减少网络中各种资源的消耗。</p>
<hr>
<h3 id="ip_5">IP多播地址和多播组<a class="headerlink" href="#ip_5" title="Permanent link">¶</a></h3>
<p>在<strong>IPv4</strong>中，<strong>D类</strong>地址被作为<strong>多播地址</strong>。</p>
<p><strong>多播地址</strong>只能用作<strong>目的地址</strong>，而不能用作源地址。</p>
<p>用每一个D类地址来标识一个多播组，<strong>使用同一个IP多播地址接收IP多播数据报的所有主机就构成了一个多播组</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-94.png" data-desc-position="bottom"><img alt="img" src="../assets/4-94.png"></a></p>
<ul>
<li><strong>每个多播组的成员是可以随时变动的</strong>，一台主机可以随时加入或离开多播组。</li>
<li><strong>多播组成员的数量和所在的地理位置也不受限制，一台主机可以属于几个多播组</strong>。</li>
</ul>
<p>非多播组成员也可以向多播组发送IP多播数据报。</p>
<p>与IP数据报相同，IP多播数据报也是“<strong>尽最大努力交付</strong>”，不保证一定能够交付给多播组内的所有成员。</p>
<p>IPv4多播地址又可分为<strong>预留的多播地址</strong>（永久多播地址）、<strong>全球范围可用的多播地址</strong>以及<strong>本地管理的多播地址</strong>[RFC 3330]。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-95.png" data-desc-position="bottom"><img alt="img" src="../assets/4-95.png"></a></p>
<p>IP多播可以分为以下两种：</p>
<ul>
<li>只在<strong>本局域网</strong>上进行的<strong>硬件多播</strong>。</li>
<li>在<strong>因特网</strong>上进行的<strong>多播</strong>。</li>
</ul>
<p>目前大部分主机都是通过局域网接入因特网的。因此，在因特网上进行多播的最后阶段，还是要把IP多播数据报在局域网上用硬件多播交付给多播组的所有成员。</p>
<hr>
<h3 id="_37">在局域网上进行硬件多播<a class="headerlink" href="#_37" title="Permanent link">¶</a></h3>
<p>由于MAC地址（也称为硬件地址）有多播MAC地址这种类型，因此只要<strong>把IPv4多播地址映射成多播MAC地址</strong>，即可将IP多播数据报封装在局域网的MAC帧中，而MAC帧首部中的目的MAC地址字段的值，就设置为由IPv4多播地址映射成的多播MAC地址。这样，可以很<strong>方便地利用硬件多播来实现局域网内的IP多播</strong>。</p>
<p>当给某个多播组的成员主机配置其所属多播组的IP多播地址时，系统就会根据映射规则从该IP多播地址生成相应的局域网多播MAC地址。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-96.png" data-desc-position="bottom"><img alt="img" src="../assets/4-96.png"></a></p>
<p>因特网号码指派管理局IANA，将自己从IEEE注册管理机构申请到的以太网MAC地址块中从<strong>01-00-5E-00-00-00到01-00-5E-7F-FF-FF</strong>的多播MAC地址，用于映射IPv4多播地址。</p>
<ul>
<li>这些多播MAC地址的左起前25个比特都是相同的，剩余23个比特可以任意变化，因此共有 <span class="arithmatex">\(2^{23}\)</span> 个。</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-97.png" data-desc-position="bottom"><img alt="img" src="../assets/4-97.png"></a></p>
<p>由于IP多播地址与多播MAC地址的映射关系不是唯一的，因此<strong>收到IP多播数据报的主机还要在网际层利用软件进行过滤</strong>，把不是主机要接收的IP多播数据报丢弃。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-98.png" data-desc-position="bottom"><img alt="img" src="../assets/4-98.png"></a></p>
<hr>
<h3 id="ip_6">在因特网上进行IP多播需要的两种协议<a class="headerlink" href="#ip_6" title="Permanent link">¶</a></h3>
<p>要在因特网上进行IP多播，就必须要考虑<strong>IP多播数据报经过多个多播路由器进行转发</strong>的问题。</p>
<ul>
<li><strong>多播路由器</strong>必须<strong>根据</strong>IP多播数据报首部中的<strong>IP多播地址</strong>，将其<strong>转发</strong>到有该多播组成员的局域网。</li>
</ul>
<p>网际组管理协议（Internet Group Management Protocol，<strong>IGMP</strong>）是TCP/IP体系结构网际层中的协议，其作用是<strong>让连接在本地局域网上的多播路由器知道本局域网上是否有主机</strong>（实际上是主机中的某个进程）<strong>加入或退出了某个多播组</strong>。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-99.png" data-desc-position="bottom"><img alt="img" src="../assets/4-99.png"></a></p>
<p><strong>IGMP仅在本网络有效</strong>，使用IGMP<strong>并不能知道</strong>多播组所包含的<strong>成员数量</strong>，<strong>也不能知道</strong>多播组的<strong>成员都分布</strong>在哪些网络中。</p>
<p>仅使用IGMP并不能在因特网上进行IP多播。连接在局域网上的多播路由器还必须和因特网上的其他多播路由器协同工作，以便把IP多播数据报用最小的代价传送给所有的多播组成员，这就需要使用<strong>多播路由选择协议</strong>。</p>
<p><strong>多播路由选择协议</strong>的主要任务是：在多播路由器之间为每个多播组建立一个<strong>多播转发树</strong>。</p>
<ul>
<li>多播转发树<strong>连接多播源和所有拥有该多播组成员的路由器</strong>。</li>
<li><strong>IP多播数据报只要沿着多播转发树进行洪泛</strong>，就能被传送到所有拥有该多播组成员的多播路由器。</li>
<li>之后，在<strong>多播路由器所直连的局域网内</strong>，多播路由器通过<strong>硬件多播</strong>，将IP多播数据报发送给该多播组的所有成员。</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-100.png" data-desc-position="bottom"><img alt="img" src="../assets/4-100.png"></a></p>
<ul>
<li>针对<strong>不同的多播组需要维护不同的多播转发树</strong>，而且必须<strong>动态地适应多播组成员的变化</strong>，但此时网络拓扑并不一定发生变化，因此<strong>多播路由选择协议要比单播路由选择协议（例如RIP、OSPF等）复杂得多</strong>。</li>
<li>即使某个<strong>主机不是任何多播组的成员</strong>，它<strong>也可以向任何多播组发送多播数据报</strong>。</li>
<li>为了覆盖多播组的所有成员，<strong>多播转发树可能要经过一些没有多播组成员的路由器</strong>（例如上图中的R2）。</li>
</ul>
<hr>
<h3 id="_38">网际组管理协议<a class="headerlink" href="#_38" title="Permanent link">¶</a></h3>
<h4 id="igmp">网际组管理协议IGMP的三种报文类型<a class="headerlink" href="#igmp" title="Permanent link">¶</a></h4>
<p>网际组管理协议IGMP目前的最新版本是2002年10月公布的IGMPv3[RFC 3376]。</p>
<p>IGMP有三种报文类型：</p>
<ol>
<li><strong>成员查询报文（Membership Query Message）</strong>：由多播路由器周期性地发送到本局域网内，用来询问本局域网上是否有主机加入了某个多播组。</li>
<li><strong>成员报告报文（Membership Report Message）</strong>：由主机发送给多播路由器，用来报告主机加入了某个多播组。</li>
<li><strong>离开组报文（Leave Group Message）</strong>：由主机发送给多播路由器，用来报告主机离开了某个多播组。</li>
</ol>
<p>IGMP报文被封装在IP数据报中传送</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-101.png" data-desc-position="bottom"><img alt="img" src="../assets/4-101.png"></a></p>
<hr>
<h4 id="igmp_1">网际组管理协议IGMP的基本工作原理<a class="headerlink" href="#igmp_1" title="Permanent link">¶</a></h4>
<h5 id="_39">加入多播组<a class="headerlink" href="#_39" title="Permanent link">¶</a></h5>
<p>当一台主机想要开始接收某个特定多播组的数据时，它需要主动“举手”报名。</p>
<ol>
<li><strong>发送成员报告报文：</strong></li>
</ol>
<p>假设主机 B 想要加入多播组 <code>226.0.9.26</code>。</p>
<p>主机 B 会主动发送一个 <strong>IGMP 成员报告报文</strong>。</p>
<p><strong>封装细节：</strong></p>
<ul>
<li>该报文封装在 IP 多播数据报中。</li>
<li><strong>IP 目的地址：</strong> 设置为要加入的多播组地址 <code>226.0.9.26</code>（而不是路由器的地址）。</li>
<li><strong>MAC 目的地址：</strong> 对应的以太网多播地址 <code>01-00-5E-00-09-1A</code>。</li>
</ul>
<ol start="2">
<li><strong>路由器更新列表：</strong></li>
</ol>
<ul>
<li>多播路由器 R1 默认被设置为接收所有的 IP 多播数据报。</li>
<li>收到主机 B 的报告后，R1 解析内容，发现有主机想加入 <code>226.0.9.26</code>。</li>
<li>R1 在其<strong>多播组列表</strong>中添加 <code>226.0.9.26</code>。此时，R1 就知道需要将该组的数据转发到这个局域网了。</li>
</ul>
<ol start="3">
<li><strong>其他主机的反应：</strong></li>
</ol>
<ul>
<li>由于目的 MAC 地址是特定的多播地址，不属于该组的主机（如主机 C、D）会在 MAC 层直接丢弃该帧。</li>
<li>属于其他多播组的主机（如主机 C 在 <code>228.1.1.1</code>），检查 IP 地址发现不匹配后，也会丢弃该报文。</li>
</ul>
<hr>
<h5 id="_40">监视多播组的成员变化<a class="headerlink" href="#_40" title="Permanent link">¶</a></h5>
<p>路由器需要定期确认“这个局域网里还有没有人听这个频道？”如果没有了，它就要停止转发数据以节省带宽。这是通过<strong>探询（Query）</strong>与<strong>响应（Response）</strong>机制完成的。</p>
<ol>
<li>路由器发送查询 (Query)</li>
</ol>
<ul>
<li>路由器 R1 默认每隔 <strong>125秒</strong> 发送一个 <strong>IGMP 成员查询报文</strong>。内容是要查询的多播组（也可以是所有组）。</li>
<li><strong>目的地址：</strong> 发送给本网络中<strong>所有</strong>参加多播的主机，IP 地址为特殊的 <code>224.0.0.1</code>（表示“所有系统”）。</li>
<li><strong>MAC 地址：</strong> 对应的 <code>01-00-5E-00-00-01</code>。</li>
<li>此报文会被网段内所有开启多播功能的主机（A, B, C）接收，只有不参与任何多播的主机 D 会在硬件层面（MAC层）丢弃它。</li>
</ul>
<ol start="2">
<li>主机的随机延时响应 (Random Delay)</li>
</ol>
<p>收到查询后，主机不会立即一拥而上地回复（这会造成网络风暴），而是采用一种<strong>随机延时响应</strong>机制：</p>
<ul>
<li>主机 A（属于 <code>226.0.9.26</code>）随机设定一个计时器，例如 8秒后响应。</li>
<li>主机 B（属于 <code>226.0.9.26</code>）随机设定一个计时器，例如 2秒后响应。</li>
<li>主机 C（属于 <code>228.1.1.1</code>）也设定自己的计时器。</li>
</ul>
<ol start="3">
<li>响应与抑制 (Report Suppression) —— IGMP 的精髓</li>
</ol>
<p>这是 IGMP 协议最聪明的设计，目的是减少网络上的重复报文。</p>
<ul>
<li>主机 B 的计时器（2秒）最先到期。主机 B 发送针对 <code>226.0.9.26</code> 的 <strong>IGMP 成员报告报文</strong>。</li>
<li>这个报告报文是广播给全网段听的（基于多播地址）。</li>
<li><strong>主机 A</strong> 听到了主机 B 的报告。A 发现：“哦，B 已经报告了 <code>226.0.9.26</code>，那路由器已经知道有人在听这个组了，我就不用多嘴了。”</li>
<li>于是，主机 A <strong>取消发送</strong>它原本准备好的报告。这叫做<strong>响应抑制</strong>。</li>
<li><strong>主机 C 的行为：</strong> 主机 C 听到了 B 的报告，但发现 B 报告的是 <code>226.0.9.26</code>，而自己属于 <code>228.1.1.1</code>。这是不同的组，所以 C 必须继续等待自己的计时器到期，然后发送自己的报告。</li>
</ul>
<ol start="4">
<li>路由器更新状态</li>
</ol>
<ul>
<li>R1 收到了来自 B 的报告（确认 <code>226.0.9.26</code> 有人）和来自 C 的报告（确认 <code>228.1.1.1</code> 有人）。</li>
<li>R1 <strong>重置</strong>这两个组的超时计时器，继续转发这两个组的数据。</li>
</ul>
<p><strong>超时与删除 (Leave Group)</strong></p>
<p>如果在多次探询周期后，路由器<strong>长时间收不到</strong>某个多播组的任何成员响应（意味着最后一个成员也离开了，或者下线了）：</p>
<ol>
<li>R1 发送查询报文。</li>
<li>没有任何主机对组 <code>228.1.1.1</code> 进行响应（所有原成员都离开了）。</li>
<li>超时后，R1 将 <code>228.1.1.1</code> 从多播组列表中<strong>删除</strong>。</li>
<li>R1 停止向该局域网转发 <code>228.1.1.1</code> 的数据，从而节省网络资源。</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>同一网络中的多播路由器可能不止一个，但没有必要每个多播路由器都周期性地发送IGMP成员查询报文。</p>
<p>只要在这些多播路由器中选择一个作为<strong>查询路由器</strong>，由查询路由器发送IGMP成员查询报文，而其他的多播路由器仅被动接收响应并更新自己的多播组列表即可。</p>
<p>选择查询路由器的方法：</p>
<ul>
<li>
<p>每个多播路由器若监听到源IP地址比自己的IP地址小的IGMP成员查询报文则退出选举。</p>
</li>
<li>
<p>最后，网络中只有<strong>IP地址最小的多播路由器成为查询路由器</strong>。</p>
</li>
</ul>
</div>
<hr>
<h5 id="_41">退出多播组<a class="headerlink" href="#_41" title="Permanent link">¶</a></h5>
<p>IGMPv2在IGMPv1的基础上增加了一个可选项：当主机要退出某个多播组时，可主动发送一个<strong>离开组报文</strong>而不必等待多播路由器的查询。这样<strong>可使多播路由器能够更快地发现某个组有成员离开</strong>。</p>
<p>多播路由器默认每隔125秒就向其直连网络发送一个封装有IGMP成员查询报文的IP多播数据报</p>
<ol>
<li>主机发送离开报文 (The Leave Message)</li>
</ol>
<p>当主机 C (Host C) 决定不再接收某个多播组的数据时，它会主动发起“分手”信号。</p>
<p><strong>动作：</strong> 主机 C 向网络发送一个 <strong>IGMP 离开组报文 (IGMP Leave Group Message)</strong>。
<strong>报文内容：</strong></p>
<ul>
<li><strong>内容：</strong> 声明要离开的组地址 <span class="arithmatex">\(228.1.1.1\)</span>。</li>
<li><strong>目的 IP 地址：</strong> <span class="arithmatex">\(224.0.0.2\)</span>。<em>解释：</em> 这是一个特殊的保留多播地址，代表“本子网内的<strong>所有多播路由器</strong>”。主机 C 并不是把这个消息发给组内的其他成员，而是专门发给路由器（R1）看的。</li>
<li><strong>目的 MAC 地址：</strong> <span class="arithmatex">\(01\text{-}00\text{-}5\text{E-}00\text{-}00\text{-}02\)</span>。<em>解释：</em> 这是 IP 地址 <span class="arithmatex">\(224.0.0.2\)</span> 对应的以太网多播 MAC 地址。</li>
</ul>
<ol start="2">
<li>报文在局域网内的传播与处理</li>
</ol>
<p>这个离开报文被封装在以太网帧中发送到局域网上。</p>
<p><strong>对于普通主机 (Host A, B, D)：</strong></p>
<ul>
<li><strong>MAC 层接收：</strong> 由于是以太网多播帧，连接在同一网段的所有主机的网卡（MAC层）实际上都会收到这个帧。</li>
<li><strong>网际层 (IP层) 丢弃：</strong> 主机 A、B、D 的 IP 层收到数据包后，检查目的 IP 是 <span class="arithmatex">\(224.0.0.2\)</span>。因为它们只是普通主机，不是多播路由器，不监听这个地址，所以它们会在 IP 层将该报文<strong>丢弃 (Discard)</strong>。</li>
</ul>
<p><strong>对于多播路由器 (Router R1)：</strong></p>
<ul>
<li>R1 监听 <span class="arithmatex">\(224.0.0.2\)</span>，因此它会接收并处理这个报文。R1 此时得知：有一个成员想要离开组 <span class="arithmatex">\(228.1.1.1\)</span>。</li>
</ul>
<ol start="3">
<li>路由器的确认与查询 (Router Inquiry)</li>
</ol>
<p>这是 IGMPv2 的核心机制。路由器收到离开报文后，<strong>不会立即停止</strong>转发该组的数据，因为它不知道该网段内是否<strong>还有其他主机</strong>属于该组。</p>
<p><strong>特定组查询 (Group-Specific Query)：</strong></p>
<ul>
<li>路由器 R1 立即发送一个 <strong>特定组成员查询报文 (Group-Specific Membership Query)</strong>。</li>
<li><strong>目的 IP 地址：</strong> <span class="arithmatex">\(228.1.1.1\)</span>（即被申请离开的那个组的地址，而不是发给所有主机）。</li>
<li><strong>目的：</strong> R1 在问：“在这个局域网里，还有人订阅 <span class="arithmatex">\(228.1.1.1\)</span> 吗？”</li>
</ul>
<p><strong>后续可能的结果：</strong></p>
<ol>
<li><strong>有人响应：</strong> 如果网段内还有其他主机（例如 Host B 也在该组），Host B 会收到这个查询，并回复一个 IGMP 成员关系报告（Report）。R1 收到报告后，会继续向该网段转发 <span class="arithmatex">\(228.1.1.1\)</span> 的数据流。</li>
<li><strong>无人响应：</strong> 如果在规定时间（通常称为最大响应时间）内，R1 没有收到任何关于 <span class="arithmatex">\(228.1.1.1\)</span> 的回复，R1 就会认定该网段内已没有该组的成员。此时，R1 才会从多播组列表中删除该组，并停止转发该组的数据。</li>
</ol>
<hr>
<h3 id="_42">多播路由选择协议<a class="headerlink" href="#_42" title="Permanent link">¶</a></h3>
<h4 id="_43">多播路由选择协议<a class="headerlink" href="#_43" title="Permanent link">¶</a></h4>
<p>多播路由选择协议的主要任务是：在多播路由器之间为每个多播组<strong>建立一个多播转发树</strong>。</p>
<ul>
<li>多播转发树连接多播源和所拥有该多播组成员的路由器。</li>
</ul>
<p>目前有以下两种方法来构建多播转发树：</p>
<ul>
<li><strong>基于源树</strong>（Source-Base Tree）多播路由选择</li>
<li><strong>组共享树</strong>（Group-Shared Tree）多播路由选择</li>
</ul>
<hr>
<h5 id="_44">基于源树多播路由选择<a class="headerlink" href="#_44" title="Permanent link">¶</a></h5>
<p>基于源树的多播路由选择的最典型算法是<strong>反向路径多播</strong>（Reverse Path Multicasting，RPM）算法。</p>
<p>RPM算法包含以下两个步骤：</p>
<ol>
<li>利用<strong>反向路径广播</strong>（Reverse Path Broadcasting，RPB）算法建立一个<strong>广播转发树</strong>。</li>
<li>利用<strong>剪枝</strong>（Pruning）算法，剪除广播转发树中的下游非成员路由器，获得一个<strong>多播转发树</strong>。</li>
</ol>
<p>要建立广播转发树，可以使用<strong>洪泛</strong>（Flooding）法。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-106.png" data-desc-position="bottom"><img alt="img" src="../assets/4-106.png"></a></p>
<p>利用<strong>反向路径广播</strong>RPB算法生成的<strong>广播转发树</strong>，<strong>不会存在环路</strong>，因此可以避免广播分组在环路中兜圈。</p>
<p>RPB算法的要点是：每一台路由器在收到一个广播分组时，先<strong>检查该广播分组是否是从源点经最短路径传送来的</strong>。</p>
<ul>
<li>若是，本路由器就从自己除刚才接收该广播分组的接口的所有其他接口转发该广播分组。</li>
<li>否则，丢弃该广播分组。</li>
<li>如果本路由器有好几个邻居路由器都处在到源点的最短路径上，也就是存在好几条<strong>同样长度的最短路径</strong>，那么只能选取一条最短路径。<strong>选取</strong>的规则是这几条最短路径中的<strong>邻居路由器的IP地址最小的那条最短路径</strong>。</li>
</ul>
<p>RPB中“反向路径”的意思是：在计算最短路径时<strong>把源点当作终点</strong>。</p>
<details class="note">
<summary>反向路径广播RPB算法</summary>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-107.png" data-desc-position="bottom"><img alt="img" src="../assets/4-107.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-108.png" data-desc-position="bottom"><img alt="img" src="../assets/4-108.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-109.png" data-desc-position="bottom"><img alt="img" src="../assets/4-109.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-110.png" data-desc-position="bottom"><img alt="img" src="../assets/4-110.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-111.png" data-desc-position="bottom"><img alt="img" src="../assets/4-111.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-112.png" data-desc-position="bottom"><img alt="img" src="../assets/4-112.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-113.png" data-desc-position="bottom"><img alt="img" src="../assets/4-113.png"></a></p>
</details>
<hr>
<h5 id="_45">组共享树多播路由选择<a class="headerlink" href="#_45" title="Permanent link">¶</a></h5>
<p>组共享树多播路由选择采用<strong>基于核心的分布式生成树算法</strong>来建立共享树。</p>
<ul>
<li>该方法在每个<strong>多播组</strong>中指定一个<strong>核心</strong>（core）路由器，以该路由器为<strong>根</strong>，建立一棵<strong>连接多播组的所有成员路由器</strong>的生成树，作为多播转发树。</li>
</ul>
<p>每个多播组中除了核心路由器，其他所有成员路由器都会向自己多播组中的核心路由器单播<strong>加入报文</strong>。</p>
<ul>
<li>加入报文通过单播朝着核心路由器转发，直到它<strong>到达</strong>已经属于<strong>该多播生成树的某个节点</strong>或者<strong>直接到达该核心路由器</strong>。</li>
<li>加入报文所经过的路径，就确定了一条<strong>从单播该报文的边缘节点到核心路由器之间的分支</strong>，而这个新分支就被<strong>嫁接</strong>到现有的<strong>多播转发树</strong>上。</li>
</ul>
<details class="note">
<summary>基于核心的分布式生成树算法</summary>
<p>整个流程可以分为 <strong>生成树的建立</strong> 和 <strong>多播数据的转发</strong> 两个主要阶段。</p>
<p><strong>基于核心的生成树建立</strong> (Building the Tree)</p>
<p>这一阶段的目标是构建一棵连接所有组播成员路由器的共享树，树的根节点是 <strong>核心路由器 (Core Router, R5)</strong>。</p>
<ol>
<li><strong>成员加入 (Joining the Group):</strong></li>
</ol>
<ul>
<li>当局域网内的某个主机想要接收特定多播组的数据时，它会通过 <strong>IGMP 协议</strong> 向其直连的路由器发送报告。</li>
<li>例如，连接在 R4 下面的主机想要加入多播组。</li>
</ul>
<ol start="2">
<li><strong>发送加入报文 (Sending Join Message):</strong></li>
</ol>
<ul>
<li>收到 IGMP 报告的路由器（如 R4）如果不在该多播组的共享树上，它就需要向 <strong>核心路由器 (R5)</strong> 发送一个 <strong>“加入报文” (Join Message)</strong>。</li>
<li>这个加入报文会沿着通往核心路由器的单播路径逐跳传输。</li>
</ul>
<ol start="3">
<li><strong>生成树形成 (Tree Established):</strong></li>
</ol>
<ul>
<li>当加入报文到达核心路由器，或者到达已经在树上的某个中间路由器时，路径上的路由器就会记录下转发状态。</li>
<li>最终形成一棵以核心路由器 R5 为根，覆盖所有成员路由器（R2, R3, R4, R6, R7）的 <strong>多播转发树</strong>（图中红色粗线所示路径）。</li>
<li>这棵树是共享的，无论源在哪里，数据最终都会沿着这棵树分发。</li>
</ul>
<p><strong>多播数据的转发</strong> (Data Forwarding)</p>
<p>当树建立好之后，源主机开始发送数据。这个过程涉及特殊的封装机制。</p>
<ol>
<li><strong>源主机发送数据:</strong></li>
</ol>
<ul>
<li><strong>源主机 (Source Host)</strong> 向局域网发送一个 <strong>多播分组 (Multicast Packet)</strong>。</li>
<li>注意：源主机所在的路由器 (R1) 可能并不在之前建立的多播树上。</li>
</ul>
<ol start="2">
<li><strong>第一跳路由器的封装 (Encapsulation at First Hop):</strong></li>
</ol>
<ul>
<li>R1 收到多播分组后，不会直接广播。它会将这个 <strong>多播分组封装在一个单播分组中</strong>。</li>
<li>这个单播分组的 <strong>目的地址</strong> 被设置为 <strong>核心路由器 R5</strong> 的 IP 地址。</li>
<li>R1 通过单播的方式，将这个封装好的包发送给 R5。这实际上是一个“隧道”传输过程。</li>
</ul>
<ol start="3">
<li><strong>核心路由器的解封与转发 (Decapsulation and Flooding at Core):</strong></li>
</ol>
<ul>
<li><strong>核心路由器 R5</strong> 收到这个单播分组后，将其 <strong>解封</strong>，提取出里面的原始 <strong>多播分组</strong>。</li>
<li>随后，R5 依据之前建立好的 <strong>多播转发树</strong>（红色粗线路径），将这个多播分组 <strong>洪泛转发 (Flood)</strong> 给所有下游的路由器（R2, R4, R6 等）。</li>
</ul>
<ol start="4">
<li><strong>最终交付:</strong></li>
</ol>
<ul>
<li>下游路由器（如 R3, R7）收到多播数据后，再通过局域网将其转发给具体的主机。</li>
</ul>
</details>
<hr>
<h4 id="_46">因特网的路由选择协议<a class="headerlink" href="#_46" title="Permanent link">¶</a></h4>
<p>目前还没有在整个因特网范围使用的多播路由选择协议。</p>
<p>尽管因特网工程任务组IETF努力推动着因特网上的全球多播主干网（Multicast Backbone On the Internet，MBONE）的建设，但至今在因特网上的IP多播还没有得到大规模的应用。</p>
<ul>
<li>主要原因是：改变一个已成功运行且广泛部署的网络层协议是一件及其困难的事情。</li>
</ul>
<details class="example" open="open">
<summary>question</summary>
<p>在设计多播路由时，为了避免路由环路，()。</p>
<p>A.采用了水平分割技术</p>
<p>B.构造多播转发树</p>
<p>C.采用了IGMP</p>
<p>D.通过生存时间(TTL)字段</p>
</details>
<details class="note">
<summary>answer</summary>
<p>B</p>
<p>因为树具有不存在环路的特性，所以构造一个多播转发树，通过该转发树既能将多播分组传送到组内的每台主机，又能避免环路。水平分割(路由器从某个接口学到的路由信息，绝不再通过同一个接口发回去)用于避免距离-向量路由算法中的无穷计数问题。TTL 字段用于防止 IP 分组因为环路而在网络中无限循环。</p>
</details>
<hr>
<h2 id="ip_7">移动IP技术<a class="headerlink" href="#ip_7" title="Permanent link">¶</a></h2>
<h3 id="ip_8">移动IP技术的相关基本概念<a class="headerlink" href="#ip_8" title="Permanent link">¶</a></h3>
<p><strong>移动IP</strong>（Mobile IP）是因特网工程任务组IETF开发的一种技术[RFC 3344]，该技术使得<strong>移动主机在各网络之间漫游时，仍然能够保持其原来的IP地址不变</strong>。</p>
<p>每个移动主机都有一个<strong>默认连接的网络或初始申请接入的网络</strong>，称为<strong>归属网络</strong>（Home Network）。</p>
<p>移动主机在<strong>归属网络中的IP地址在其整个移动通信过程中是始终不变的</strong>，因此称为<strong>永久地址</strong>（Permanent Address）或<strong>归属地址</strong>（Home Address）。</p>
<p><strong>在归属网络中，代表移动主机执行移动管理功能的实体称为归属代理</strong>（Home Agent）。归属代理通常就是连接在归属网络上的路由器，然而它作为代理的特定功能则是在网络层完成的。</p>
<p>移动主机当前漫游所在的网络称为<strong>外地网络</strong>（Foreign Network）或<strong>被访网络</strong>（Visited Network）。</p>
<p><strong>在外地网络中，帮助移动主机执行移动管理功能的实体</strong>称为<strong>外地代理</strong>（Foreign Agent）。</p>
<p>外地代理通常就是连接在外地网络上的路由器。<strong>外地代理会为移动主机提供一个临时使用的属于外地网络的转交地址</strong>（Care-of Address）。</p>
<hr>
<h3 id="ip_9">移动IP技术的基本工作原理<a class="headerlink" href="#ip_9" title="Permanent link">¶</a></h3>
<p>当移动主机 A 离开家（归属网络）来到一个陌生的地方（外地网络）时，整个通信过程就像是“邮件转交”系统：</p>
<p>首先是<strong>代理发现与注册</strong>：移动主机 A 一连入外地网络，就会找到当地的“收发室”——也就是<strong>外地代理</strong>，并借用外地代理的 IP 地址作为自己临时的<strong>转交地址</strong>。接着，外地代理会帮忙联系移动主机 A 的老家（归属代理），告知 A 现在的新位置，完成注册。</p>
<details class="note">
<summary>Note</summary>
<p>移动主机A通过自己的代理发现协议，与外地代理建立联系，并从外地代理获得一个属于该外地网络的转交地址（例如175.1.1.1/16），同时向外地代理注册自己的永久地址和归属代理地址。</p>
<p>将移动主机A的永久地址记录在自己的注册表中，并向移动主机的归属代理注册该移动主机的转交地址（也可由移动主机直接进行注册）。</p>
<p>归属代理会将移动主机A的转交地址记录下来，此后归属代理会代替移动主机接收所有发送给该移动主机的IP数据报，并利用IP隧道技术将这些数据报转发给外地网络中的移动主机。</p>
<p>当移动主机不在归属网络时，归属代理会以自己的MAC地址应答所有对该移动主机的ARP请求，即归属代理采用ARP代理技术。</p>
<p>为了使归属网络中其他各主机和路由器能够尽快更新各自的ARP高速缓存，归属代理还会主动发送ARP广播，并声称自己是该移动主机。这样，所有发送给该移动主机的IP数据报都会发送给归属代理。</p>
</details>
<p>接下来是<strong>固定主机向移动主机发送数据</strong>（收信）：当家里的固定主机 B 给 A 发送数据时，数据包还是发往 A 的老家。A 的<strong>归属代理</strong>会像替身一样，通过<strong>ARP 代理</strong>截获这些数据。然后，归属代理把数据包“打包”进一个新信封（建立 <strong>IP 隧道</strong>），地址写的是外地代理。<strong>外地代理</strong>收到信封后拆开（解封隧道），根据里面的名字找到移动主机 A，把数据交到 A 手上。</p>
<details class="note">
<summary>Note</summary>
<p>当外地代理和移动主机不是同一台设备时，转交地址实际上是外地代理的地址而不是移动主机的地址，转交地址既不会作为移动主机发送IP数据报的源地址，也不会作为移动主机所接收的IP数据报的目的地址。</p>
<p>转交地址仅仅是归属代理到外地代理的IP隧道的出口地址。</p>
<p>所有使用同一外地代理的移动主机都可以共享同一个转交地址。</p>
<p>当外地代理从IP隧道中收到并解封出原IP数据报时，会在自己的代理注册表中查找移动主机的永久地址所对应的MAC地址，并将该数据报封装到目的地址为该MAC地址的帧中发送给移动主机。</p>
<p>这与我们之前介绍的IP数据报的正常转发流程是不同的，否则会造成该数据报又被发回移动主机的归属网络。</p>
</details>
<p>然后是<strong>移动主机向固定主机发送数据</strong>（寄信）：这个过程很简单，A 不需要把信寄回老家再转发。A 直接把外地代理当作网关，直接将数据包发给互联网上的固定主机 B 即可。虽然发信的源地址还是 A 的老家地址，但数据是直接“直飞”给 B 的，这也被称为三角形路由。</p>
<details class="note">
<summary>Note</summary>
<p>IP数据报被移动主机A按照正常的发送流程发送出去即可。</p>
<p>由于IP路由器并不关心IP数据报的源地址，因此该IP数据报被直接路由到固定主机B，而无须再通过归属代理进行转发。</p>
<p>为此，移动主机可以将外地代理作为自己的默认路由器，也可以通过代理发现协议从外地代理获取外地网络中其他路由器的地址，并将其设置为自己的默认路由器。</p>
</details>
<p>继续是关于<strong>同址转交地址方式</strong>：<strong>转交地址</strong>实际上是<strong>外地代理路由器自己的接口地址</strong>，而不是移动主机 A 的。这意味着，这个地址仅仅是隧道的出口。如果有好几个移动主机都在这个外地网络里，它们可以<strong>共享同一个转交地址</strong>来接收各自的数据，这样非常节省地址资源。</p>
<details class="note">
<summary>Note</summary>
<p>移动主机需要运行额外的外地代理软件。</p>
<p>外地网络也需要提供相应机制，使移动主机能够自动获取一个外地网络中的地址作为自己的IP地址和外地代理的地址，被称为同址转交地址（Co-Located Care-of Address）。</p>
</details>
<p>最后是关于<strong>三角形路由问题</strong>：即使在固定主机与移动主机之间存在一条更有效的路径，发往移动主机的IP数据报也要先发送给归属代理，造成IP数据报转发的低效。</p>
<details class="note">
<summary>Note</summary>
<p>解决三角形路由问题的一种方法：</p>
<p>给固定主机配置一个通信代理，固定主机发送给移动主机的IP数据报，都要通过该通信代理转发。</p>
<p>通信代理先从归属代理获取移动主机的转交地址，之后所有发送给移动主机的IP数据报，都利用转交地址直接通过IP隧道发送给移动主机的外地代理，而无须再通过移动主机的归属代理进行转发。</p>
<p>这种方法以增加复杂性为代价，并要求固定主机也要配置通信代理，也就是对固定主机不再透明。</p>
</details>
<hr>
<h2 id="ipv6">IPv6数据报<a class="headerlink" href="#ipv6" title="Permanent link">¶</a></h2>
<h3 id="ipv6_1">IPv6引进的主要变化<a class="headerlink" href="#ipv6_1" title="Permanent link">¶</a></h3>
<h4 id="ipv6_2">IPv6的诞生背景<a class="headerlink" href="#ipv6_2" title="Permanent link">¶</a></h4>
<p>因特网经过几十年的飞速发展，到2011年2月3日，因特网号码分配管理局IANA宣布IPv4地址已经<strong>分配完毕</strong>，因特网服务提供者ISP已经不能再申请到新的IPv4地址块。</p>
<p>如果没有<strong>网络地址转换</strong>NAT技术的广泛应用，IPv4早已停止发展。</p>
<p>然而，NAT仅仅是为了延长IPv4使用寿命而采取的权宜之计，解决IPv4地址耗尽的根本措施就是采用具有<strong>更大地址空间</strong>（IP地址的长度为128比特）的新版本IP，即IPv6。</p>
<hr>
<h4 id="ipv6_3">IPv6引进的主要变化<a class="headerlink" href="#ipv6_3" title="Permanent link">¶</a></h4>
<ul>
<li><strong>更大的地址空间</strong>：IPv6将IPv4的32比特地址空间增大到了<strong>128比特</strong>，在采用合理编址方法的情况下，在可预见的未来是不会用完的。</li>
<li><strong>扩展的地址层次结构</strong>：可划分为更多的层次，这样可以更好地反映出因特网的拓扑结构，使得<strong>对寻址和路由层次的设计更具有灵活性</strong>。</li>
<li><strong>灵活的首部格式</strong>：与IPv4首部并不兼容。IPv6定义了许多<strong>可选的的扩展首部</strong>，不仅可提供比IPv4更多的功能，而且还可以<strong>提高路由器的处理效率</strong>，因为路由器对逐跳扩展首部外的其他扩展首部都不进行处理。</li>
<li><strong>改进的选项</strong>：IPv6允许分组<strong>包含有选项的控制信息</strong>，因而<strong>可以包含一些新的选项</strong>。然而IPv4规定的选项却是固定不变的。</li>
<li><strong>允许协议继续扩充</strong>：<strong>这一点很重要，因为技术总是在不断地发展，而新的应用也会层出不穷。然而IPv4的功能却是固定不变的。</strong></li>
<li><strong>支持即插即用（即自动配置）</strong><em>：IPv6支持主机或路由器自动配置IPv6地址及其他网络配置参数。因此</em><em>IPv6不需要使用DHCP</em>*。</li>
<li><strong>支持资源的预分配</strong>：IPv6能为实时音视频等要求保证一定带宽和时延的应用，提供<strong>更好的服务质量保证</strong>。</li>
</ul>
<hr>
<h3 id="ipv6_4">IPv6数据报的基本首部<a class="headerlink" href="#ipv6_4" title="Permanent link">¶</a></h3>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-114.png" data-desc-position="bottom"><img alt="img" src="../assets/4-114.png"></a></p>
<ul>
<li>所有的<strong>扩展首部</strong>并不属于IPv6数据报的首部，它们与其后面的数据部分合起来构成<strong>有效载荷</strong>（payload，也称为净负荷）。</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-115.png" data-desc-position="bottom"><img alt="img" src="../assets/4-115.png"></a></p>
<details class="note">
<summary>IPv6数据报首部与IPv4数据报首部的主要区别</summary>
<ul>
<li>
<p>取消了首部长度字段，因为IPv6数据报的首部长度是固定的40字节。</p>
</li>
<li>
<p>取消了区分服务（服务类型）字段，因为IPv6数据报首部中的通信量类和流标号字段实现了区分服务字段的功能。</p>
</li>
<li>
<p>取消了总长度字段，改用有效载荷长度字段。这是因为IPv6数据报的首部长度是固定的40字节，只有其后面的有效载荷长度是可变的。</p>
</li>
<li>
<p>取消了标识、标志和片偏移字段，因为这些功能已包含在IPv6数据报的分片扩展首部中。</p>
</li>
<li>
<p>把生存时间TTL字段改称为跳数限制字段，这样名称与作用更加一致。</p>
</li>
<li>
<p>取消了协议字段，改用下一个首部字段。</p>
</li>
<li>
<p>取消了首部检验和字段，这样可以加快路由器处理IPv6数据报的速度。</p>
</li>
<li>
<p>取消了选项字段，改用扩展首部来实现选项功能。</p>
</li>
</ul>
</details>
<ul>
<li><strong>版本字段</strong>：长度为4比特，用来表示IP协议的版本。对于IPv6该字段的值是6。</li>
<li><strong>通信量类字段</strong>：长度为8比特，该字段用来区分不同的IPv6数据报的<strong>类别或优先级</strong>。目前正在进行不同的通信量类性能的实验。</li>
<li><strong>流标号字段</strong>：长度为20比特。</li>
</ul>
<details class="note">
<summary>IPv6提出了流的抽象概念</summary>
<p>“流”就是因特网上从特定源点到特定终点（单播或多播）的一系列IPv6数据报（如实时音视频数据的传送），而在这个“流”所经过的路径上的所有路由器都保证指明的服务质量。</p>
<p>所有属于同一个流的IPv6数据报都具有同样的流标号。换句话说，<strong>流标号用于资源分配</strong>。</p>
<p>流标号对于实时音视频数据的传送特别有用，但对于传统的非实时数据，流标号则没有用处，把流标号字段的值置为0即可。</p>
</details>
<ul>
<li><strong>有效载荷长度字段</strong>：长度为16比特，它指明IPv6数据报基本首部后面的有效载荷（包括扩展首部和数据部分）的字节数量。该字段以字节为单位，最大取值为65535，因此IPv6数据报基本首部后面的有效载荷的最大长度为65535字节。</li>
<li><strong>下一个首部字段</strong>：长度为8比特。该字段相当于IPv4数据报首部中的<strong>协议字段或可选字段</strong>。</li>
</ul>
<details class="note">
<summary>下一个首部字段的作用</summary>
<p>当IPv6数据报没有扩展首部时，该字段的作用与IPv4的协议字段一样，它的值指出了IPv6数据报基本首部后面的数据是何种协议数据单元PDU。</p>
<p>当IPv6数据报基本首部后面带有扩展首部时，该字段的值就标识后面第一个扩展首部的类型。</p>
</details>
<ul>
<li><strong>跳数限制字段</strong>：长度为8比特。该字段用来防止IPv6数据报在因特网中永久兜圈。源点在每个IPv6数据报发出时即设定某个跳数限制（最大255跳）。每个路由器在转发IPv6数据报时，要先把跳数限制字段中的值减1。当跳数限制的值为0时，就把这个IPv6数据报丢弃（即不转发）。</li>
<li><strong>源地址字段和目的地址字段</strong>：长度都为128比特。分别用来填写IPv6数据报的发送端的IPv6地址和接收端的IPv6地址。</li>
</ul>
<hr>
<h3 id="ipv6_5">IPv6数据报的扩展首部<a class="headerlink" href="#ipv6_5" title="Permanent link">¶</a></h3>
<p>IPv4数据报如果在其首部中使用了<strong>选项字段</strong>，则在数据报的整个传送路径中的全部路由器，都要对选项字段进行检查，这就<strong>降低了路由器处理数据报的速度</strong>。</p>
<p>实际上，在路径中的路由器对很多选项是不需要检查的。因此，为了提高路由器对数据包的处理效率，IPv6把原来IPv4首部中的选项字段都放在了扩展首部中，由路径两端的源点和终点的主机来处理，而<strong>数据报传送路径中的所有路由器都不处理这些扩展首部</strong>（除<strong>逐跳选项</strong>扩展首部）。</p>
<p>在[RFC 2460]中定义了以下六种扩展首部：</p>
<ol>
<li>逐跳选项</li>
<li>路由选择</li>
<li>分片</li>
<li>鉴别</li>
<li>封装安全有效载荷</li>
<li>目的站选项</li>
</ol>
<ul>
<li><strong>每一个扩展首部都由若干个字段组成</strong>，它们的长度也各不相同。</li>
<li><strong>所有扩展首部中的第一个字段都是8比特的下一个首部字段</strong>。该字段的值指出在该扩展首部后面是何种扩展首部。</li>
<li>当使用多个扩展首部时，应按<strong>以上的先后顺序</strong>出现。</li>
</ul>
<hr>
<h2 id="ipv6_6">IPv6地址<a class="headerlink" href="#ipv6_6" title="Permanent link">¶</a></h2>
<h3 id="ipv6_7">IPv6地址空间大小<a class="headerlink" href="#ipv6_7" title="Permanent link">¶</a></h3>
<p>在IPv6中，每个地址占128个比特。</p>
<p>IPv6地址空间的大小为： <span class="arithmatex">\(2^{128} &gt; 3.4 \times 10^{38}\)</span> 个地址。</p>
<hr>
<h4 id="ipv6_8">IPv6地址的表示方法<a class="headerlink" href="#ipv6_8" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-116.png" data-desc-position="bottom"><img alt="img" src="../assets/4-116.png"></a></p>
<p>在IPv6地址的冒号十六进制记法的基础上，再使用<strong>左侧零省略</strong>和<strong>连续零压缩</strong>，可使IPv6地址的表示更加简洁。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-117.png" data-desc-position="bottom"><img alt="img" src="../assets/4-117.png"></a></p>
<p>在一个IPv6地址中只能使用一次<strong>连续零压缩</strong>，否则会导致歧义。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-118.png" data-desc-position="bottom"><img alt="img" src="../assets/4-118.png"></a></p>
<p>冒号十六进制记法还可结合点分十进制的后缀。这在IPv4向IPv6过渡阶段非常有用。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-119.png" data-desc-position="bottom"><img alt="img" src="../assets/4-119.png"></a></p>
<p>CIDR的斜线表示法在IPv6中仍然可用。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-120.png" data-desc-position="bottom"><img alt="img" src="../assets/4-120.png"></a></p>
<hr>
<h3 id="ipv6_9">IPv6地址的分类<a class="headerlink" href="#ipv6_9" title="Permanent link">¶</a></h3>
<p>IPv6数据报的目的地址有三种基本类型：</p>
<ol>
<li>单播（unicast）: 传统的点对点通信</li>
<li>多播（multicast）: 一点对多点的通信。数据报发送到一组计算机中的每一个。IPv6没有采用广播的术语，而将广播看作多播的一个特例。</li>
<li>任播（anycast）: 这是IPv6新增的一种类型。任播的终点是<strong>一组计算机</strong>，但<strong>数据报只交付其中的一个</strong>，通常是按照路由算法得出的距离最近的一个。</li>
</ol>
<ul>
<li>未指明地址: 128个比特为“全0”的地址，可缩写为两个冒号“::”。该地址不能用作目的地址，只能用于还没有配置到一个标准IPv6地址的主机用作源地址。未指明地址仅有一个。</li>
<li>环回地址: 最低比特为1，其余127个比特为“全0”，即0:0:0:0:0:0:0:1，可缩写为::1。该地址的作用与IPv4的环回地址相同。IPv6的环回地址只有一个。</li>
<li>多播地址: 最高8比特为“全1”的地址，可记为FF00::/8。IPv6多播地址的功能与IPv4多播地址相同。这类地址占IPv6地址空间的1/256。</li>
<li>本地链路单播地址: 最高10比特为1111111010的地址，可记为FE80::/10。即使用户网络没有连接到因特网，但仍然可以使用TCP/IP协议。连接在这种网络上的主机都可以使用本地链路单播地址进行通信，但不能和因特网上的其他主机通信。这类地址占IPv6地址空间的1/1024。</li>
<li>全球单播地址: 除了上述几类地址外，其余的IPv6地址都属于全球单播地址。全球单播地址是使用得最多的一类地址。IPv6全球单播地址采用三级结构，这是为了使路由器可以更快地查找路由。</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-121.png" data-desc-position="bottom"><img alt="img" src="../assets/4-121.png"></a></p>
<hr>
<h3 id="ipv4ipv6">从IPv4向IPv6过渡<a class="headerlink" href="#ipv4ipv6" title="Permanent link">¶</a></h3>
<p>因特网上使用IPv4的路由器的数量太大，要让所有路由器都改用IPv6并不能一蹴而就。因此，从IPv4转变到IPv6只能采用<strong>逐步演进的办法</strong>。</p>
<hr>
<h4 id="_47">使用双协议栈<a class="headerlink" href="#_47" title="Permanent link">¶</a></h4>
<p>双协议栈（Dual Stack）是指在完全过渡到IPv6之前，使一部分主机或路由器<strong>装有IPv4和IPv6两套协议栈</strong>。</p>
<p>双协议栈主机或路由器既可以和IPv6系统通信，又可以和IPv4系统通信。</p>
<p>双协议栈主机或路由器记为IPv6/IPv4，表明它具有一个IPv6地址和一个IPv4地址。</p>
<ul>
<li>双协议栈主机在与IPv6主机通信时采用IPv6地址，而与IPv4主机通信时采用IPv4地址。</li>
<li>双协议栈主机通过域名系统DNS查询目的主机采用的IP地址：若DNS返回的是IPv4地址，则双协议栈的源主机就使用IPv4地址；若DNS返回的是IPv6地址，则双协议栈的源主机就使用IPv6地址。</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-122.png" data-desc-position="bottom"><img alt="img" src="../assets/4-122.png"></a></p>
<hr>
<h4 id="_48">使用隧道技术<a class="headerlink" href="#_48" title="Permanent link">¶</a></h4>
<p>隧道技术（Tunneling）的核心思想是：</p>
<ol>
<li>当IPv6数据报要进入IPv4网络时，将IPv6数据报重新封装成IPv4数据报，即整个IPv6数据报成为IPv4数据报的数据载荷。</li>
<li>封装有IPv6数据报的IPv4数据报在IPv4网络中传输。</li>
<li>当IPv4数据报要离开IPv4网络时，再将其数据载荷（即原来的IPv6数据报）取出并转发到IPv6网络。</li>
</ol>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-123.png" data-desc-position="bottom"><img alt="img" src="../assets/4-123.png"></a></p>
<ul>
<li>要使双协议栈路由器R4知道IPv4数据报的数据载荷是IPv6数据报，则IPv4数据报首部中协议字段的值必须设置为41。</li>
</ul>
<hr>
<h3 id="icmpv6">网际控制报文协议ICMPv6<a class="headerlink" href="#icmpv6" title="Permanent link">¶</a></h3>
<p>由于IPv6与IPv4一样，都<strong>不确保数据报的可靠交付</strong>，因此IPv6也需要使用<strong>网际控制报文协议</strong>ICMP来向发送IPv6数据报的源主机反馈一些差错信息，相应的ICMP版本为ICMPv6。</p>
<p>ICMPv6比ICMPv4要复杂得多，它<strong>合并了原来的地址解析协议ARP和网际组管理协议IGMP的功能</strong>。因此与IPv6配套使用的网际层协议就只有ICMPv6这一个协议。</p>
<hr>
<h4 id="icmpv6_1">ICMPv6报文的封装<a class="headerlink" href="#icmpv6_1" title="Permanent link">¶</a></h4>
<p>ICMPv6报文需要封装成IPv6数据报进行发送。</p>
<p>下一个首部取值为58，表明数据载荷为ICMPv6报文。</p>
<hr>
<h4 id="icmpv6_2">ICMPv6报文的分类<a class="headerlink" href="#icmpv6_2" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-124.png" data-desc-position="bottom"><img alt="img" src="../assets/4-124.png"></a></p>
<details class="example" open="open">
<summary>question</summary>
<p>下列关于IPv6的描述中，错误的是()。</p>
<p>A.IPv6的首部长度是不可变的</p>
<p>B.IPv6不允许在中间路由器进行分片</p>
<p>C.IPv6采用了16B的地址，在可预见的将来不会用完</p>
<p>D.IPv6使用了首部检验和来保证传输的正确性</p>
</details>
<details class="note">
<summary>answer</summary>
<p>D</p>
<p>IPv6 的首部长度是固定的，因此不需要首部长度字段。IPv6 取消了检验和字段，这样就加快了路由器处理数据报的速度。我们知道，数据链路层会丢弃检测出差错的帧，传输层也有相应的差错处理机制，因此网络层的差错检测可以精简掉。</p>
</details>
<details class="example" open="open">
<summary>question</summary>
<p>若一个路由器收到的IPv6数据报因太大而不能转发到链路上，则路由器将把该数据报()。</p>
<p>A.丢弃</p>
<p>B.暂存</p>
<p>C.分片</p>
<p>D.转发至能支持该数据报的链路上</p>
</details>
<details class="note">
<summary>answer</summary>
<p>A</p>
<p>IPv6 中不允许在中间路由器进行分片。因此，若路由器发现到来的数据报太大而不能转发到链路上，则丢弃该数据报，并向发送方发送一个指示分组太大的ICMP 报文。</p>
</details>
<hr>
<h2 id="_49">网络层的数据层面和控制层面<a class="headerlink" href="#_49" title="Permanent link">¶</a></h2>
<p><strong>软件定义网络</strong>（Software Defined Network，SDN）的概念最早由斯坦福大学的Nick McKeown教授于2009年提出。</p>
<p>SDN最初只是学术界讨论的一种<strong>新型网络体系结构</strong>。</p>
<hr>
<h3 id="_50">网络层的数据层面和控制层面<a class="headerlink" href="#_50" title="Permanent link">¶</a></h3>
<ul>
<li>路由器的功能</li>
</ul>
<ol>
<li>为主机间的通信提供<strong>转发服务</strong></li>
<li>路由选择</li>
</ol>
<ul>
<li>路由器之间传送的信息</li>
</ul>
<ol>
<li>主机间的分组</li>
<li>路由信息</li>
</ol>
<p>在SDN体系结构中，路由器中的路由软件都不存在了。因此，路由器之间不再交换路由信息。</p>
<ul>
<li>在控制层面中，有一个在<strong>逻辑上集中</strong>的<strong>远程控制器</strong>。</li>
<li>逻辑上集中的远程控制器<strong>在物理上可由不同地点的多个服务器组成</strong>。</li>
<li>远程控制器掌握各主机和整个网络的状态。</li>
<li>远程控制器能够为每一个分组计算出最佳的路由。</li>
<li>远程控制器为每一个路由器生成其正确的转发表。</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../assets/4-125.png" data-desc-position="bottom"><img alt="img" src="../assets/4-125.png"></a></p>
<p>SDN这种新型网络体系结构的<strong>核心思想</strong>：把网络的控制层面和数据层面分离，而让控制层面利用软件来控制数据层面中的许多设备。</p>
<hr>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="2025年12月9日 16:39:13 CST">2025年12月9日 16:39:13</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="创建日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="2025年11月16日 16:29:33 CST">2025年11月16日 16:29:33</span>
  </span>

    
    
    
  </aside>


  




  <h2 id="__comments">评论</h2>
  <script src="https://giscus.app/client.js" data-repo="Melody12020831/Notebook" data-repo-id="R_kgDONR_9AA" data-category="Announcements" data-category-id="DIC_kwDONR_9AM4CkboN" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async>
  </script>

  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate" ? "dark" : "light"
      giscus.setAttribute("data-theme", theme) 
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate" ? "dark" : "light"

          /* Instruct Giscus to change theme */
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2024 <a href="https://github.com/Melody12020831" target="_blank" rel="noopener">Melody</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/Melody12020831/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["content.code.copy", "content.code.annotate", "navigation.tracking", "navigation.tabs", "navigation.indexes", "navigation.top", "navigation.path", "toc.follow", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://gcore.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../../css/javascripts/tablesort.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>